---
title: pythonè¯­è¨€è¿›é˜¶
date: 2022-05-18 10:15:21
pageClass: custom-series-page-class
categories:
- pythonğŸ
tags:
- pythonğŸ
---

:::tip ğŸ“ŒTip
pythonçš„è¿›é˜¶æé«˜ï¼Œæ³¢æ¯”å¾ˆç»å…¸çš„è¯¾äº†ï¼Œé…åˆ[cookbook](https://python3-cookbook.readthedocs.io/zh_CN/latest/index.html)å’Œ[æ–‡æ¡£](https://docs.python.org/zh-cn/3.9/)  
å†™çš„å¯èƒ½ä¼šå¾ˆé•¿
:::
<!-- more -->
[[toc]]
<div align="center"><h1><strong> pythonè¯­è¨€è¿›é˜¶</strong></h1></div>
åŠ¨æ€è¯­è¨€åªæœ‰åœ¨è¿è¡Œçš„æ—¶å€™æ‰èƒ½å‘ç°é”™è¯¯ï¼Œè¿™æ˜¯å›ºæœ‰ç¼ºç‚¹  

## åˆå§‹åŒ–,æ¨¡å—,å’ŒåŒ…
### èµ„æ–™æº
- [cookbook](https://python3-cookbook.readthedocs.io/zh_CN/latest/index.html)
- [å®˜æ–¹æ–‡æ¡£#ç¬¬ä¸‰æ–¹åŒ…](https://docs.python.org/zh-cn/3/library/index.html)
- [å†…ç½®å‡½æ•°Built-in Functions](https://docs.python.org/3/library/functions.html)
- [ç¬¬ä¸‰æ–¹åŒ…æŸ¥è¯¢pypi](https://pypi.org/)
- [Python Enhancement Proposals-PEP](https://peps.python.org/)

### pythonç¼–ç é£æ ¼è§„èŒƒ
[Python é£æ ¼æŒ‡å— â€” Google å¼€æºé¡¹ç›®é£æ ¼æŒ‡å—](https://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/contents/)  
[PEP 8 â€“ Style Guide for Python Code](https://peps.python.org/pep-0008/)  
Pythonçš„åˆ›å§‹äººä¸ºGuido van Rossumã€‚1989å¹´åœ£è¯èŠ‚æœŸé—´ï¼Œåœ¨é˜¿å§†æ–¯ç‰¹ä¸¹ï¼ŒGuidoä¸ºäº†æ‰“å‘åœ£è¯èŠ‚çš„æ— è¶£ï¼Œå†³å¿ƒå¼€å‘ä¸€ä¸ªæ–°çš„è„šæœ¬è§£é‡Šç¨‹åºï¼Œä½œä¸ºABC è¯­è¨€çš„ä¸€ç§ç»§æ‰¿ã€‚ä¹‹æ‰€ä»¥é€‰ä¸­Pythonï¼ˆå¤§èŸ’è›‡çš„æ„æ€ï¼‰ä½œä¸ºè¯¥ç¼–ç¨‹è¯­è¨€çš„åå­—ï¼Œæ˜¯å–è‡ªè‹±å›½20ä¸–çºª70å¹´ä»£é¦–æ’­çš„ç”µè§†å–œå‰§ã€Šè’™æ.æ´¾æ£®å¹²çš„é£è¡Œé©¬æˆå›¢ã€‹ï¼ˆMonty Python's Flying Circusï¼‰ã€‚  

:::tip ğŸ‰Success
**pythonä¹‹ç¦…**<br/>
å†™pythonicçš„ä»£ç 

```
The Zen of Python, by Tim Peters

Beautiful is better than ugly.
Explicit is better than implicit.
Simple is better than complex.
Complex is better than complicated.
Flat is better than nested.
Sparse is better than dense.
Readability counts.
Special cases aren't special enough to break the rules.
Although practicality beats purity.
Errors should never pass silently.
Unless explicitly silenced.
In the face of ambiguity, refuse the temptation to guess.
There should be one-- and preferably only one --obvious way to do it.
Although that way may not be obvious at first unless you're Dutch.
Now is better than never.
Although never is often better than *right* now.
If the implementation is hard to explain, it's a bad idea.
If the implementation is easy to explain, it may be a good idea.
Namespaces are one honking great idea -- let's do more of those!

```

**ç¿»è¯‘**

```
ä¼˜ç¾ä¼˜äºä¸‘é™‹ï¼Œ
æ˜äº†ä¼˜äºéšæ™¦ï¼›
ç®€å•ä¼˜äºå¤æ‚ï¼Œ
å¤æ‚ä¼˜äºç¹æ‚ï¼Œ
æ‰å¹³ä¼˜äºåµŒå¥—ï¼Œ
ç¨€ç–ä¼˜äºç¨ å¯†ï¼Œ
å¯è¯»æ€§å¾ˆé‡è¦ï¼
ç‰¹ä¾‹äº¦ä¸å¯è¿èƒŒåŸåˆ™ï¼Œ
å³ä½¿å®ç”¨æ¯”çº¯ç²¹æ›´ä¼˜ã€‚
é”™è¯¯ç»ä¸èƒ½æ‚„æ‚„å¿½ç•¥ï¼Œ
é™¤éå®ƒæ˜ç¡®éœ€è¦å¦‚æ­¤ã€‚
é¢å¯¹ä¸ç¡®å®šæ€§ï¼Œ
æ‹’ç»å¦„åŠ çŒœæµ‹ã€‚
ä»»ä½•é—®é¢˜åº”æœ‰ä¸€ç§ï¼Œä¸”æœ€å¥½åªæœ‰ä¸€ç§ï¼Œæ˜¾è€Œæ˜“è§çš„è§£å†³æ–¹æ³•ã€‚
å°½ç®¡è¿™æ–¹æ³•ä¸€å¼€å§‹å¹¶éå¦‚æ­¤ç›´è§‚ï¼Œé™¤éä½ æ˜¯è·å…°äººã€‚
åšä¼˜äºä¸åšï¼Œ
ç„¶è€Œä¸å‡æ€ç´¢è¿˜ä¸å¦‚ä¸åšã€‚
å¾ˆéš¾è§£é‡Šçš„ï¼Œå¿…ç„¶æ˜¯åæ–¹æ³•ã€‚
å¾ˆå¥½è§£é‡Šçš„ï¼Œå¯èƒ½æ˜¯å¥½æ–¹æ³•ã€‚
å‘½åç©ºé—´æ˜¯ä¸ªç»å¦™çš„ä¸»æ„ï¼Œæˆ‘ä»¬åº”å¥½å¥½åˆ©ç”¨å®ƒã€‚
```

:::

### åŒ…å’Œæ¨¡å—
- `if __name__ == "__main__":` å¯ä»¥é¿å…åœ¨è¢«å¼•å…¥çš„æ—¶å€™ç›´æ¥è¢«æ‰§è¡Œä»£ç 
- åŸºæœ¬ä¿¡æ¯
    - `# -*-coding:utf-8-*-` æŒ‡æ˜æ–‡ä»¶çš„ç¼–ç 
    - `__author__ = "a_little_rubbish"`
    - `__date__ = "2022/5/19 18:06"`
- åŒ…/æ¨¡å—çš„å­˜æ”¾ä½ç½®ï¼š`print(xx.__file__)`
- æŸ¥çœ‹åŒ…/æ¨¡å—é‡Œçš„å†…å®¹ï¼š`print(dir(xx))`

æ­£åœ¨è¿è¡Œçš„æ–‡ä»¶ä¼šè¢«pythonæ·»åŠ åˆ°PATHä¸­å»  
- æ¨¡å—(module)å…¶å®å°±æ˜¯pyæ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰äº†ä¸€äº›å‡½æ•°ã€ç±»ã€å˜é‡ç­‰
- åŒ…(package)æ˜¯å¤šä¸ªæ¨¡å—çš„èšåˆä½“å½¢æˆçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å¯ä»¥æ˜¯å¤šä¸ªpyæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åµŒå¥—æ–‡ä»¶å¤¹
- åº“æ˜¯å‚è€ƒå…¶ä»–ç¼–ç¨‹è¯­è¨€çš„è¯´æ³•ï¼Œæ˜¯æŒ‡å®Œæˆä¸€å®šåŠŸèƒ½çš„ä»£ç é›†åˆï¼Œåœ¨pythonä¸­çš„å½¢å¼å°±æ˜¯æ¨¡å—å’ŒåŒ…
```python
import builtins  # å…¶å®å‘½åç©ºé—´å°±æ˜¯builtins
builtins.print("Hello world.")=print()
```
å¼•å…¥å°±è¦ç”¨importï¼Œimport fromï¼Œimport asã€‚  
å¯¼å…¥å…¶å®æ˜¯è¦å°† è¢«å¯¼å…¥æ¨¡å—æ‰€æœ‰çš„é¡¶æ ¼ä»£ç éƒ½æ‰§è¡Œä¸€éï¼Œé‡åˆ°å‡½æ•°å’Œç±»çš„å®šä¹‰ä¼šä½œç”³æ˜ã€‚  
æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ª`__init__.py`æ–‡ä»¶é‡Œé¢å¯ä»¥ä»€ä¹ˆéƒ½ä¸å¡«ï¼Œå°±è¢«pythonå½“æˆåŒ…python3.3+å¯ä»¥çœç•¥ä½†æ˜¯ä¸å»ºè®®ã€‚  
æ­£å¸¸importäº†å•¥ä¸œè¥¿æ‰å¯ä»¥ç”¨å•¥ï¼Œé™¤é`import *` ä½†æ˜¯importåŒ…ä¹‹åå¯ä»¥ç›´æ¥è°ƒç”¨åœ¨`__init__.py`æ–‡ä»¶æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæƒ³è¦å¯¼å…¥åç›´æ¥å‡ºç°åœ¨å‘½åç©ºé—´çš„åŒ…å†…å˜é‡æå‰å¯¼å…¥initä½¿ç”¨`from . import åŒ…ä¸­çš„æ¨¡å—`å¯ä¿è¯ç§»æ¤æ€§  
`import *`çš„æ–¹å¼æ— æ³•å¯¼å…¥ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„å˜é‡åï¼Œä½†å¯ä»¥æŒ‡å®šå˜é‡å¯¼å…¥  
`import *`åªä¼šå¯¼å…¥`__all__=[variableï¼Œvalriable]`ä¸­æŒ‡å®šçš„å˜é‡ï¼Œæ— è®ºæ˜¯å¦ä»¥ä¸‹åˆ’çº¿å¼€å¤´ï¼Œè¿™æ ·é™åˆ¶å¯ä»¥é˜²æ­¢`import *`å‘½ä»¤å¯¼å…¥å¤ªå¤šå˜é‡æ±¡æŸ“å‘½åç©ºé—´  

PATHæœç´¢é¡ºåº
- pycharm marked as source rootå‘Šè¯‰IDE[ç¼–è¯‘å™¨](https://so.csdn.net/so/search?q=%E7%BC%96%E8%AF%91%E5%99%A8&spm=1001.2101.3001.7020)æ­¤æ–‡ä»¶å¤¹åŠå…¶å­æ–‡ä»¶å¤¹åŒ…å«åº”ä½œä¸ºæ„å»ºè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†è¿›è¡Œç¼–è¯‘çš„æºä»£ç ã€‚
    - å°±å¯ä»¥ä»è¿™ä¸‹é¢æ‰¾åŒ…äº†
-   é¦–å…ˆæœå¯»å†…ç½®æ¨¡å—æ˜¯å¦æœ‰`hello`ï¼ˆæ‰€ä»¥æˆ‘ä»¬å®šä¹‰çš„æ¨¡å—åä¸è¦å’Œå†…ç½®æ¨¡å—ç›¸åŒï¼‰
-   å¦‚æœå†…ç½®æ¨¡å—æ²¡æœ‰ï¼Œåˆ™çœ‹PATH(å³`sys.path`)é‡Œæœ‰æ²¡æœ‰
    - `''`è¡¨ç¤ºå½“å‰çš„å·¥ä½œè·¯å¾„
    - ç¯å¢ƒå˜é‡PYTHONPATHä¸­æŒ‡å®šçš„è·¯å¾„åˆ—è¡¨
        - æ­£åœ¨è¿è¡Œçš„æ–‡ä»¶ä¼šè¢«pythonæ·»åŠ åˆ°PATHä¸­å»
    - ç‰¹å®šè·¯å¾„ä¸‹çš„.pthæ–‡ä»¶ä¸­æŒ‡å®šçš„è·¯å¾„åˆ—è¡¨ 
        - Python åœ¨éå†å·²çŸ¥çš„åº“æ–‡ä»¶ç›®å½•è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ° `.pth` æ–‡ä»¶ï¼Œä¾¿ä¼šå°†å…¶ä¸­çš„è·¯å¾„åŠ å…¥åˆ° `sys.path` ä¸­
        - ä¸€è¡Œä¸€ä¸ªï¼Œå¯ç©ºè¡Œå¯æ³¨é‡Šï¼Œç›¸å¯¹è·¯å¾„æ˜¯æœ¬.pthæ–‡ä»¶çš„ä½ç½®ä¸ºèµ·å§‹
    - åœ¨pythonå®‰è£…è·¯å¾„çš„libåº“ä¸­æœç´¢
- ç»å¯¹å¼•ç”¨ä»åŒ…çš„ä½ç½®å¼€å§‹
- ç›¸å¯¹è·¯å¾„å¯¼å…¥æ—¶
â€‹ è‡ªå®šä¹‰æ¨¡å—å’Œéå†…ç½®æ¨¡å—é‡åï¼šæŒ‰sys.pathè·¯å¾„ï¼Œä¼˜å…ˆçº§é«˜çš„è¦†ç›–ä½çš„ã€‚
â€‹ è‡ªå®šä¹‰æ¨¡å—å’Œå†…ç½®æ¨¡å—é‡åï¼šå†…ç½®æ¨¡å—è¦†ç›–è‡ªå®šä¹‰æ¨¡å—ã€‚


**ç¬¬ä¸€æ¬¡å¯¼å…¥æ—¶**ï¼š  
â€‹ 1ã€åœ¨æ‰€å¯¼çš„æ¨¡å—ä¸‹çš„å‘½åç©ºé—´ä¸­æ‰§è¡Œæ‰€æœ‰ä»£ç ï¼›
â€‹ 2ã€åˆ›å»ºä¸€ä¸ªmoduleå¯¹è±¡ï¼Œå¹¶å°†æ¨¡å—å†…æ‰€æœ‰çš„é¡¶çº§å˜é‡ä»¥å±æ€§çš„å½¢å¼ç»‘å®šåˆ°è¯¥å¯¹è±¡ä¸Šï¼›
â€‹ 3ã€åœ¨importè¯­å¥æ‰€å¤„çš„å‘½åç©ºé—´å¼•å…¥ç¬¬2æ­¥åˆ›å»ºçš„moduleå¯¹è±¡çš„å˜é‡åç§°ã€‚  
**ç¬¬äºŒæ¬¡å¯¼å…¥æ—¶**ï¼šç›´æ¥æ‰§è¡Œç¬¬3æ­¥ã€‚ï¼ˆ1ã€2æ­¥åˆ›å»ºçš„moduleå¯¹è±¡æ”¾åˆ°`sys.modules`é‡Œäº†ï¼‰  
**äº’ç›¸å¯¼å…¥**:  ä¸ä¼šåƒé€’å½’ä¸€æ ·æ­»å¾ªç¯ï¼Œå› ä¸ºimportçš„æ¨¡å—å¯¹è±¡åªåˆ›å»ºä¸€éï¼Œä¸ä¼šå†å»æ‰§è¡Œç¬¬äºŒéã€‚  


-   `from folder1.abcd import b`å…¶å®ä¹Ÿæ‰§è¡Œäº†`__init__.py`æ–‡ä»¶æ–‡ä»¶ä¸`abcd.py`æ–‡ä»¶
    - å®é™…ä¸Šæ˜¯importäº†ä¸¤æ¬¡ï¼Œç¬¬äºŒæ¬¡æ£€æŸ¥`sys.modules`å°±å¿½ç•¥äº†
- å¦‚æœimportè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„å­æ–‡ä»¶ä¸‹çš„æŸä¸ªæ¨¡å—æ—¶ï¼Œåˆ™å…ˆæŒ‰é¡ºåºæ‰§è¡Œçˆ¶æ–‡ä»¶å¤¹çš„æ‰€æœ‰`__init__.py`ï¼Œå†æ‰§è¡Œè¯¥æ–‡ä»¶çš„`__init__.py`ï¼Œå†æ‰§è¡Œè¯¥æ¨¡å—  

`help(module)`æŸ¥çœ‹æ¨¡å—çš„å¸®åŠ©æ‰‹å†Œ  
åœ¨pythonçš„ç›®å½•ä¸‹æœ‰Docæ–‡ä»¶å¤¹æœ‰è¯­è¨€ä½¿ç”¨æ‰‹å†Œ  
```python
try:
    import other_1 as o # æœ‰1å¯¼1
except ModuleNotFoundError:
    import other_2 as o # æ²¡1å¯¼2

```
![800](./static/pythonè¯­è¨€è¿›é˜¶-images-1.png)<br/>
[^1]

#### å¾ªç¯å¯¼å…¥

![](./static/pythonè¯­è¨€è¿›é˜¶-images-2.png)
æ­¤æ—¶`from test2 import c`æŠ¥é”™ ï¼Œå…ˆå¼•ç”¨testä¹‹åå°±ä¸ä¼šäº†  
1.  å¼•ç”¨`test2/c`æ¨¡å—
2.  ç”±äºæ˜¯ç¬¬ä¸€æ¬¡å¼•ç”¨`test2/c`æ¨¡å—ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œ`test2/c.py`æ–‡ä»¶ï¼Œæ­¤æ—¶ä¼šæ‰§è¡Œ`from test import a`
3.  æ­¤æ—¶æ‰§è¡Œäº†åŒ…`test/__init__.py`çš„ä»£ç ï¼Œæ‰§è¡Œäº†`from . import b`ï¼Œå¼•ç”¨äº†æ¨¡å—`test/b`
4.  æ¨¡å—`test/b`ç”±äºæ˜¯ç¬¬ä¸€æ¬¡è¢«å¼•ç”¨ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„ä»£ç ï¼Œæ‰§è¡Œ`from test2 import c`ï¼Œå¾ªç¯å¼•ç”¨å‡ºç°ï¼ŒæŠ¥é”™
5. åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆå…ˆå¼•å…¥testå°±æ²¡å…³ç³»äº†  

åœ¨å¼•å…¥æ²¡æœ‰å®Œæˆçš„æ—¶å€™ï¼Œåˆå›æ¥äº†å°±äº§ç”Ÿé”™è¯¯ï¼Œå¦‚æœå·²ç»å¼•å…¥å®Œäº†ï¼Œå°±æ²¡äº‹å’Œä¸Šé¢**äº’ç›¸å¯¼å…¥**ç»“åˆçœ‹  
### os
[å…ˆæ”¾æ–‡æ¡£](https://docs.python.org/3.9/library/os.html)  
osæ˜¯å’Œæ“ä½œç³»ç»Ÿç›¸å…³çš„åŒ…ï¼Œé‡Œé¢æœ‰å¯¹æ–‡ä»¶å¤¹å’Œç³»ç»Ÿä¿¡æ¯çš„è°ƒç”¨ï¼Œè¿™é‡Œæ•´ç†ä¸€ç‚¹å¸¸ç”¨çš„  
å’Œlinuxé‡Œé¢çš„å‘½ä»¤ä¸€æ ·çš„æˆ‘å°±ç®€å•æ”¾ä¸€ä¸‹  
`os.rename`,`os.mkdir[s]`,`os.rmove`,`os.chdir`ï¼Œ`os.chmod(_path_, 755ï¼‰`,`os.getcwd()`,`os.chcwd()`,`os.chown(_path_, _uid_, _gid_)`,`os.listdir(path='.')`,`os.removedirs(_name_)`,`os.rmdir`
| å‡½æ•°å˜é‡                    | ä½œç”¨                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|:--------------------------- |:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `os.name`                     | å¯¼å…¥çš„ä¾èµ–ç‰¹å®šæ“ä½œç³»ç»Ÿçš„æ¨¡å—çš„åç§°ã€‚ä»¥ä¸‹åç§°ç›®å‰å·²æ³¨å†Œ:`posix`,`nt`,`java`.                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `os.cpu_count()`              | è¿”å›cpuå†…æ ¸æ•°                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `os.walk(top, topdown=True)`  | éå†æ–‡ä»¶å¤¹è¿”å›`dirpath, dirnames, filenames`                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `os.curdir`                 | æ“ä½œç³»ç»Ÿç”¨æ¥è¡¨ç¤ºå½“å‰ç›®å½•çš„å¸¸é‡å­—ç¬¦ä¸²                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `os.pardir`                 | æ“ä½œç³»ç»Ÿç”¨æ¥è¡¨ç¤ºçˆ¶ç›®å½•çš„å¸¸é‡å­—ç¬¦ä¸²                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `os.sep`                    | æ“ä½œç³»ç»Ÿç”¨æ¥åˆ†éš”è·¯å¾„ä¸åŒéƒ¨åˆ†çš„å­—ç¬¦ã€‚åœ¨ POSIX ä¸Šæ˜¯ `'/'`ï¼Œåœ¨ Windows ä¸Šæ˜¯æ˜¯ `'\\'`ã€‚<br/>æ³¨æ„ï¼Œä»…äº†è§£å®ƒä¸è¶³ä»¥èƒ½è§£ææˆ–è¿æ¥è·¯å¾„ï¼Œè¯·ä½¿ç”¨ [`os.path.split()`](https://docs.python.org/zh-cn/3.9/library/os.path.html#os.path.split "os.path.split") å’Œ [`os.path.join()`](https://docs.python.org/zh-cn/3.9/library/os.path.html#os.path.join "os.path.join")ï¼Œ<br/>ä½†å®ƒæœ‰æ—¶æ˜¯æœ‰ç”¨çš„ã€‚åœ¨ [`os.path`](https://docs.python.org/zh-cn/3.9/library/os.path.html#module-os.path "os.path: Operations on pathnames.") ä¸­ä¹Ÿå¯ç”¨ã€‚ |
| `os.altsep`                 | æ“ä½œç³»ç»Ÿç”¨æ¥åˆ†éš”è·¯å¾„ä¸åŒéƒ¨åˆ†çš„æ›¿ä»£å­—ç¬¦ã€‚<br/>å¦‚æœä»…å­˜åœ¨ä¸€ä¸ªåˆ†éš”ç¬¦ï¼Œåˆ™ä¸º `None`ã€‚<br/>åœ¨ `sep` æ˜¯åæ–œæ çš„ Windows ç³»ç»Ÿä¸Šï¼Œè¯¥å€¼è¢«è®¾ä¸º `'/'`ã€‚åœ¨ [`os.path`](https://docs.python.org/zh-cn/3.9/library/os.path.html#module-os.path "os.path: Operations on pathnames.") ä¸­ä¹Ÿå¯ç”¨ã€‚                                                                                                                                                                                                                                       |
| `os.extsep`                 | åˆ†éš”åŸºæœ¬æ–‡ä»¶åä¸æ‰©å±•åçš„å­—ç¬¦ï¼Œ<br/>å¦‚ `os.py` ä¸­çš„ `'.'`ã€‚åœ¨ [`os.path`](https://docs.python.org/zh-cn/3.9/library/os.path.html#module-os.path "os.path: Operations on pathnames.") ä¸­ä¹Ÿå¯ç”¨ã€‚                                                                                                                                                                                                                                                                                                                   |
| `os.pathsep`                | æ“ä½œç³»ç»Ÿé€šå¸¸ç”¨äºåˆ†éš”æœç´¢è·¯å¾„<br/>ï¼ˆå¦‚ `PATH`ï¼‰ä¸­ä¸åŒéƒ¨åˆ†çš„å­—ç¬¦ï¼Œ<br/>å¦‚ POSIX ä¸Šæ˜¯ `':'`ï¼ŒWindows ä¸Šæ˜¯ `';'`ã€‚åœ¨ [`os.path`](https://docs.python.org/zh-cn/3.9/library/os.path.html#module-os.path "os.path: Operations on pathnames.") ä¸­ä¹Ÿå¯ç”¨ã€‚                                                                                                                                                                                                                                                                    |
| `os.linesep`                | å½“å‰å¹³å°ç”¨äºåˆ†éš”ï¼ˆæˆ–ç»ˆæ­¢ï¼‰è¡Œçš„å­—ç¬¦ä¸²ã€‚<br/>å®ƒå¯ä»¥æ˜¯å•ä¸ªå­—ç¬¦ï¼Œå¦‚ POSIX ä¸Šæ˜¯ `'\n'`ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªå­—ç¬¦ï¼Œå¦‚ Windows ä¸Šæ˜¯ `'\r\n'`ã€‚<br/>åœ¨å†™å…¥ä»¥æ–‡æœ¬æ¨¡å¼ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰æ‰“å¼€çš„æ–‡ä»¶æ—¶ï¼Œè¯·ä¸è¦ä½¿ç”¨ _os.linesep_ ä½œä¸ºè¡Œç»ˆæ­¢ç¬¦ï¼Œ<br/>è¯·åœ¨æ‰€æœ‰å¹³å°ä¸Šéƒ½ä½¿ç”¨ä¸€ä¸ª `'\n'` ä»£æ›¿ã€‚                                                                                                                                                                                                                                                            |
| `os.devnull`                | ç©ºè®¾å¤‡çš„æ–‡ä»¶è·¯å¾„ã€‚<br/>å¦‚ POSIX ä¸Šä¸º `'/dev/null'`ï¼ŒWindows ä¸Šä¸º `'nul'`ã€‚åœ¨ `os.path`ä¸­ä¹Ÿå¯ç”¨ã€‚                                                                                                                                                                                                                                                                                                                                                                                                                 |

#### os.path
[os.path](https://docs.python.org/zh-cn/3/library/os.path.html)æ¨¡å—æ˜¯å’Œè·¯å¾„ç›¸å…³çš„æ¨¡å—

|           å‡½æ•°å’Œå˜é‡            |                                                                                                                                    åŠŸèƒ½                                                                                                                                    |
|:-------------------------------:|:--------:|
|     `os.path.abspath(PATH)`     |è·å–ç»å¯¹è·¯å¾„ |
|       `os.path.split(f)`        |åˆ†å‰²è·¯å¾„æ–‡ä»¶å  |
|      `os.path.splitext(f)`      |åˆ†å‰²æ–‡ä»¶åç¼€å |
|`os.path.dirname`|è¿”å›è·¯å¾„å|
|   `os.path.basename(_path_)`    |è·å¾—æ–‡ä»¶/æœ€åè·¯å¾„å<br/>æ­¤å‡½æ•°çš„ç»“æœä¸Unix **basename** ç¨‹åºä¸åŒã€‚<br/>**UNIX basename** <br/>åœ¨ `'/foo/bar/'` ä¸Šè¿”å› `'bar'`ï¼Œè€Œ<br/> [`os.path.basename()`](https://docs.python.org/zh-cn/3/library/os.path.html#os.path.basename "os.path.basename") å‡½æ•°è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸² (`''`) |
| `os.path.commonpath(_paths_)` |æ¥å—åŒ…å«å¤šä¸ªè·¯å¾„çš„åºåˆ— _paths_ï¼Œè¿”å› _paths_ çš„æœ€é•¿å…¬å…±å­è·¯å¾„ã€‚  |
| `os.path.commonprefix(_list_)`     |  æ¥å—åŒ…å«å¤šä¸ªè·¯å¾„çš„ _åˆ—è¡¨_ï¼Œè¿”å›æ‰€æœ‰è·¯å¾„çš„æœ€é•¿å…¬å…±å‰ç¼€ï¼ˆé€å­—ç¬¦æ¯”è¾ƒï¼‰|
|`os.path.join(_path_, _*paths_)`|æ™ºèƒ½åœ°æ‹¼æ¥ä¸€ä¸ªæˆ–å¤šä¸ªè·¯å¾„éƒ¨åˆ†ã€‚ è¿”å›å€¼æ˜¯ _path_ å’Œ _*paths_ çš„æ‰€æœ‰æˆå‘˜çš„æ‹¼æ¥|
|isdir,isfile,isabs,islink,exists,ismount|åˆ¤æ–­æ˜¯å•¥|
#### å†…ç½®çš„å˜é‡
- `vars()` ä»¥å­—å…¸æ–¹å¼è¿”å›å†…ç½®å…¨å±€å˜é‡
- `__doc__` è·å–æ–‡ä»¶å¼€å¤´çš„æ³¨é‡Š
- `__file__`å®Œæ•´çš„æ–‡ä»¶å’Œè·¯å¾„å
- `__package__`è·å–å¯¼å…¥æ–‡ä»¶çš„è·¯å¾„ï¼Œå¤šå±‚ç›®å½•ä»¥ç‚¹åˆ†å‰²ï¼Œæ³¨æ„ï¼šå¯¹å½“å‰æ–‡ä»¶è¿”å›None
- `__cached__` è·å–å¯¼å…¥æ–‡ä»¶çš„ç¼“å­˜è·¯å¾„
- `__name__` è·å–å¯¼å…¥æ–‡ä»¶çš„è·¯å¾„åŠ æ–‡ä»¶åç§°ï¼Œè·¯å¾„ä»¥ç‚¹åˆ†å‰²ï¼Œæ³¨æ„:è·å–å½“å‰æ–‡ä»¶è¿”å›__main__

### sys
[æ–‡æ¡£](https://docs.python.org/zh-cn/3/library/sys.html)ï¼Œè¿™é‡Œé¢æ˜¯å’Œè§£é‡Šå™¨è¿è¡Œç›¸å…³çš„ä¸œè¥¿  
|             å‡½æ•°å’Œå˜é‡             |                                                                        åŠŸèƒ½                                                                        |
|:----------------------------------:|:--------------------------------------------------------------------------------------------------------------------------------------------------:|
|   `sys.getfilesystemencoding()`    |                                                                  è·å–æ–‡ä»¶ç³»ç»Ÿç¼–ç                                                                   |
|     `sys.getdefaultencoding()`     |                                                    å½“å‰ Unicode å®ç°æ‰€ä½¿ç”¨çš„é»˜è®¤å­—ç¬¦ä¸²ç¼–ç åç§°                                                     |
|          `sys.copyright`           |                                                                æ‰“å°pythonçš„ç‰ˆæƒä¿¡æ¯                                                                |
|             `sys.argv`             |                                                     è¿”å›è¿è¡Œçš„å‚æ•°åˆ—è¡¨ï¼Œ`sys.argv[0]`æ˜¯è„šæœ¬å                                                      |
|           `sys.version`            |                                                                    è·å–pyç‰ˆæœ¬å·                                                                    |
|           `sys.maxsize`            |                                                              æœ¬ç³»ç»Ÿèƒ½è¡¨ç¤ºçš„intæœ€å¤§å€¼                                                               |
|             `sys.path`             |                                                                    è·å–ç³»ç»Ÿè·¯å¾„                                                                    |
|           `sys.platform`           |                                                                  è·å–pythonçš„å¹³å°                                                                  |
|           `sys.exit(0)`            |                                                                   é€€å‡º(ç¨‹åºä»£ç )                                                                   |
|          `sys.executable`          |                                                              å½“å‰pythonè§£é‡Šå™¨ç»å¯¹è·¯å¾„                                                              |
|     `sys.getrecursionlimit()`      |                                                         å¯ä»¥é€’å½’çš„æœ€å¤§å±‚æ•°ï¼Œå¯ä»¥åœ¨é€’å½’é‡Œç”¨                                                         |
|     `sys.setrecursionlimit()`      |                                                                    è®¾å®šæœ€å¤§å±‚æ•°                                                                    |
|     `sys.getrefcount(object)`      |                           è¿”å› object çš„å¼•ç”¨è®¡æ•°ã€‚é€šå¸¸æ¯”é¢„æœŸçš„å¤šä¸€ï¼Œ<br/>å› ä¸ºåŒ…æ‹¬äº†getrefcount()å‚æ•°çš„è¿™ä¸€æ¬¡ï¼ˆä¸´æ—¶ï¼‰å¼•ç”¨                           |
|           `sys.modules`            |                                                              è¿”å›å·²ç»è¢«å¼•å…¥çš„æ¨¡å—åˆ—è¡¨                                                              |
| `sys.getsizeof(object[, default])` | è¿”å›å¯¹è±¡çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰,<br/>åªè®¡ç®—ç›´æ¥åˆ†é…ç»™å¯¹è±¡çš„å†…å­˜æ¶ˆè€—ï¼Œ<br/>ä¸è®¡ç®—å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜æ¶ˆè€—,<br/>å¯¹è±¡ä¸æä¾›è®¡ç®—å¤§å°çš„æ–¹æ³•æ—¶æŒ‡å®šdefault |
| `sys.stdin`                                   |             è·å–æ ‡å‡†è¾“å…¥æµï¼Œlistè½¬åŒ–ä¸€ä¸‹æ‰“å°å‡ºæ¥çœ‹çœ‹æ˜¯ä»€ä¹ˆ(ä¸€èˆ¬çš„é¡¹ç›®ä¸ä¼šç”¨åˆ°)                                                                                                                                       |



------------
## æ·±å…¥OOP
å¤šæ·±æ‰èƒ½å«æ·±å…¥å‘¢ï¼Ÿ  
ä¿æŒè°¦æŠ‘  
### pythonä¸­çš„ä¸€åˆ‡çš†å¯¹è±¡
pythonæ¯”javaçš„ä¸€åˆ‡çš†å¯¹è±¡æ›´åŠ å½»åº•ï¼Œæ‰€ä»¥æ›´åŠ çµæ´»ï¼Œå…¶çµæ´»æ€§å°±æ˜¯é è¿™å®ç°çš„  
javaä¸­Objectæ˜¯classçš„ä¸€ä¸ªå®ä¾‹ï¼Œä½†æ˜¯åœ¨pyä¸­**ç±»class**ä¹Ÿæ˜¯å¯¹è±¡ï¼Œ**å‡½æ•°**ï¼Œä»£ç å’Œæ¨¡å—ä¹Ÿæ˜¯å¯¹è±¡ã€‚éƒ½å¯ä»¥è¢«åŠ¨æ€çš„èµ‹å€¼ï¼Œæ‰€ä»¥æ‰ä¼šæœ‰pythonçš„è¿·æƒ‘æ“ä½œ[æˆ‘å†™æˆ‘è‡ªå·±](https://www.bilibili.com/video/BV1pU4y1m7kf)  
ä¸€åˆ‡éƒ½æ˜¯"ä¸€ç­‰å…¬æ°‘"æ„å‘³ç€å¯ä»¥  

1. èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡
2. å¯ä»¥æ·»åŠ åˆ°é›†åˆå¯¹è±¡ä¸­ 
3. å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°
4. å¯ä»¥å½“åšå‡½æ•°çš„è¿”å›å€¼ï¼ˆé—­åŒ…åŸç†ï¼‰

æŒ‰ç…§å†…å­˜æ¨¡å‹ç†è§£æ‰€æœ‰çš„**å˜é‡**éƒ½æ˜¯å½»åº•çš„â€œå¼•ç”¨â€ï¼ŒæŒ‡å‘å®é™…çš„å†…å­˜ï¼Œå˜é‡å¯ä»¥è¢«ä»»æ„å¼•ç”¨  
æ‰€ä»¥pythonä¸ç”¨å®ç°å¤šæ€ï¼Œé¸­å­å°±å·²ç»å¾ˆå¤šæ€äº†ã€‚pythonæ”¯æŒå¤šç»§æ‰¿ï¼Œå°è£…çš„æ³¨æ„åœ¨åŸºç¡€éƒ¨åˆ†æœ‰  
### ç±»çš„æºå¤´
æ¢³ç†ä¸€ä¸‹å…³ç³»  
typeæ˜¯å¯ä»¥åˆ›å»ºç±»çš„  
typeç±»ç”Ÿæˆäº†classï¼Œclassç”Ÿæˆäº†å¯¹è±¡ï¼Œ`type->class->otherObject`  
å†…ç½®ç±»å‹åŸºæœ¬éƒ½æ˜¯classç±»å‹ï¼Œtypeå¥—å¨ƒä¸¤æ¬¡è¿”å›çš„å°±æ˜¯typeç±»  
`type(type(int)) : <class 'type'>`  

`object`æ˜¯æ‰€æœ‰ç±»éƒ½è¦ç»§æ‰¿çš„é¡¶å±‚åŸºç±»ï¼Œ`class Class()`åé¢æ‹¬å·ä¸å†™ä¸œè¥¿é»˜è®¤ç»§æ‰¿é¡¶å±‚åŸºç±» psç°åœ¨åŠ ä¸åŠ éƒ½ä¸€æ ·ä½†æ˜¯æœ‰äº›äººçš„ä»£ç ä¼šæœ‰æ‰€åŒºåˆ†ï¼Œå› ä¸ºpy2ä¸­æ˜¯ä¸ä¸€æ ·  

![](./static/pythonè¯­è¨€è¿›é˜¶-images-3.png)

:::tip ğŸ“Note
**typeå’Œobjectçš„å…³ç³»**<br/>`type`æœ¬èº«æ—¢æ˜¯ç±»åˆæ˜¯å¯¹è±¡ï¼Œ`type`ç»§æ‰¿è‡ª`object`  
`object.__base__`è¿”å›æ˜¯()ç©º,è€Œ`type(object)`æ˜¯`type`ç±»å‹ 
  
ä¸Šå›¾ä¸­å¾ˆå¥‡æ€ªçš„ç‚¹ï¼Œä¹Ÿå°±æ˜¯pythonä¸­æœ‰ä¸¤ä¸ªç¥åŒæ—¶çº ç¼ å‡ºç°  
  
`type`çš„çˆ¶ç±»æ˜¯`type`å®ä¾‹åŒ–çš„ï¼Œç„¶è€Œ`type`ç»§æ‰¿äº†çˆ¶ç±»ï¼Œæ—¶é—´åœ¨æ­¤æ—¶æ¶ˆå¤±äº†ã€‚
ä»Cçš„è§’åº¦ç†è§£ï¼Œä¸€å¼€å§‹ç”³è¯·äº†ä¿©å†…å­˜å—ï¼Œå†å¼€å§‹è§£é‡Špython  
  
`type`æ­¤æ—¶å¯ä»¥å¼€å§‹æ„å»ºä¸‡ç‰©ï¼Œæ‰€æœ‰çš„ç±»ï¼Œå¯¹è±¡ï¼Œéƒ½æ˜¯ä»–æ´¾ç”Ÿçš„ï¼Œè‡ªå·±(ç±»)å®ä¾‹åŒ–ç”Ÿæˆè‡ªå·±(ç±»)  
ä»Cçš„è§’åº¦ç†è§£ï¼Œ`type`çš„æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå†…å­˜å—ï¼Œå†…å­˜å—è‡ªè¡Œå¤åˆ¶ä¸€æ¬¡å°±å¯ä»¥ã€‚

:::

### ç±»å±æ€§å’Œå®ä¾‹å±æ€§
#### å˜é‡æƒé™å‘½åè§„èŒƒ
`_`å¯ä»¥è®¿é—®ä½†ä¸å»ºè®®  
`__`ç§æœ‰å˜é‡ï¼ˆprivateï¼‰ä¸èƒ½ç›´æ¥è®¿é—®`__name`æ˜¯å› ä¸ºPythonè§£é‡Šå™¨å¯¹å¤–æŠŠ`__name`å˜é‡æ”¹æˆäº†`ClassName._ClassName__name`  
`__xxx__`æ˜¯ç‰¹æ®Šå˜é‡ã€‚  

#### å˜é‡æŸ¥æ‰¾é¡ºåº

^5e3db7

å¤§è‡´æ˜¯<span style="background:greenyellow">ç”±ä¸‹è€Œä¸ŠæŸ¥æ‰¾</span>
ä¼˜å…ˆæŸ¥æ‰¾ **å¯¹è±¡** å˜é‡ï¼Œæ‰¾ä¸åˆ°å°±å‘ä¸ŠæŸ¥æ‰¾ **ç±»** å˜é‡ã€‚  
ä¿®æ”¹ **å¯¹è±¡** çš„ **ç±»å˜é‡** æ—¶ä¸ä¼šæ›´æ”¹ **ç±»** çš„ **ç±»å˜é‡** ï¼Œåªæ˜¯ç»™å¯¹è±¡è‡ªå·±æ·»åŠ äº†ä¸€ä¸ª **å¯¹è±¡å˜é‡** è¦†ç›–äº† **ç±»å˜é‡** ï¼Œæ‰€ä»¥å…¶ä»–å¯¹è±¡å’Œç±»çš„ **ç±»å˜é‡** ä¸å˜  
  
ä¿®æ”¹ **ç±»å˜é‡** çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ **å¯¹è±¡** çš„ **å˜é‡** éƒ½å˜ï¼Œå› ä¸ºç±»å˜é‡æ˜¯å…±äº«çš„  
å­ç±»ä¿®æ”¹äº†ç±»å˜é‡æ—¶åªæœ‰å­ç±»é“¾æ¡ä¸‹ç”Ÿæ•ˆ  


#### å¤šç»§æ‰¿ä¸‹æœç´¢
åœ¨å•ç»§æ‰¿è¿™æ ·å°±å¤Ÿäº†ï¼Œä½†æ˜¯å¤šç»§æ‰¿å°±å¯„äº†ã€‚  
pyçš„**æ–¹æ³•è§£æé¡ºåº**ï¼ˆMethod Resolution Orderï¼Œ**MRO**ï¼‰ä½¿ç”¨çš„æ˜¯C3ç®—æ³•ï¼Œpython2.3å‰ä½¿ç”¨çš„æ˜¯DFSæˆ–BFSï¼Œä½†æ˜¯è¿™æ ·æ— æ³•è§£å†³è±å½¢ç»§æ‰¿  
C3ç®—æ³•å®ç°äº†ä¸‰ç§é‡è¦ç‰¹æ€§ï¼š
-   ä¿æŒç»§æ‰¿[æ‹“æ‰‘å›¾](https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/w/index.php%3Ftitle%3D%25E6%258B%2593%25E6%2589%2591%25E5%259B%25BE%26action%3Dedit%26redlink%3D1)çš„ä¸€è‡´æ€§ã€‚
-   ä¿è¯å±€éƒ¨ä¼˜å…ˆåŸåˆ™ï¼ˆæ¯”å¦‚A-->C-->Bï¼Œé‚£ä¹ˆAè¯»å–çˆ¶ç±»æ–¹æ³•ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨Cçš„æ–¹æ³•è€Œä¸æ˜¯Bçš„æ–¹æ³•ï¼‰ã€‚
-   ä¿è¯å•è°ƒæ€§åŸåˆ™ï¼ˆå³å­ç±»ä¸æ”¹å˜çˆ¶ç±»çš„æ–¹æ³•æœç´¢é¡ºåºï¼‰ã€‚

ç±»çš„`__mro__`å±æ€§æˆ–`mro()`æ–¹æ³•å¯ä»¥ç›´æ¥æŸ¥çœ‹æœç´¢é¡ºåºï¼ŒC3ä¼šæŒ‰ç…§å¤šç»§æ‰¿çš„å‚æ•°é¡ºåºè¿›è¡Œæœç´¢ã€‚ä¸‰è§’ç»§æ‰¿ä¼šç›´æ¥æŠ¥é”™æ— æ³•è¿›è¡Œmro
![|700](./static/pythonè¯­è¨€è¿›é˜¶-images-4.png)

### æ„é€ ææ„
#### å®ä¾‹æ–¹æ³•
ä¸€èˆ¬çš„æ–¹æ³•éƒ½æ˜¯å®ä¾‹æ–¹æ³•ï¼Œåªé’ˆå¯¹å®ä¾‹è¿›è¡Œæ“ä½œï¼Œä¼šä¼ å…¥selfï¼Œ`cls.func()`è°ƒç”¨çš„æ—¶å€™ï¼Œpythonä¼šè‡ªåŠ¨è½¬æˆ`func(cls)`  
#### é™æ€æ–¹æ³•
å¯¹è±¡æ„é€ å‰å¤„ç†è¾“å…¥ï¼Œå¯¹è±¡è¿˜æ²¡æœ‰æ„é€ å‡ºæ¥ï¼Œæ¯æ¬¡éƒ½è¦å¤„ç†ä¸æ˜¯å¾ˆè§„èŒƒ  
ä½¿ç”¨è£…é¥°å™¨`@staticmethod`  
åœ¨ç±»ä¸­å®šä¹‰æ–¹æ³•ï¼Œä¸éœ€è¦ä¼ å…¥selfï¼Œå¯ä»¥é€šè¿‡ç±»ç›´æ¥è°ƒç”¨ï¼Œå¥½å¤„æ˜¯å°†å‘½åç©ºé—´å’Œå¤„ç†æ‹¿åˆ°äº†ç±»é‡Œé¢å»ï¼Œå¯ä»¥ç›´æ¥è¿”å›å¯¹è±¡ã€‚  
åå¤„å°±æ˜¯ç±»åæ˜¯ç¡¬ç¼–ç ï¼Œä¿®æ”¹ç±»åçš„æ—¶å€™éœ€è¦å»ä¿®æ”¹ï¼Œå¦‚æœåªæ˜¯å¤„ç†å’Œåˆ¤æ–­æ˜¯å¦è§„èŒƒï¼Œä¸éœ€è¦è¿”å›å¯¹è±¡ï¼Œå°±å¯ä»¥ç”¨é™æ€æ–¹æ³•  
æ‰€ä»¥åœ¨è¿™ç§åŠ¨æ€çš„æ„é€ éœ€æ±‚ä¸‹ï¼Œå°±éœ€è¦ç”¨ç±»æ–¹æ³•`@classmethod`  
ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºclsï¼Œä»£è¡¨ç±»æœ¬èº«ã€‚  
:::details Click to see more

```python
class Dates:  # å‡è®¾è¦æ‹¿åˆ°æ—¶é—´  
    def __init__(self, yy, mm, dd):  
        self.yy = yy  
        self.mm = mm  
        self.dd = dd  
  
    def __str__(self):  
        return "{yy}å¹´,{mm}æœˆ,{dd}æ—¥".format(yy=self.yy, mm=self.mm, dd=self.dd)  
  
    @staticmethod  # é™æ€æ–¹æ³•è£…é¥°å™¨  
    def test_string(string):  # ä¸ç”¨ä¼ å…¥selfç­‰  
        # l = string.split("-")  
        # return Dates(l[0], l[1], l[2]) # ç¡¬ç¼–ç åˆ›å»º  
        try:  
            l = string.split("-")  
            for i in l:  
                int(i)  
            return True  
        except Exception as e:  
            return False  
  
    @classmethod  # ç±»æ–¹æ³•è£…é¥°å™¨  
    def create_from_string(cls, string):  # ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºcls  
        l = string.split("-")  
        return cls(l[0], l[1], l[2])  # åŠ¨æ€åˆ›å»º  
  
  
d1 = Dates(21, 2, 3)  
print(d1)  
check = Dates.test_string("21-2-3")  
d2 = Dates.create_from_string("21-2-4")  
print(d2, check)  
  
print("------------")  
  
  
class MordenDate(Dates): # æ˜¯å¯ä»¥ç»§æ‰¿çš„  
  
    morden = 1  
  
    @staticmethod  # é™æ€æ–¹æ³•è£…é¥°å™¨  
    def test_string(string):  # ç»§æ‰¿ä¹‹å  
        print("I am a ModernDate")  
        try:  
            l = string.split("-")  
            for i in l:  
                int(i)  
            return True  
        except Exception as e:  
            return False  
  
md1 = MordenDate(22, 5, 3)  
print(md1)  
mcheck = MordenDate.test_string("22-5-8")  
md2 = MordenDate.create_from_string("22-5-8")  
excheck=isinstance(md2,MordenDate) # ç»§æ‰¿åæ˜¯å¦åŠ¨æ€åˆ›å»º  
print(md2,excheck, mcheck)
```
è¿è¡Œç»“æœ
```
21å¹´,2æœˆ,3æ—¥
21å¹´,2æœˆ,4æ—¥ True
------------
22å¹´,5æœˆ,3æ—¥
I am a ModernDate
22å¹´,5æœˆ,8æ—¥ True True
```
:::

#### `__new__`å’Œ`__init__`
 ^e46b78
  
`__new__`çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»æœ¬èº«ï¼Œè€Œ`__init__`ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯å¯¹è±¡æœ¬èº«ï¼Œnewæ˜¯ç®¡å¯¹è±¡ç”Ÿæˆå‰çš„åŠ¨ä½œï¼Œinitæ˜¯å®Œå–„å¯¹è±¡æœ¬èº«  
newä¼šé€šè¿‡å¯å˜å‚æ•°æå‰è·å–åˆ°åˆå§‹åŒ–ä¼ å…¥çš„å±æ€§ï¼Œå¿…é¡»return`super().__new__(cls)`å›å»ï¼Œä¸ç„¶æ²¡æ³•è°ƒç”¨initç»§ç»­åˆ›å»º  
```python
class A():  
    def __new__(cls, *args, **kwargs):  # ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å‘çš„æ˜¯ç±»æœ¬èº«  
        print("new...")  
        return super().__new__(cls) # æ³¨æ„è¿”å›ä»€ä¹ˆ  
    def __init__(self,name):  
        print("Initializing...")  
        self.name=name  
a=A(name="hhh")

#----ç»“æœ----
new...
Initializing...
```
ä¸»è¦æ˜¯åœ¨å…ƒç±»ç¼–ç¨‹ä¸­ç”¨çš„å¤š

#### ææ„å‡½æ•°
- delæœ¬è´¨ä¸Šè°ƒç”¨çš„æ˜¯`__del__`åˆ é™¤çš„
    - å¯ä»¥é‡è½½æ¯”å¦‚åˆ é™¤æ—¶é‡Šæ”¾èµ„æº

#### å®šåˆ¶å±æ€§
å®šåˆ¶å±æ€§ä½¿ç”¨slots ^144b67

ç±»åœ¨åŠ¨æ€æ·»åŠ å±æ€§çš„æ—¶å€™ï¼Œç»™classç»‘å®šæ–¹æ³•åï¼Œæ‰€æœ‰å®ä¾‹å‡å¯è°ƒç”¨ï¼Œæˆ‘ä»¬ä¸æƒ³è®©ä»–ä¹±æ·»åŠ ï¼Œå¯ä»¥ç”¨`__slots__`æŒ‡å®šï¼Œç¿»è¯‘è¿‡æ¥æ˜¯æ’æ§½å¾ˆå¥½ç†è§£  
```python
class Student:  
    __slots__ = ('name', 'age')  
s=Student()  
s.name="aba"  
print(s.name)  
s.value="ss"
#----ç»“æœ----
aba
Traceback (most recent call last):
  File "slots.py", line 7, in <module>
    s.value="ss"
AttributeError: 'Student' object has no attribute 'value'
```

### è‡ªçœ(åå°„)æœºåˆ¶
åå°„çš„æ¦‚å¿µæ˜¯ç”±Smithåœ¨1982å¹´é¦–æ¬¡æå‡ºçš„ï¼Œä¸»è¦æ˜¯æŒ‡ç¨‹åºå¯ä»¥è®¿é—®ã€æ£€æµ‹å’Œä¿®æ”¹å®ƒæœ¬èº«çŠ¶æ€æˆ–è¡Œä¸ºçš„ä¸€ç§èƒ½åŠ›ã€‚
[å˜é‡æŸ¥æ‰¾é¡ºåº](#^5e3db7)  
ä½¿ç”¨`obj.__dict__`æŸ¥çœ‹<span style="background:greenyellow">å¯¹è±¡</span>æ‰€æœ‰çš„å±æ€§,æ­¤æ—¶å‘ç°ç±»å’Œçˆ¶ç±»ä¸­çš„å±æ€§éƒ½æ²¡æœ‰å‡ºç°ï¼Œå› ä¸ºä»–æ˜¯ä¹‹æŸ¥çœ‹è¿™ä¸ªå¯¹è±¡çš„ã€‚  
æŸ¥çœ‹ **ç±»å¯¹è±¡** çš„å±æ€§ï¼ŒåŒæ—¶å¯ä»¥å½“å­—å…¸å–å‡ºå±æ€§  
ä¹‹æ‰€ä»¥èƒ½è°ƒç”¨å°±æ˜¯MROåšçš„  
ä½¿ç”¨`__dict__`å¯ä»¥æŸ¥çœ‹ç”šè‡³ä¿®æ”¹å·²æœ‰çš„å±æ€§æ·»åŠ æ–°çš„ï¼Œ<span style="background:greenyellow">åªæœ‰å¯¹è±¡å®ä¾‹æ‰èƒ½æ·»åŠ </span>ï¼Œç»™ç±»æ·»åŠ è¢«è§£é‡Šå™¨é˜»æ­¢äº†  
ä½¿ç”¨`dir(obj)`å¯ä»¥åˆ—å‡ºæ‰€æœ‰å±æ€§ï¼ŒåŒ…æ‹¬ç±»ç³»ç»Ÿå†…å»ºçš„ï¼Œä½†æ˜¯æ²¡æœ‰å€¼åªæœ‰åç§°  
ä¸€äº›å†…ç½®ç±»å‹æ²¡æœ‰`__dict__`ä½†æ˜¯éƒ½å¯ä»¥ä½¿ç”¨`dir()`(ä¼šå¯»æ‰¾åŒ…æ‹¬ä»çˆ¶ç±»ä¸­ç»§æ‰¿çš„å±æ€§)

:::details Click to see more

```python
# ç§æœ‰å˜é‡  
class A():  
    a=1  
    pass  
class B(A):  
    """ # æ³¨æ„'__doc__' å±æ€§
    doc    
    """    
    b=2  
    def __init__(self,x):  
        self.x=x  
b=B(5)  
print(b.__dict__,"\n",B.__dict__,"\n")  
b.__dict__["add"]="add success"  # å¯¹è±¡æ·»åŠ å±æ€§
print(b.__dict__,"\n",dir(B),)
```
è¿è¡Œç»“æœ
```
{'x': 5} 
 {'__module__': '__main__', '__doc__': '\n    doc\n    ', 'b': 2, '__init__': <function B.__init__ at 0x10e5e0820>}  

{'x': 5, 'add': 'add success'} 
 ['__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', 'a', 'b'] 
```
:::
#### super()çš„ç”¨æ³•
åœ¨ç»§æ‰¿ä¸­ï¼Œå¦‚æœé‡å®šä¹‰æŸæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¦†ç›–çˆ¶ç±»çš„åŒåæ–¹æ³•ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›èƒ½åŒæ—¶å®ç°çˆ¶ç±»çš„åŠŸèƒ½ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•äº†ã€‚  
è°ƒç”¨çˆ¶ç±»åŒåæ–¹æ³•æœ‰ä¸¤ç§æ–¹å¼ï¼š  
1. è°ƒç”¨æœªç»‘å®šçš„çˆ¶ç±»æ–¹æ³•
    - å¤šç»§æ‰¿æ—¶ä¼šå¯¼è‡´å¤šæ¬¡è°ƒç”¨æ–¹æ³•
2. ä½¿ç”¨superå‡½æ•°æ¥è°ƒç”¨
    - æœ€å¸¸è§çš„å°±æ˜¯ä½¿ç”¨`super().__init__()`
Python 3 å¯ä»¥ä½¿ç”¨ç›´æ¥ä½¿ç”¨ `super().xxx`ä»£æ›¿ `super(Class, self).xxx`  
`super()`ä¸æ˜¯ç›´æ¥è°ƒç”¨çˆ¶ç±»ï¼Œè€Œæ˜¯æŒ‰ç…§MROé¡ºåºè¿›è¡Œæ„é€   

### Mixinæ··åˆæ¨¡å¼
- æ··åˆä¼˜äºç»§æ‰¿
- MixinåŠŸèƒ½å•ä¸€
    - Mixinåªå®ç°äº†æŸäº›å•ä¸€çš„åŠŸèƒ½ï¼Œå¯ä»¥åˆ©ç”¨ç»§æ‰¿æ¥ç»„åˆè¿™äº›åŠŸèƒ½
    - è”æƒ³é­”æ³•å‡½æ•°åŸºäºåè®®çš„ç¼–ç¨‹ï¼Œoopä¸­å°±ä½¿ç”¨mixin
- ä¸å’ŒåŸºç±»å…³è”ï¼Œå¯ä»¥ä»»æ„ç»„åˆ
- åœ¨Mixinä¸­ä¸è¦ä½¿ç”¨super
- æ··å…¥ç±»ä¸èƒ½ç›´æ¥è¢«å®ä¾‹åŒ–ä½¿ç”¨ã€‚
- æ··å…¥ç±»æ²¡æœ‰è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬å¹¶æ²¡æœ‰å®šä¹‰ `__init__()` æ–¹æ³•ï¼Œå¹¶ä¸”æ²¡æœ‰å®ä¾‹å±æ€§ã€‚
  
ä¸»è¦æ˜¯æŒæ¡ç¼–ç¨‹æ€æƒ³ï¼Œcookbooké‡Œæœ‰[è¿™ä¸€ç« ](https://python3-cookbook.readthedocs.io/zh_CN/latest/c08/p18_extending_classes_with_mixins.html)çš„ç¤ºä¾‹ã€‚
  
### æŠ½è±¡åŸºç±»(æŒæ¡æ€æƒ³)
abcæŠ½è±¡åŸºç±»(abstract base class)æ˜¯æ— æ³•å®ä¾‹åŒ–çš„ï¼Œç»§æ‰¿æŠ½è±¡åŸºç±»å¿…é¡»è¦å®ç°åŸºç±»è§„å®šçš„æŸäº›æ–¹æ³•  
æ‰€æœ‰çš„æŠ½è±¡åŸºç±»çš„metaclasså‚æ•°éƒ½å¿…é¡»æ˜¯`metaclass=ABCMeta`  
ä¸¤ç§æƒ…å†µä¸‹éœ€è¦æŠ½è±¡åŸºç±»  
- ä¸€æ˜¯åˆ¤å®šèƒ½ä¸èƒ½ä½¿ç”¨æŸäº›æ–¹æ³•ï¼Œæ¯”å¦‚æ˜¯å¦å®ç°äº†len 
- äºŒæ˜¯è§„å®šå­ç±»å¿…é¡»å®ç°æŸäº›æ–¹æ³•ã€‚  
è¿™æ ·åœ¨å®ç°æŸäº›åŠŸèƒ½çš„æ›¿ä»£å’Œæ‰©å±•çš„æ—¶å€™ï¼Œå°±æ— éœ€ä¿®æ”¹åŸæ¥çš„ä»£ç ï¼Œç›´æ¥ç»§æ‰¿å¹¶ä¸”å®ç°é¢„ç•™çš„æ¥å£å°±å¯ä»¥äº†  
å¼•å…¥å†…ç½®åŒ…`abc`  
:::details Click to see more

```python
# å‡è®¾æˆ‘ä»¬ç»§æ‰¿Cacheå®ç°RedisCache  
import abc
class Cache(object, metaclass=abc.ABCMeta):  
  
    @abc.abstractmethod  
    def get(self):  
        pass  
  
    @abc.abstractmethod  
    def set(self):  
        pass  
  
  
class RedisCache(Cache):  
    pass  
  
rdc = RedisCache() # å®ä¾‹åŒ–çš„æ—¶å€™æ²¡æœ‰å®ç°è¿™ä¿©æ–¹æ³•å°±æŠ¥é”™
```
è¿è¡Œç»“æœ
```
Traceback (most recent call last):
  File "/Users/jack/code/py/AdvancedPython/main.py", line 69, in <module>
    rdc = RedisCache()
TypeError: Can't instantiate abstract class RedisCache with abstract methods get, set
```
:::

åœ¨åˆ¤æ–­ç±»å‹çš„æ—¶å€™ï¼Œæ¯”å¦‚åˆ¤æ–­`isinstance(obj,Sized)` å®é™…ä¸Šæ˜¯åˆ¤æ–­äº†objæ˜¯å¦å®ç°`__len__` ä½¿ç”¨çš„æ˜¯`__subclasshook__(cls, C)`  
æ‘˜ä¸€ä¸‹`collection/abc.py Sized`æºç 

:::details Click to see more

```python
# collections/abc.pyä¸­çš„æºç 

class Sized(metaclass=ABCMeta):

    __slots__ = ()

    @abstractmethod
    def __len__(self):
        return 0

    @classmethod
    def __subclasshook__(cls, C): # æ³¨æ„è¿™ä¸ªæ–¹æ³•
        if cls is Sized:
            return _check_methods(C, "__len__")
        return NotImplemented


# ç¤ºä¾‹ä»£ç 
from collections.abc import Sized  
  
isinstance(c, Sized) # cçš„ç±»å®ç°äº†__len__ æ‰€ä»¥è¿”å›ä¸ºTrue

```
è¿è¡Œç»“æœ
```
True
```
:::

æŠ½è±¡åŸºç±»ä½¿ç”¨äº†å…ƒç±»æ¥è¿›ç±»å‹æ£€æŸ¥ï¼Œcollections.abcé‡Œé¢éƒ½ä½¿ç”¨äº†metaclass  
å®é™…ä¸Šå†…ç½®çš„å¸¸ç”¨ç±»å‹ä¹Ÿä¸æ˜¯ä½¿ç”¨æŠ½è±¡åŸºç±»å®ç°çš„ï¼ŒCpythonå®ç°çš„æ›´åŠ ç²¾å¦™  
:::tip ğŸ“ŒTip
æ›´æ¨èä½¿ç”¨Mixinå’Œé¸­å­ç±»å‹å®ç°åŠŸèƒ½ï¼Œ**ç»„åˆä¼˜äºç»§æ‰¿**  
ä¸å®ç°å°±æŠ›å‡ºé”™è¯¯å®ç°ç±»ä¼¼æ¥å£çš„åŠŸèƒ½ï¼Œæ›´åŠ çµæ´»
:::


## é­”æ³•å‡½æ•°
åœ¨ç±»ä¸­`__func__()`ç±»ä¼¼çš„å‡½æ•°å°±æ˜¯é­”æ³•å‡½æ•°ï¼Œä¸€èˆ¬ä¸éœ€è¦è‡ªå®šä¹‰ï¼Œç³»ç»Ÿæå‰å®šä¹‰å¥½è‡ªå·±é‡è½½å³å¯ï¼Œå¯ä»¥ç”¨æ¥å®šåˆ¶ç‰¹æ€§.
***é­”æ³•å‡½æ•°ä¸æ˜¯objectçš„æ–¹æ³•***,ä¸æ˜¯ç»§æ‰¿æ¥çš„  
pythonçš„è¯­æ³•å’Œå†…ç½®å‡½æ•°ä¼šè¯†åˆ«è‡ªå®šä¹‰å¯¹è±¡é‡Œé¢çš„é­”æ³•å‡½æ•°ï¼Œéšå¼è°ƒç”¨ï¼Œé€šè¿‡é­”æ³•å‡½æ•°å®šä¹‰ï¼Œå¯ä»¥ä½¿å¯¹è±¡å…·æœ‰æŸäº›ç‰¹æ€§ï¼Œ"æˆä¸º"æŸäº›ç±»å‹ï¼Œå®é™…ä¸Šä¸æ˜¯è¿™äº›ç±»å‹ï¼Œæ˜¯é¸­å­ç±»å‹çš„åŠŸèƒ½ï¼ŒåŒºåˆ«äºjavaä¸­éœ€è¦ç»§æ‰¿ç‰¹å®šçš„ç±»æˆ–è€…æ¥å£   
  
è¿™ç§åšæ³•å«åš<span style="background:greenyellow">åè®®</span>ï¼Œå°½é‡éµå®ˆåè®®ç¼–ç¨‹
### å®ç°é€‚åº”lenå’Œfor
`__len__(self)`ä¼šè¢«å†…ç½®å‡½æ•°`len()`è°ƒç”¨ï¼Œè¦æ±‚è¿”å›ä¸€ä¸ªæ•´æ•°  
å®é™…ä¸Šlenå†…ç½®æ•°æ®ç»“æ„çš„æ—¶å€™list setè¿™ç§ï¼Œç›´æ¥è¯»å–cpythonç»´æŠ¤åœ¨å†…å­˜ä¸­è®°å½•ï¼Œå¾ˆå¿«å°±è¿”å›ï¼Œä¸ä¼šå‚»ä¹ä¹å»æ•°é•¿åº¦ã€‚æ‰€ä»¥å°½é‡ä½¿ç”¨å†…éƒ¨å®šä¹‰çš„ä¸œè¥¿ã€‚

`__getitem__(self,item)`,ä½¿ç”¨forçš„æ—¶å€™ï¼Œè§£é‡Šå™¨å…ˆæ‰¾`__iter__()`æ‰¾ä¸åˆ°å°±ä¼šå¯»æ‰¾è¿™ä¸ªå‡½æ•°ï¼Œä»1å¼€å§‹å–ç›´åˆ°`StopIteration`  
å®é™…ä¸Šé€šè¿‡è¿™ä¸ªå‡½æ•°æˆä¸ºäº†åºåˆ—ç±»å‹ï¼Œå°±å¯åˆ‡ç‰‡äº†ã€‚  

:::details Click to see more

```python
class Company(object):  
    def __init__(self, employee_list):  
        self.employee = employee_list  
  
    def __getitem__(self, item):  
        # è¿™é‡Œå¯ä»¥æ”¾ä¸€äº›æ£€æŸ¥ä»£ç ï¼Œéšä½ äº†  
        return self.employee[item]  
  
    def __len__(self):  
        return 10  
  
  
c = Company(["1", "2", "3"])  
for i in c:  
    print(i)  
print("é•¿åº¦æ˜¯",len(c))
```
è¿è¡Œç»“æœ
```
1
2
3
é•¿åº¦æ˜¯ 10
```
:::

### æ§åˆ¶æ‰“å°å¯¹è±¡çš„è¾“å‡º
`__repr__()`åœ¨å¼€å‘æ¨¡å¼æ¯”å¦‚jupyterç›´æ¥è°ƒç”¨æ˜¾ç¤ºçš„  
`__str__()`printå®ƒæ˜¾ç¤ºå•¥  
:::details Click to see more

```python
class Demo2(object):  
    def __str__(self):  
        return "æˆ‘æ˜¯ğŸ¦ˆ"  
  
    def __repr__(self):  
        return "ä½ çŒœæˆ‘æ˜¯ğŸ˜¦ä¸ª"  
  
  
d = Demo2()  
print(d)  
d
```
è¿è¡Œç»“æœ
```
æˆ‘æ˜¯ğŸ¦ˆ
ä½ çŒœæˆ‘æ˜¯ğŸ˜¦ä¸ª
```
:::

### æ•°å­¦è¿ç®—
ä¸æ˜¯é‡ç‚¹ï¼Œéœ€è¦å•¥ç°æŸ¥è‡ªå·±è¯•è¯•ã€‚  
`__ads__()`ï¼Œç”±abs()è°ƒç”¨  
`__add__()`,+è°ƒç”¨  

:::details Click to see more

```python
class Vector(object):  # åæ ‡ç›¸åŠ   
    def __init__(self, x, y):  
        self.x = x  
        self.y = y  
  
    def __str__(self):  
        return "{0},{1}".format(self.x, self.y)  
  
    def __add__(self, other):  
        return Vector(self.x + other.x, self.y + other.y)  
  
    def __abs__(self):  
        return Vector(abs(self.x), abs(self.y))  
  
  
v1 = Vector(1, 2)  
v2 = Vector(-3, -4)  
v2 = abs(v2)  
v1 = v1 + v2  
print(v1,v2)
```
è¿è¡Œç»“æœ
```
4,6 3,4
```
:::
### å®ç°withè¯­å¥å’Œç®€åŒ–
#### try-finallyè¯­å¥
æ­£å¸¸çš„finallyæ˜¯ç”¨ä½œèµ„æºé‡Šæ”¾çš„ï¼Œæ¯”å¦‚å†™æ–‡ä»¶æ•°æ®åº“å‘ç”Ÿé”™è¯¯ï¼Œåœ¨finallyä¸­closeé‡Šæ”¾èµ„æºã€‚  
åœ¨å‡½æ•°ä¸­try-finallyå¤šä¸ªreturnçš„æ—¶å€™ï¼Œæ³¨æ„é¡ºåº

:::details Click to see more

```python
def fun():  
    try:  
        print("rise")   
        raise KeyError  # 1 å‡ºé”™äº†
        return 1   # ä¸æ‰§è¡Œ
    except KeyError as e:  
        print("catch")  # æ•è·æ‰§è¡Œ
        return 2  # å‹æ ˆ
    else:  
        print("other Error")  
        return 3  
    finally:  
        print("finally")  # å¿…æ‰§è¡Œ
        return 4  # å‹æ ˆ
print(fun()) # ä»æ ˆé¡¶å–ä¸€ä¸ªï¼Œæ‰€ä»¥æœ€åfunè¿”å›æ˜¯4ï¼Œå¦‚æœfinallyæ²¡è¿”å›è¯­å¥ï¼Œé‚£ä¹ˆæ ˆé¡¶æ˜¯2ï¼Œè¿”å›çš„å°±æ˜¯2
```
è¿è¡Œç»“æœ
```
rise
catch
finally
4 # è¿”å›å€¼
```
:::

#### å®ç°with
ä¸Šä¸‹æ–‡ç®¡ç†å™¨å°±æ˜¯ç®€åŒ–äº†try-finallyæ•´å‡ºæ¥çš„  
å®ç°äº†ä¸Šä¸‹æ–‡ç®¡ç†ï¼Œç±»ä¼¼äºwith-open  
å®ç°`__enter__(self)`æœ€åè¦è¿”å›self  
åŒæ—¶å®ç°`__exit__(self, exc_type, exc_val, exc_tb)` å¯ä»¥ä¸è¿”å›

:::details Click to see more

```python
class ContextManager:  
  
    def __enter__(self):  
        print("å¼€å§‹")  
        return self  
  
    def __exit__(self, exc_type, exc_val, exc_tb):  
        print("é€€å‡º")  
  
    def func(self):  
        print("åŠŸèƒ½ä»£ç ")  

with ContextManager() as cm:  
    cm.func()
```
è¿è¡Œç»“æœ
```
å¼€å§‹
åŠŸèƒ½ä»£ç 
é€€å‡º
```
:::

#### contextlibç®€åŒ–with
pythonå†…ç½®äº†è£…é¥°å™¨  `@contextlib.contextmanager`å¯ä»¥ç›´æ¥ç®€åŒ–è¿™ä¸œè¥¿  
è¢«è£…é¥°å‡½æ•°ä¸­éœ€è¦å«æœ‰ä¸€ä¸ª`yield`ï¼Œ`yield`ä¹‹å‰çš„æ˜¯`__enter__`çš„å¤„ç†ï¼Œä¹‹åæ˜¯`__exit__`çš„å¤„ç†  
ä½¿ç”¨äº†yeildç”Ÿæˆå™¨ï¼Œåé¢ä¼šå†™åˆ°ï¼Œè¿™é‡Œå°±æœ‰æ ·å­¦æ ·yieldç©ºå­—å…¸å°±è¡Œ  
:::details Click to see more

```python
from contextlib import contextmanager  
  
@contextmanager  
def ContextManager():  
    print("å¼€å§‹")  
    yield {}  
    print("é€€å‡º")  
  
with ContextManager() as cm:  
    print("åŠŸèƒ½ä»£ç ")
```
è¿è¡Œç»“æœ
```
å¼€å§‹
åŠŸèƒ½ä»£ç 
é€€å‡º
```
:::

### å±æ€§æ“ä½œä¸‰å‰‘å®¢
`__ getattribute__`æ–¹æ³•ã€`__setattr__æ–¹æ³•ã€` `__delattr__æ–¹æ³•`  
[å…ƒç±»ç¼–ç¨‹->](#^25cbec)
- `setattr(obj, k, v)`: obj.k=v
- `getattr(obj, k)`: obj.k
- `hasattr(obj,k)`:è¿”å›boolï¼Œå°±æ˜¯çœ‹çœ‹æœ‰æ²¡æœ‰ï¼Œä¹Ÿå¯ä»¥çœ‹å­—å…¸çš„ï¼Œä½¿ç”¨è¿‡æ•è·getattré”™è¯¯å®ç°çš„
### æ„é€ ææ„
`__new__`å’Œ`__init__`  
åœ¨threadé‡Œé¢å·²ç»å†™äº†initæ–¹æ³•ï¼Œç›´æ¥`super().__init__(para)`å°±å¯ä»¥æ„å»ºäº†  
[æ·±å…¥OOP->æ„é€ ææ„->](#^e46b78)
### å®šåˆ¶ç±»å±æ€§
`__slots__`  
[æ·±å…¥OOP->æ„é€ ææ„->](#^144b67)
### è¿­ä»£å™¨å’Œç”Ÿæˆå™¨
[è¿­ä»£å™¨å’Œç”Ÿæˆå™¨->](#^a159bd)
### é›¶æ•£çš„åŠŸèƒ½
- å®ç°äº†`__contains__`å¯ä»¥inåˆ¤æ–­,æ‰¾ä¸åˆ°å°±æ‰¾`__getitem__`ï¼Œæ‰€ä»¥å®ç°äº†è¿™ä¹Ÿå¯ä»¥
- åè½¬å®ç°çš„æ˜¯`__reversed__`
- ç±»å±æ€§`cls.__base__`æŸ¥çœ‹ä¸€ä¸ªç±»çš„çˆ¶ç±»
- ä½¿ç”¨`obj.__dict__`æŸ¥çœ‹å¯¹è±¡æ‰€æœ‰çš„å±æ€§
- ä½¿ç”¨`cls.__init__.__default__`æŸ¥çœ‹é»˜è®¤å‚æ•°
- `BOOL: hasattr(class,"funcName")`åˆ¤æ–­æ˜¯å¦æœ‰è¿™ä¸ªå±æ€§
- `getattr(obj,k)`ç­‰ä»·äº`obj.k`
- å‡½æ•°å’Œç±»çš„`__name__`å±æ€§ï¼Œå¯ä»¥æ‹¿åˆ°åå­—
- `__class__`è·å–ç±»å‹
- åªè¦å®šä¹‰ç±»å‹çš„æ—¶å€™ï¼Œå®ç°`__call__`å‡½æ•°ï¼Œè¿™ä¸ªç±»å‹å°±æˆä¸ºå¯è°ƒç”¨çš„ã€‚æ¢å¥è¯è¯´ç›¸å½“äºé‡è½½äº†æ‹¬å·è¿ç®—ç¬¦ã€‚
- å‡½æ•°æ³¨è§£çš„ä¿¡æ¯ï¼Œä¿å­˜åœ¨ `__annotations__` å±æ€§ä¸­å¯ä»¥æ¥è°ƒç”¨ã€‚

:::tip ğŸ“„Info
å…¶å®é­”æ³•å‡½æ•°å’Œç±»å†…ç½®å±æ€§å¾ˆå¤šï¼Œè¿™é‡Œæ•´ç†ä¸€ä¸‹ä»–è®²åˆ°çš„å’Œæˆ‘è‡ªå·±å®éªŒåˆ°çš„  
å‰©ä¸‹çš„å»çœ‹æ–‡æ¡£æœå§
:::

```python
# æ ¹æ®ç¬¬ä¸€ä¸ªåˆ—è¡¨è¿‡æ»¤ç¬¬äºŒä¸ªåˆ—è¡¨
filter_data = [x for x in list2 if
              all(y  not in x for y in list1)]
```

## å…ƒç±»ç¼–ç¨‹
æ§åˆ¶ç±»å®ä¾‹åŒ–çš„è¿‡ç¨‹
### è®¡ç®—å±æ€§@property
ä½¿ç”¨`@property`è£…é¥°å™¨å°†å‡½æ•°åŒ…è£…æˆåŠ¨æ€å˜é‡ï¼Œæ›´å®¹æ˜“è°ƒç”¨
:::details Click to see more

```python
from datetime import date, datetime  
  
  
class User():  
    def __init__(self, name, birth):  
        self.name = name  
        self.birth = birth  
        self._age = 0  
  
    def old_get_age(self):  # è€å¼ä»£ç éœ€è¦è°ƒç”¨å‡½æ•°æ¯”è¾ƒéº»çƒ¦  
        return datetime.now().year - self.birth.year  
  
    @property  
    def age(self):  # è£…é¥°ä¹‹åå‡½æ•°åå°±æ˜¯å±æ€§åç›´æ¥è°ƒç”¨  
        return self._age  
  
    @age.setter  # setæ–¹æ³•  
    def age(self, value):  
        self._age = value  
  
  
user1 = User("a", date(year=1988, month=5, day=25))  
  
user1.age = 2  # ç›´æ¥è®¾ç½®  
print(user1.old_get_age(), user1.age)
```
è¿è¡Œç»“æœ
```
34 2
```
:::
### å±æ€§æ“ä½œä¸‰å‰‘å®¢
`__getattr__` å°è¯•è·å–ä¸å­˜åœ¨çš„å±æ€§çš„æ—¶å€™ï¼Œå¦‚æœå®šä¹‰äº†æ­¤æ–¹æ³•ï¼Œå°±ä¸ä¼šæŠ¥é”™ä¼šè¿è¡Œè¿™ä¸ªæ–¹æ³•,è¿™ä¸ªè‹¥æ˜¯è¿è¡Œäº†é‚£ä¸‹é¢é‚£ä¸ªå¿…å¤‡è¿è¡Œ  
`__getattribute__` è¿™ä¸ªåªè¦æ‰¾å°±ä¼šè¿›å…¥ï¼Œä¸€èˆ¬ä¸å»ºè®®é‡è½½ï¼Œå¾ˆå®¹æ˜“å´©ï¼Œåªè¦é‡å†™å¿…ç„¶ä¼šæ— é™é€’å½’ï¼Œä¸ºäº†é¿å…æ— é™é€’å½’ï¼Œåº”è¯¥æŠŠè·å–å±æ€§çš„æ–¹æ³•æŒ‡å‘ä¸€ä¸ªæ›´é«˜çš„è¶…ç±»ï¼Œä¾‹å¦‚`object`  
`return super().__getattribute__(item)`

Pythonä¸­å±æ€§æ“ä½œæ•è·çš„ä¸‰å‰‘å®¢ï¼š`__getattribute__`æ–¹æ³•ã€`__setattr__`æ–¹æ³• `__delattr__`æ–¹æ³• ^25cbec

:::details Click to see more

```python
class User1():  
    def __init__(self, name):  
        self.name = name  
  
    def __getattr__(self, item): # æ‰¾ä¸åˆ°æ‰è¿›æ¥  
        print(type(item))  
        return "get {0} error".format(item)  
  
    def __getattribute__(self, item): # åªè¦æ‰¾å°±è¿›æ¥  è¿™é‡Œæœ‰BUG
        print("seeking attr")  
        return item  
  
  
user1 = User1("a")  
print(user1.name)
```
è¿è¡Œç»“æœ
```
seeking attr
<class 'str'>
a get age error
```
:::

### å±æ€§æè¿°ç¬¦descriptor
è¿™é‡Œæœ‰ä¸€ç¯‡[åˆ«äººçš„](https://www.waynerv.com/posts/python-descriptor-in-detail/)  
å½“æˆ‘ä»¬çš„ç±»æœ‰å¾ˆå¤šå±æ€§ï¼Œéƒ½éœ€è¦å†™æ£€æŸ¥æ–¹æ³•çš„æ—¶å€™ï¼Œä¸€ä¸ªå±æ€§ä¸€å¥—æ£€æŸ¥æ–¹æ³•ä»£ç é‡å¤åº¦å¾ˆé«˜ï¼Œæ­¤æ—¶å¯ä»¥å®šä¹‰ä¸€ä¸ªç±»ä¸“é—¨è¿›è¡Œå±æ€§æ£€æŸ¥å¤„ç†ç­‰ï¼Œå®ç°`__get__` `__set__` `__delete__`ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œè¿™ä¸ªç±»å°±æˆäº†å±æ€§æè¿°ç¬¦  
å’Œdjangoé‡Œé¢moduleçš„é€»è¾‘æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯djangoå†™çš„æ›´åŠ åŠ¨æ€å’Œçµæ´»ï¼Œä¹Ÿæ˜¯å¤§éƒ¨åˆ†ORMçš„å®ç°åŸç†  

:::details Click to see more

```python
import numbers  
class IntField():  
    def __get__(self, instance, owner):  
        print("gettingã€‚ã€‚ã€‚")  
        return self.value # è·å–çš„æ—¶å€™å°±è¿”å›å­˜å‚¨çš„å€¼  
  
    def __set__(self, instance, value):  
        print("settingã€‚ã€‚ã€‚")
        if not isinstance(value,numbers.Integral):  
            raise ValueError("int is needed")  
        #æ³¨æ„æ£€æŸ¥å®Œäº†ä¸è¦èµ‹ç»™instance,  
        #å› ä¸ºinstanceå°±æ˜¯Userå¯¹è±¡ï¼Œåˆå›æ¥äº†ä¼šæ­»å¾ªç¯  
        self.value=value  
  
    def __delete__(self, instance):  
        print("deleteã€‚ã€‚ã€‚")  
        pass  
  
class User():  
    age=IntField()  
  
user=User()  
user.age=4  
print(user.age)  
del(user.age)
```
è¿è¡Œç»“æœ
```
settingã€‚ã€‚ã€‚
gettingã€‚ã€‚ã€‚
4
deleteã€‚ã€‚ã€‚
```
:::

æ ¹æ®æ‰€å®ç°çš„åè®®æ–¹æ³•ä¸åŒï¼Œæè¿°ç¬¦åˆå¯åˆ†ä¸ºä¸¤ç±»ï¼š  
  
-   è‹¥å®ç°äº† `__set__()` æˆ– `__delete__()` ä»»ä¸€æ–¹æ³•ï¼Œè¯¥æè¿°ç¬¦æ˜¯ä¸€ä¸ªæ•°æ®æè¿°ç¬¦ï¼ˆ`data descriptor`ï¼‰ã€‚
-   è‹¥ä»…å®ç° `__get__()` æ–¹æ³•ï¼Œè¯¥æè¿°ç¬¦æ˜¯ä¸€ä¸ªéæ•°æ®æè¿°ç¬¦ï¼ˆ`non-data descriptor`ï¼‰ã€‚
  
ä¸¤è€…çš„åœ¨è¡¨ç°è¡Œä¸ºä¸Šå­˜åœ¨å·®å¼‚ï¼š  
  
-   æ•°æ®æè¿°ç¬¦æ€»æ˜¯ä¼šè¦†ç›–å®ä¾‹å­—å…¸ `__dict__` ä¸­çš„å±æ€§ã€‚
    - å®šä¹‰å®ä¾‹ `__dict__[attr]`ä¹‹åè°ƒç”¨ `__dict__[attr]`æˆ–`obj.attr`è¿˜æ˜¯ä¼šä½¿ç”¨æè¿°ç¬¦
    - ä½¿ç”¨äº†æ•°æ®æè¿°ç¬¦ä¼šè¢«å­˜å‚¨åœ¨ç±»çš„æ•°æ®æè¿°ç¬¦ä¸­ï¼Œä¸è¿›å…¥å®ä¾‹çš„ `__dict__` å±æ€§åˆ—è¡¨
-   è€Œéæ•°æ®æè¿°å¯èƒ½ä¼šè¢«å®ä¾‹å­—å…¸ `__dict__` ä¸­å®šä¹‰çš„å±æ€§æ‰€è¦†ç›–ã€‚
    - ä¼˜å…ˆçº§ä¸å¦‚ç±»é«˜ï¼Œæ³¨æ„ä¸‹é¢è¯´æ˜é¡ºåº
:::tip ğŸ“„Info
**æè¿°ç¬¦æŸ¥æ‰¾è¿‡ç¨‹**<br/>
```python
user.ageç­‰ä»·äºgetattr(user,â€™ageâ€™)

è€Œå¯¹äºæè¿°ç¬¦__get__çš„è°ƒç”¨æ˜¯å‘ç”Ÿåœ¨__getattribute__å†…éƒ¨çš„ã€‚
è°ƒç”¨é¡ºåº
è°ƒç”¨__getattribute__
if ç±»å®šä¹‰äº†__getattr__æ–¹æ³• && è°ƒç”¨æŠ›å‡º AttributeError :
    è°ƒç”¨__getattr__

user = User(), é‚£ä¹ˆuser.age é¡ºåºå¦‚ä¸‹ï¼š

if â€œageâ€æ˜¯å‡ºç°åœ¨Useræˆ–å…¶åŸºç±»çš„__dict__ä¸­ && ageæ˜¯data descriptor : 
    è°ƒç”¨å…¶__get__æ–¹æ³•
    
elif â€œageâ€å‡ºç°åœ¨userå¯¹è±¡çš„__dict__ä¸­ :
    ç›´æ¥è¿”å› obj.__dict__[â€˜ageâ€™]

elif â€œageâ€å‡ºç°åœ¨Useræˆ–å…¶åŸºç±»çš„__dict__ä¸­ : 
    if â€œageâ€æ˜¯non-data descriptor : 
        é‚£ä¹ˆè°ƒç”¨å…¶__get__æ–¹æ³•
    else :è¿”å› __dict__[â€˜ageâ€™]

elif Useræœ‰__getattr__æ–¹æ³• : 
    è°ƒç”¨__getattr__æ–¹æ³•
    
else : æŠ›å‡ºAttributeError

```
:::

### å…ƒç±»metaclass

æŠŠclasså®šä¹‰è¯­å¥æ”¾åœ¨å‡½æ•°å†…ï¼Œæ ¹æ®ä¼ å…¥çš„å­—ç¬¦ä¸²ä¸åŒè¿”å›ä¸åŒçš„ç±»å¼•ç”¨ï¼Œç„¶ååˆ›å»ºå¯¹åº”çš„å®ä¾‹ï¼Œè¿™ç§åŠ¨æ€åˆ›å»ºå®ä¾‹çš„æœºåˆ¶åœ¨javaè¿™ç§é™æ€è¯­è¨€ä¸­å¾ˆéš¾å®ç°ã€‚  
ä½†æ˜¯pythonåšçš„ä¸æ­¢äºæ­¤ï¼Œè¿˜èƒ½ç»§ç»­åŠ¨æ€  
  
`type(name ,base,dict)`ç±»åï¼ŒåŸºç±»æ²¡æœ‰å°±ç©ºtupleï¼Œå±æ€§æ²¡æœ‰å°±ç©ºå­—å…¸  
è¿™ç§åˆ›å»ºç±»çš„ç±»å°±æ˜¯å…ƒç±»ï¼Œ`type`æ˜¯ä¸€ç§å…ƒç±»ï¼Œç»§æ‰¿typeä¹‹åå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„ç±»(å…¶ä»–éƒ½ç»§æ‰¿è‡ªobject): å…ƒç±»ï¼Œåˆ©ç”¨åˆ›å»ºç±»æ—¶çš„**metaclass**å‚æ•°å°±å¯ä»¥æ§åˆ¶ç±»çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œå¯ä»¥æ³¨å…¥å¾ˆå¤šä¸œè¥¿   
:::details Click to see more
**typeç”Ÿæˆ**<br/>
```python
class BaseClass:  
    def echo(self):  
        print("I am BaseClass")  
  
def boundFun(self,string): # æ³¨æ„ç»‘å®šçš„æ—¶å€™ç¬¬ä¸€ä¸ªå‚æ•°é»˜è®¤ä¼ å…¥å¯¹è±¡  
    print(self.att)  
    print(string)  
#ä½¿ç”¨typeåˆ›å»ºäº†ä¸€ä¸ªç±»  
T=type("T",(BaseClass,),{"bound":boundFun,"att":"dynamic att"})  
  
t=T()  
t.echo()  
t.bound("para fun")
```
è¿è¡Œç»“æœ
```
I am BaseClass
dynamic att
para fun
```
:::
ç±»çš„ç”Ÿæˆè¿‡ç¨‹  
metaclasså¯ä»¥éšå¼åœ°ç»§æ‰¿åˆ°å­ç±»ï¼Œä½†å­ç±»è‡ªå·±å´æ„Ÿè§‰ä¸åˆ°  
åˆ›å»ºç±»æ—¶ä¼šé¦–å…ˆå¯»æ‰¾metaclassï¼Œï¼Œé€šè¿‡metaclassåˆ›å»ºï¼Œç±»æ‰¾ä¸åˆ°å°±å»çˆ¶ç±»æ‰¾ï¼Œå…ˆæ‰¾åˆ°é‚£ä¸ªå°±ä½¿ç”¨å“ªä¸ªmetaclassï¼Œéƒ½æ‰¾ä¸åˆ°å°±ä¼šå»ç”¨typeåˆ›å»º  
æŠ½è±¡åŸºç±»ä½¿ç”¨äº†å…ƒç±»æ¥è¿›ç±»å‹æ£€æŸ¥ï¼Œcollections.abcé‡Œé¢éƒ½ä½¿ç”¨äº†metaclass  
:::details Click to see more

```python
class MetaClass(type):  
    def __new__(cls, *args, **kwargs):  
        print("new...")  
        print('this is args : ',args) #æ‰“å°ä¸€ä¸‹  
        print('this is kwargs : ',kwargs)  
        kwargs={} # æŠŠä»–ç½®ä¸º{}å› ä¸ºåŸå…ˆå°±æ˜¯ç©ºï¼Œå¦‚æœä¸ç½®ç©ºxä¼ è¿›å»æŠ¥é”™  
        return super().__new__(cls,*args, **kwargs)  
  
class M(metaclass=MetaClass,x=5): # ä¼ å…¥äº†é¢å¤–çš„x=5  
    def __init__(self,name):  
        self.name=name  
  
m=M(name="ha")  
print(m.name)
```
è¿è¡Œç»“æœ
```
new...
this is args :  ('M', (), {'__module__': '__main__', '__qualname__': 'M', '__init__': <function M.__init__ at 0x10a7f7280>})
this is kwargs :  {'x': 5}
ha
```
:::
newçš„å‚æ•°arg`def __new__(cls,  nameç±»å, basesçˆ¶ç±», attrså±æ€§ä»¬, **kwargs):`  
### example-1å…ƒç±»å®ç°ORM
åˆ©ç”¨å…ƒç±»è‡ªå·±å†™ä¸ªORM  
å°±ä¸è¿SQLäº†ï¼Œæ‰“å°ä¸€ä¸‹å°±å¥½  
è¦æ±‚  
1. ä½¿ç”¨æ•°æ®æè¿°ç¬¦æ¥å®šä¹‰å­—æ®µ  
2. å­—æ®µè¦æŒ‡æ˜  
    - å­—æ®µæœ€å¤§é•¿åº¦(æ£€æŸ¥)  
    - æ’å…¥æ•°æ®åº“çš„å­—æ®µï¼Œä¸æŒ‡æ˜å°±é»˜è®¤å˜é‡å  
    - ç±»å‹ï¼Œæœ€å¤§æœ€å°å€¼(æ£€æŸ¥)  
3. ä½¿ç”¨å†…éƒ¨ç±»æŒ‡æ˜è¡¨ï¼Œæ³¨é‡Šç­‰å…¶ä»–ä¿¡æ¯  
4. saveå³è·å–æ ¼å¼åŒ–çš„æ‰€æœ‰è¡¨ï¼Œå­—æ®µçš„ä¿¡æ¯ï¼Œå¹¶æ‰“å°

:::details Click to see more
**å…ƒç±»å®ç°ORM**<br/>
```python
import numbers  

def check_args(value, types):  # æ£€æŸ¥å‚æ•°çš„ç±»å‹  
    if isinstance(value, types):  
        return value  
    else:  
        raise TypeError("need a %s Type" % types.__name__)  
  
class Field:  # ä½¿ç”¨è¿™ä¸ªæ¥åˆ¤æ–­ç±»å‹æ˜¯å¦æ­£ç¡®  
    pass  
  
class IntegerField(Field):  
  
    def __init__(self, min, max):  
        self.min = check_args(min, numbers.Integral)  
        self.max = check_args(max, numbers.Integral)  
  
    def __get__(self, instance, owner):  
        return self.value  
  
    def __set__(self, instance, value):  
        value = check_args(value, numbers.Integral)  
        if self.min <= value <= self.max:  
            self.value = value  
        else:  
            raise ValueError("number is illagel")  
  
    def __delete__(self, instance):  
        print("delete attribute")  
        pass  
  
class StringField(Field):  
  
    def __init__(self, max_size=100):  
        self.max_size = check_args(max_size, numbers.Integral)  
  
    def __get__(self, instance, owner):  # instance ä¼ çš„æ˜¯module  
        return self.value  
  
    def __set__(self, instance, value):  
  
        value = check_args(value, str)  # ç±»å‹æ£€æŸ¥  
        if len(value) >= self.max_size:  
            raise ValueError("value too large")  
        else:  
            self.value = value  
  
    def __delete__(self, instance):  
        print("delete attribute")  
        pass  
  
class ModuleMetaClass(type):  
    def __new__(cls, name, bases, attrs, **kwargs):  
    #å…ƒç±»ä¸­å¯ä»¥è·å¾—å±æ€§ï¼Œæ”¾åˆ°atträ¸­å¸¦åˆ°åŸºç±»ä¸­
        if name == 'BaseModule':  # å¦‚æœæ˜¯ModuleåŸºç±»åŸè·¯è¿”å›  
            return super().__new__(cls, name, bases, attrs, **kwargs)  
        fields = {}  # è¡¨çš„å­—æ®µä¿¡æ¯  
        # print(name, bases, attrs)  # çœ‹ä¸€çœ‹å±æ€§éƒ½è—åœ¨å“ª
        for k, v in attrs.items():  # æ‰¾  
            # print(k)  
            if isinstance(v, Field):  # å¦‚æœæ˜¯Fieldç±»å‹å°±æ·»åŠ è¿›è¿™ä¸ªè¡¨å±æ€§é‡Œé¢  
                fields[k] = v  
        # print(fields)  
        table = {}  # è¡¨çš„ä¿¡æ¯  
        meta = attrs.get("Meta", None)  # æ˜¯å¦å®šä¹‰äº†meta  
        if meta is not None:  
            attrs["table_name"] = meta.table_name  # å®šä¹‰äº†metaå°±ç”¨metaçš„è¡¨å  
        else:  
            attrs["table_name"] = name.lower()  # æ²¡å®šä¹‰å°±ç”¨ç±»åå°å†™  
        attrs["fields"] = fields  
        del attrs["Meta"]  # åˆ é™¤Meta  
        return super().__new__(cls, name, bases, attrs, **kwargs)  
  
class BaseModule(metaclass=ModuleMetaClass):  
    def __init__(self, *args, **kwargs):  
        for key, value in kwargs.items():  # åœ¨debugé‡Œé¢çœ‹åˆ°çš„è¿˜æ˜¯æ­£å¸¸çš„å±æ€§ï¼Œä½†æ˜¯å·²ç»å¯ä»¥è‡ªå·±æ£€æŸ¥æ•°æ®ç±»å‹äº†  
            setattr(self, key, value)  
        return super().__init__()  
  
    def save(self):  
        columns_ = []  
        values_ = []  
        for k, v in self.fields.items():  
            columns_.append(k)  
            values_.append(str(getattr(self,k))) # è½¬ä¸€æ¬¡å­—ç¬¦ä¸²  
        print(r"INSERT INTO {0} ({1})VALUES ({2});".format(self.table_name,",".join(columns_), ",".join(values_)))  
        # è¿™é‡ŒçŸ¥è¯†ç®€å•çš„æ‰“å°ï¼Œå…¶å®æ²¡æœ‰åšå¾ˆå¤šsqlçš„å·¥ä½œ  
class User(BaseModule):  
  
    age = IntegerField(0, 100)  
    name = StringField()  
  
    class Meta:  
        table_name = "vip_user"  
  
user = User(name="å¯„äº†ğŸ˜¦", age=100)  
user.age = 15  # æ”¹å˜è¿™ä¸ªå€¼é‡Œé¢çš„ä¹Ÿä¼šè·Ÿç€å˜  
print(user.name)  
user.save()
```
è¿è¡Œç»“æœ
```

```
:::

------------

## å¸¸è§çš„å†…ç½®ç±»å‹ä¸€è§ˆ
åé¢ä¼šè¯¦ç»†è®²è§£ä¸€äº›ç±»å‹  
pythonçš„å¯¹è±¡ä¼šæœ‰ä¸‰ä¸ªç‰¹å¾ï¼Œèº«ä»½ï¼Œç±»å‹ï¼Œå€¼  

:::tip ğŸ“„Info
pythonçš„å†…ç½®å‡½æ•°éƒ½æ˜¯**å†…åµŒåœ¨è§£é‡Šå™¨é‡Œ**é¢çš„ï¼Œæ˜¯ä½¿ç”¨Cç¼–å†™çš„ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä½ æ˜¯æ— æ³•æŸ¥çœ‹çš„ï¼Œåªä¸è¿‡pycharmè¿™ç§æ™ºèƒ½ç¼–è¾‘å™¨å¯¹å…¶è¿›è¡Œäº†ä¸€ä¸ªæŠ½è±¡ç½¢äº†ï¼Œå¯ä»¥è®©ä½ æŸ¥çœ‹ç›¸åº”çš„æ³¨é‡Šã€‚  
ä»£ç çš„å…·ä½“å®ç°æ˜¯é€šè¿‡Cå®ç°çš„ï¼Œè¯¥æ–‡ä»¶åªæ˜¯èµ·åˆ°ä¸€ä¸ªè®©ä½ å­¦ä¹ çš„è¾…åŠ©ä½œç”¨ã€‚  
:::

### èº«ä»½(å†…å­˜)

ç†è§£ä¸ºå¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨`id()`æŸ¥çœ‹  

#### isinstance,is,== çš„åŒºåˆ†
- `isinstance(obj,type)` ä¸ä»…å¯ä»¥åˆ¤æ–­æ˜¯å¦å®ç°äº†ABCï¼Œä¹Ÿä¼šé¡ºç€ç»§æ‰¿é“¾åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯çˆ¶ç±»å‹ä¹Ÿæ˜¯ç”¨å®ƒï¼Œå­ç±»å‹å¯¹è±¡æ˜¯çˆ¶ç±»å‹çš„ï¼Œå€’è¿‡æ¥ä¸æ˜¯æ˜¯ä¸æ˜¯çˆ¶ç±»å‹ä¹Ÿæ˜¯ç”¨å®ƒï¼Œå­ç±»å‹å¯¹è±¡æ˜¯çˆ¶ç±»å‹çš„ï¼Œå€’è¿‡æ¥ä¸æ˜¯  
- `issubclass(class,type)`åˆ¤æ–­æ˜¯å¦ä¸ºå­ç±»ã€‚  
è¿™ä¿©å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä¸ºtupleï¼Œåªè¦å…¶ä¸­æœ‰ä¸€ä¸ªç¬¦åˆå³ä¸ºTrueï¼Œè‡ªå·±åˆ¤æ–­ä¹Ÿç®—ã€‚
- `is` åˆ¤æ–­çš„æ˜¯idæ˜¯å¦ç›¸åŒ
- `â• â•` åˆ¤æ–­çš„æ˜¯å€¼ç›¸ç­‰

#### æ·±æµ…æ‹·è´
æ·±æ‹·è´éœ€è¦å¼•å…¥`copy`åŒ…  
1. **b = a:** èµ‹å€¼å¼•ç”¨ï¼Œa å’Œ b éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚
2. **b = a.copy():** æµ…æ‹·è´, a å’Œ b æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œä½†ä»–ä»¬çš„å­å¯¹è±¡è¿˜æ˜¯æŒ‡å‘åŒä¸€å¼•ç”¨,dictå¥—listï¼Œæ‹·è´å®Œåä¿©dictçš„listæŒ‡å‘åŸå…ˆçš„åŒä¸€ä¸ªlist
3. **b = copy.deepcopy(a):** æ·±åº¦æ‹·è´, a å’Œ b å®Œå…¨æ‹·è´äº†å¯¹è±¡åŠå…¶å­å¯¹è±¡ï¼Œä¸¤è€…æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚

### ç±»å‹

è¿™äº›ç±»å‹å’Œjavaæœ‰ä¸€å®šåŒºåˆ«  
Noneåœ¨pythonå¯åŠ¨è§£é‡Šå™¨çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨None classå£°æ˜ä¸€ä¸ªNoneï¼Œå…¨å±€åªæœ‰ä¸€ä¸ªï¼Œæ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œæ— è®ºèµ‹å€¼ç»™å¤šå°‘ä¸ªå˜é‡ä½¿ç”¨idæŸ¥çœ‹æ˜¯ä¸€æ ·çš„  
**å¸¸è§ç±»å‹**  

- æ•°å€¼
    - int
    - float
    - complex
        - c.real & c.image
    - bool
- è¿­ä»£ç±»å‹
- åºåˆ—ç±»å‹
    - list
    - bytesã€bytearrayã€memoryviewï¼ˆäºŒè¿›åˆ¶åºåˆ—ï¼‰
    - range
    - tuple
        - collections.namedtuple
    - str
    - array
- æ˜ å°„ç±»å‹(dict)
- é›†åˆç±»å‹(æ€§èƒ½å¾ˆé«˜)
    - set
    - frozenset(ä¸å¯ä¿®æ”¹çš„set)
- ä¸Šä¸‹æ–‡ç®¡ç†ç±»å‹(withè¯­å¥)
- å…¶ä»–ç±»å‹
    - æ¨¡å—ç±»å‹
    - classå’Œå®ä¾‹
    - å‡½æ•°ç±»å‹
    - æ–¹æ³•ç±»å‹(åŒºåˆ«äºå‡½æ•°)
    - ä»£ç ç±»å‹
    - objectå¯¹è±¡
    - typeç±»å‹
    - ellipsisç±»å‹(`...`çœç•¥å·)
    - notimplementedç±»å‹
    - enumæšä¸¾ç±»

#### å¸¸è§ç±»å‹è½¬æ¢å¿«é€Ÿå¤ä¹ 
- `float->int`  
    - `int(float)` ç›´æ¥èˆå¼ƒå°æ•°
    - `math.round(float)`å°æ•°å››èˆäº”å…¥
    - `math.floor(float)`å‘ä¸‹å–æ•´
    - `math.ceil(float) `å‘ä¸Šå–æ•´
- `float/int->bool` 0ä¸ºå‡1ä¸ºçœŸ,è™šæ•°å¿…é¡»æ˜¯0+0iæ˜¯Falseï¼ŒNoneæ˜¯False
![800](./static/pythonè¯­è¨€è¿›é˜¶-images-5.png)
- `str->other` 
    - ç›´æ¥è½¬æ¢ä¼šæŒ¨ä¸ªå­—ç¬¦è½¬ï¼Œç¬¦åˆå½¢çŠ¶çš„ç”¨`list(eval(String))`
    - æ‰€æœ‰ç±»å‹è½¬`str(other)`éƒ½æ˜¯ç›´æ¥æ‰“å°
- `dict<->other`
    - setä¸èƒ½è½¬dictï¼Œ`dict.keys()`å¯ä»¥è·å–keyset
    - strè½¬dictç”¨evalè§£ææˆ–è€…counterç»Ÿè®¡å­—ç¬¦æ•°é‡
    - listè½¬dictä½¿ç”¨counter

### å€¼
`a=1` pythonä¼šæŠŠ1ç”¨`int`å°è£…ä¸ºå¯¹è±¡ï¼Œç„¶åæŠŠaè¿™å˜é‡æŒ‡å‘äº†å®ƒ  
`ä¼˜å…ˆçº§é¡ºåºä¸º NOTã€ANDã€OR`ï¼Œ`_`æŒ‡å‘ä¸Šä¸€æ¬¡è¿è¡Œçš„è¡¨è¾¾å¼çš„å€¼
#### å¯¹è±¡å¼•ç”¨,å¯å˜æ€§,GC
javaå’Œpyä¸­çš„å˜é‡æœ¬è´¨ä¸ä¸€æ ·ï¼ŒJVMéœ€è¦å¯¹è¿™ç±»å‹çš„æè¿°ç„¶åç”³è¯·ç©ºé—´ï¼Œæ‰€ä»¥æœ‰å¼ºåˆ¶ç±»å‹æ£€æŸ¥ç©ºé—´å¤§å°ä¹Ÿæ˜¯é¢„å®šçš„  
pythonçš„å˜é‡å®è´¨ä¸Šæ˜¯ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆå¤§å°æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æŒ‡å‘æ˜¯ä»»æ„çš„ï¼Œè€Œä¸”æ˜¯é¦–å…ˆç”³è¯·äº†å¯¹è±¡å†æŒ‡ä¸Šå»  

#### ä¸¤ç§å‚æ•°ä¼ é€’ å’Œ ä¸å¯å˜å¯¹è±¡
Pythonæ ¹æ®å®é™…å‚æ•°çš„ç±»å‹ä¸åŒï¼Œåˆ†åˆ«ä½¿ç”¨å€¼ä¼ é€’å’Œå¼•ç”¨ï¼ˆåœ°å€ï¼‰ä¼ é€’ï¼š

1.  å€¼ä¼ é€’ï¼šé€‚ç”¨äºå®å‚ç±»å‹ä¸ºä¸å¯å˜ç±»å‹ï¼ˆ**å­—ç¬¦ä¸²ã€æ•°å­—ã€å…ƒç»„**ï¼‰
2.  å¼•ç”¨ï¼ˆåœ°å€ï¼‰ä¼ é€’ï¼šé€‚ç”¨äºå®å‚ç±»å‹ä¸ºå¯å˜ç±»å‹ï¼ˆ**åˆ—è¡¨ï¼Œå­—å…¸**ï¼‰

åŒºåˆ«æ˜¯ï¼Œå‡½æ•°å‚æ•°è¿›è¡Œå€¼ä¼ é€’åï¼Œè‹¥å½¢å‚å˜ï¼Œå®å‚ä¸å˜ï¼›  
è€Œå‡½æ•°å‚æ•°ç»§ç»­å¼•ç”¨ä¼ é€’åï¼Œè‹¥å½¢å‚å˜ï¼Œå®å‚ä¹Ÿå˜  

pythonå†…éƒ¨æœ‰internä¼˜åŒ–æœºåˆ¶ï¼Œå°†ä¸€å®šèŒƒå›´çš„å°æ•´æ•°å°å­—ç¬¦ä¸²ï¼Œå…¨å±€åŒ–å­˜å‚¨ï¼Œå…¶ä»–å¯¹è±¡å†ç”³è¯·å°æ•´æ•°ç›´æ¥æŒ‡å‘è¿™ä¸ªæ•´æ•°å¯¹è±¡
è‡ªå®šä¹‰çš„ç±»æœ¬èº«ä¹Ÿæ˜¯å…¨å‰§å”¯ä¸€çš„å¯¹è±¡ï¼Œæ‰€ä»¥è¿™æ—¶å€™ä½¿ç”¨idæŸ¥çœ‹ä¼šå‘ç°æ˜¯åŒä¸€ä¸ª  
å½“å¯¹ä¸å¯å˜å¯¹è±¡é‡æ–°èµ‹å€¼çš„æ—¶å€™ï¼Œä¼šé‡æ–°å¼€è¾Ÿä¸€æ®µå†…å­˜ç©ºé—´ï¼Œå¹¶å°†åœ°å€å¼•ç”¨æŒ‡å‘æ–°å¼€è¾Ÿçš„ç©ºé—´ï¼ŒåŸæœ‰çš„å†…å­˜ç©ºé—´å°†è¢«å›æ”¶  

#### GCåƒåœ¾å›æ”¶
é‡‡ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•å¼•ç”¨æ•°é‡ä¸º0çš„æ—¶å€™å›æ”¶ï¼Œå¼•ç”¨è®¡æ•°æœŸé—´ä¼šæš‚åœç¨‹åºï¼Œpythonä½¿ç”¨åˆ†ä»£çš„åƒåœ¾å›æ”¶æ ‡è®°-æ¸…é™¤æ³•ï¼Œæé«˜å›æ”¶æ•ˆç‡å‡å°‘æš‚åœæ—¶é—´ã€‚
delæœ¬è´¨ä¸Šè°ƒç”¨çš„æ˜¯`__del__`åˆ é™¤çš„,å¯ä»¥é‡è½½æ¯”å¦‚åˆ é™¤æ—¶é‡Šæ”¾èµ„æº  
åœ¨Cä¸­ç»´æŠ¤äº†Raphaelå¾ªç¯åŒå‘é“¾è¡¨ï¼Œä¿å­˜æ‰€æœ‰å¯¹è±¡ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹å†…éƒ¨æœ‰ob_refä¿å­˜å½“å‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ï¼Œé¢‘ç¹çš„å›æ”¶å’Œåˆ›å»ºä¼šé™ä½æ•ˆç‡ï¼Œä½¿ç”¨ç¼“å­˜æœºåˆ¶(æ¯”å¦‚å°intå’Œstr)ä¼˜åŒ–  
>1.æ ‡è®°æ¸…é™¤ç®—æ³•ï¼šç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªé˜¶æ®µï¼Œé¦–å…ˆæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚æœ‰ä¸¤ä¸ªä¸è¶³ï¼šä¸€æ˜¯æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ•ˆç‡éƒ½ä¸é«˜ï¼›å¦ä¸€ä¸ªæ˜¯ç©ºé—´é—®é¢˜ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´ä»¥ååœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§å¯¹è±¡æ—¶ï¼Œæ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œ  
>
>2.å¤åˆ¶ç®—æ³•ï¼šå°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™æ ·ä½¿å¾—æ¯æ¬¡éƒ½æ˜¯å¯¹ä¸€æ•´å—å†…å­˜å›æ”¶ï¼Œå†…å­˜åˆ†é…æ—¶å€™ä¹Ÿä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡ç­‰å¤æ‚æƒ…å†µï¼Œåªè¦ç§»åŠ¨å †é¡¶æŒ‡é’ˆï¼ŒæŒ‰é¡ºåºåˆ†é…å³å¯ï¼Œå®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆã€‚ç¼ºç‚¹æ˜¯ä¸€æ¬¡åªèƒ½ä½¿ç”¨ä¸€éƒ¨åˆ†å†…å­˜ï¼Œä¼šæœ‰ä¸€äº›æµªè´¹ã€‚ä¸€èˆ¬æ–°ç”Ÿä»£ä¼šé€‰æ‹©è¿™ç§ç®—æ³•ã€‚  
>
>3.æ ‡è®°-æ•´ç†ç®—æ³•ï¼šå¤åˆ¶ç®—æ³•å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼Œ1ï¼‰ä¼šæµªè´¹50%çš„ç©ºé—´ 2ï¼‰å¦‚æœè¢«ä½¿ç”¨çš„å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡éƒ½100%å­˜æ´»çš„æç«¯æƒ…å†µï¼Œå°±éœ€è¦æœ‰é¢å¤–çš„ç©ºé—´è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œå› æ­¤è€å¹´ä»£ä¸€èˆ¬ä¸èƒ½ç›´æ¥é€‰ç”¨å¤åˆ¶ç®—æ³•ã€‚æœ‰äººæå‡ºäº†å¦å¤–ä¸€ç§â€œæ ‡è®°-æ•´ç†â€ï¼ˆMark-Compactï¼‰ç®—æ³•ï¼Œæ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ä¸€æ ·ï¼Œåç»­æ­¥éª¤è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚  
>
>4.åˆ†ä»£å›æ”¶ç®—æ³•ï¼šåˆ†ä»£å›æ”¶ç®—æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆæ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ã€‚æ¯”å¦‚æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œä¸åŒä»£ä½¿ç”¨ä¸åŒçš„å›æ”¶ç®—æ³•ã€‚æ¯”å¦‚æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ¸…é™¤æˆ–æ ‡è®°-æ•´ç†ç®—æ³•

[æ·±å…¥python->GC](æ·±å…¥python.md#^08132d)

## åºåˆ—ç±»å‹
### åˆ†ç±»
- åºåˆ—ç±»å‹çš„ç±»å‹åˆ†ç±»
	- å®¹å™¨åºåˆ— (æ”¾ç½®ä»»æ„ç±»å‹)
		- listã€tupleã€deque
	- æ‰å¹³åºåˆ—ï¼ˆå¿…é¡»æŒ‡æ˜æ•°æ®ç±»å‹ï¼‰
		- strã€bytesã€bytearrayã€array.array
- å±æ€§åˆ†ç±»
	- å¯å˜åºåˆ—
		- listï¼Œ dequeï¼Œbytearrayã€array
	- ä¸å¯å˜
		- strã€tupleã€bytes

### åºåˆ—åè®®
ç”¨æ³•å¯ä»¥çœ‹[pythonåº“](pythonåº“.md)çš„collectionséƒ¨åˆ†ï¼Œè¿™é‡Œä¸»è¦æ¢è®¨åŸç†  
`collectios.abc`é‡ŒæŸ¥çœ‹å„ç§ç±»å‹å®ç°äº†ä»€ä¹ˆåè®®  
æ¯”å¦‚åºåˆ—å®ç°çš„ABCæ˜¯  

![](./static/pythonè¯­è¨€è¿›é˜¶-images-6.svg)
#### åºåˆ—+=å’Œ+
+ä¸ä¼šæ”¹å˜åŸåºåˆ—ï¼Œè€Œ+=æ˜¯å°±åœ°åŠ ï¼Œæ— è¿”å›å€¼ç›´æ¥åŠ è¿›åŸæ¥çš„  
+å¿…é¡»ä¸ºä¸¤ä¸ªlistç›¸åŠ ï¼Œè€Œ+=åé¢å¯ä»¥æ˜¯ä»»æ„çš„åºåˆ—  
+=æ˜¯é€šè¿‡`__iadd__` è°ƒç”¨çš„**extend**ï¼Œä¸€ä¸ªä¸ªappendè¿›æ¥çš„ï¼Œæ‰€ä»¥åªè¦æ˜¯`Iterable`å°±å¯ä»¥  
`append([1,2])`ä¼šæ•´ä½“åŠ è¿›å»ä¸ä¼šä¸€ä¸ªä¸ªåŠ   

#### åˆ‡ç‰‡
:::details Click to see more
**ç”¨æ³•å¤ä¹ **<br/>
```python
#æ¨¡å¼[start:end:step]
"""
    å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªæ•°å­—startè¡¨ç¤ºåˆ‡ç‰‡å¼€å§‹ä½ç½®ï¼Œé»˜è®¤ä¸º0ï¼›
    ç¬¬äºŒä¸ªæ•°å­—endè¡¨ç¤ºåˆ‡ç‰‡æˆªæ­¢ï¼ˆä½†ä¸åŒ…å«ï¼‰ä½ç½®ï¼ˆé»˜è®¤ä¸ºåˆ—è¡¨é•¿åº¦ï¼‰ï¼›
    ç¬¬ä¸‰ä¸ªæ•°å­—stepè¡¨ç¤ºåˆ‡ç‰‡çš„æ­¥é•¿ï¼ˆé»˜è®¤ä¸º1ï¼‰ã€‚
    å½“startä¸º0æ—¶å¯ä»¥çœç•¥ï¼Œå½“endä¸ºåˆ—è¡¨é•¿åº¦æ—¶å¯ä»¥çœç•¥ï¼Œ
    å½“stepä¸º1æ—¶å¯ä»¥çœç•¥ï¼Œå¹¶ä¸”çœç•¥æ­¥é•¿æ—¶å¯ä»¥åŒæ—¶çœç•¥æœ€åä¸€ä¸ªå†’å·ã€‚
    å¦å¤–ï¼Œå½“stepä¸ºè´Ÿæ•´æ•°æ—¶ï¼Œè¡¨ç¤ºåå‘åˆ‡ç‰‡ï¼Œè¿™æ—¶startåº”è¯¥æ¯”endçš„å€¼è¦å¤§æ‰è¡Œã€‚
"""
aList = [3, 4, 5, 6, 7, 9, 11, 13, 15, 17]
print (aList[::])  # è¿”å›åŒ…å«åŸåˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ–°åˆ—è¡¨
print (aList[::-1])  # è¿”å›åŒ…å«åŸåˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„é€†åºåˆ—è¡¨
print (aList[::2])  # éš”ä¸€ä¸ªå–ä¸€ä¸ªï¼Œè·å–å¶æ•°ä½ç½®çš„å…ƒç´ 
print (aList[1::2])  # éš”ä¸€ä¸ªå–ä¸€ä¸ªï¼Œè·å–å¥‡æ•°ä½ç½®çš„å…ƒç´ 
print (aList[3:6])  # æŒ‡å®šåˆ‡ç‰‡çš„å¼€å§‹å’Œç»“æŸä½ç½®
aList[0:100]  # åˆ‡ç‰‡ç»“æŸä½ç½®å¤§äºåˆ—è¡¨é•¿åº¦æ—¶ï¼Œä»åˆ—è¡¨å°¾éƒ¨æˆªæ–­
aList[100:]  # åˆ‡ç‰‡å¼€å§‹ä½ç½®å¤§äºåˆ—è¡¨é•¿åº¦æ—¶ï¼Œè¿”å›ç©ºåˆ—è¡¨

aList[len(aList):] = [9]  # åœ¨åˆ—è¡¨å°¾éƒ¨å¢åŠ å…ƒç´ 
aList[:0] = [1, 2]  # åœ¨åˆ—è¡¨å¤´éƒ¨æ’å…¥å…ƒç´ 
aList[3:3] = [4]  # åœ¨åˆ—è¡¨ä¸­é—´ä½ç½®æ’å…¥å…ƒç´ 
aList[:3] = [1, 2]  # æ›¿æ¢åˆ—è¡¨å…ƒç´ ï¼Œç­‰å·ä¸¤è¾¹çš„åˆ—è¡¨é•¿åº¦ç›¸ç­‰
aList[3:] = [4, 5, 6]  # ç­‰å·ä¸¤è¾¹çš„åˆ—è¡¨é•¿åº¦ä¹Ÿå¯ä»¥ä¸ç›¸ç­‰
aList[::2] = [0] * 3  # éš”ä¸€ä¸ªä¿®æ”¹ä¸€ä¸ª
print (aList)
aList[::2] = ['a', 'b', 'c']  # éš”ä¸€ä¸ªä¿®æ”¹ä¸€ä¸ª
aList[::2] = [1,2]  # å·¦ä¾§åˆ‡ç‰‡ä¸è¿ç»­ï¼Œç­‰å·ä¸¤è¾¹åˆ—è¡¨é•¿åº¦é¡»ç›¸ç­‰,ä¾‹å­æŠ¥é”™äº†
aList[:3] = []  # åˆ é™¤åˆ—è¡¨ä¸­å‰3ä¸ªå…ƒç´ 

del aList[:3]  # åˆ‡ç‰‡å…ƒç´ è¿ç»­
del aList[::2]  # åˆ‡ç‰‡å…ƒç´ ä¸è¿ç»­ï¼Œéš”ä¸€ä¸ªåˆ ä¸€ä¸ª
```
:::
å¦‚ä½•å®ç°è‡ªå®šä¹‰ç±»çš„åˆ‡ç‰‡  
`slice`æ˜¯ä¸€ç§å¯¹è±¡ï¼Œ`[::]`åˆ‡ç‰‡æ—¶å…ˆåˆå§‹åŒ–ä¸€ä¸ªsliceå¯¹è±¡ç„¶åäº¤ç»™`__getitem__`ä½¿ç”¨ï¼Œ`[0]`ä¼ å…¥çš„æ˜¯æ•°å­—ï¼Œç›´æ¥åˆ¤æ–­ç±»å‹é’ˆå¯¹å¤„ç†
```python
def __getitem__(self, item):
        cls = type(self)
        if isinstance(item, slice):
            return cls(...) # æ„å»ºæ„å»º
        elif isinstance(item, numbers.Integral):
            return cls(...) # æ„å»ºæ„å»º
```

[bisectç»´æŠ¤åºåˆ—æœ‰åº](pythonåº“.md#^194418)

### æ•°ç»„array
è¿™ä¸ªæ•°ç»„æ˜¯Cå†™çš„ï¼Œæ€§èƒ½å¾ˆä¸é”™ï¼Œæ€è€ƒä¸€ä¸‹ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ç”¨æ•°ç»„å¯ä»¥ç”¨arrayä»£æ›¿  
arrayåªèƒ½å­˜æ”¾æŒ‡å®šç±»å‹çš„æ•°ç»„ï¼Œç”³è¯·æ—¶å…ˆæŒ‡å®šå¥½ç±»å‹  
`a=array.array("i")`  

| Type code |      C Type       | Minimum size in bytes |
|:---------:|:-----------------:|:---------------------:|
|    'b'    |  signed integer   |           1           |
|    'B'    | unsigned integer  |           1           |
|    'u'    | Unicode character |     2 (see note)      |
|    'h'    |  signed integer   |           2           |
|    'H'    | unsigned integer  |           2           |
|    'i'    |  signed integer   |           2           |
|    'I'    | unsigned integer  |           2           |
|    'l'    |  signed integer   |           4           |
|    'L'    | unsigned integer  |           4           |
|    'q'    |  signed integer   |     8 (see note)      |
|    'Q'    | unsigned integer  |     8 (see note)      |
|    'f'    |  floating point   |           4           |
|    'd'    |  floating point   |           8           |

ç”¨æ³•æ³¨é‡Šé‡Œå¤´æœ‰ç”¨æ³•ï¼Œç‚¹è¿›å»çœ‹æºç   
æŒ‡å®šäº†ç±»å‹ç„¶åå†æ·»åŠ å…ƒç´ ï¼Œé‚£ä¸ªinitializeræ²¡çœ‹æ‡‚æ˜¯åœ¨å¹²å•¥ï¼Œå¯èƒ½æ˜¯åˆ©ç”¨è¿™åºåˆ—åˆå§‹åŒ–  

### åˆ—è¡¨ç”Ÿæˆå¼
åˆ—è¡¨ç”Ÿæˆå¼æ€§èƒ½æ˜¯é«˜äºåˆ—è¡¨æ™®é€šæ“ä½œçš„ï¼Œå¯ä»¥ç”¨å‡½æ•°æ¥è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯ä»£ç å¯è¯»æ€§ä¼šä¸‹é™ã€‚  

- ç”¨()äº§ç”Ÿçš„æ˜¯ç”Ÿæˆå™¨
-  {}äº§ç”Ÿçš„æ˜¯setï¼Œå¦‚æœå¸¦k:väº§ç”Ÿçš„å°±æ˜¯å­—å…¸
    - æŠŠæ•°å­—å½“ä½œkeyè®©dictçœ‹èµ·æ¥ä¼šåƒåºåˆ—ï¼Œæœ‰ç—…å•Š

*åˆ†ç±»é‡Œçš„å†…ç½®ç±»å‹éƒ½èƒ½ç”¨ï¼Œæƒ³åˆ°çš„æ—¶å€™çœ‹æ–‡æ¡£*  

## Mappingç±»å‹
### å­—å…¸
#### ABCå’Œæ—¥å¸¸ç”¨æ³•
![](./static/pythonè¯­è¨€è¿›é˜¶-images-7.svg)  
ç‚¹è¿›æºç çœ‹æœ‰å“ªäº›æ–¹æ³•ï¼Œå…ˆåˆ—å‡ ä¸ª  

- `fromkeys(iterable,value)`
    - æŠŠiterableä½œä¸ºkeyï¼Œvalueä½œä¸ºé»˜è®¤çš„valueï¼Œç”Ÿæˆå­—å…¸ 
- `keys()`
- `iterms()`
- `get()`
- `setdefault(k:v)`
    - å–å€¼ï¼Œå–ä¸åˆ°å°±è®¾ç½®è¿™å¯¹kvè¿›å»å¹¶ä¸”è¿”å›v
    - å¼ºåŒ–çš„get
- `upadte()`
    - åˆå¹¶å­—å…¸å¯ä»¥æ¥å—å¤šç§å‚æ•°
    - `k=v,[(k,v),(k,v)],{k:v}`

#### dictçš„å­ç±»
:::warning âš ï¸Warning
ä¸è¦ç›´æ¥ç»§æ‰¿å†…ç½®çš„ç±»å‹ï¼Œä»–ä»¬éƒ½æ˜¯Cå†™çš„æœ‰äº›é­”æ³•å‡½æ•°åœ¨å­ç±»é‡Œä¸ç”Ÿæ•ˆ  
ä½¿ç”¨collectionsåº“ä¸­çš„æ¨¡å—è¿›è¡Œè‡ªå®šä¹‰ä¿®æ”¹
:::

`collections.defaultdict`çš„å®ç°æ˜¯ä½¿ç”¨`__missing__`é­”æ³•å‡½æ•°ï¼Œå¦‚æœå–å€¼çš„æ—¶å€™æ‰¾ä¸åˆ°å€¼å°±å»è°ƒç”¨missingé­”æ³•å‡½æ•°

:::warning â“Question
**userdictæºç **<br/>
```python
# userdictæºç 
def __getitem__(self, key):  
    if key in self.data:  
        return self.data[key]  
    if hasattr(self.__class__, "__missing__"):  
        return self.__class__.__missing__(self, key)  # è°ƒç”¨Missing
    raise KeyError(key)
# defaultdictæ–¹æ³•
    def __missing__(self, key): # real signature unknown; restored from __doc__
        """
        __missing__(key) # Called by __getitem__ for missing key; pseudo-code:
          if self.default_factory is None: raise KeyError((key,))
          self[key] = value = self.default_factory()
          return value
        """
        pass
```
:::

defaultdictå…·ä½“ç”¨æ³•çœ‹colletcionsåŒ…

#### seté›†åˆ
æ— åºä¸é‡å¤ï¼Œfrozensetæ˜¯ä¸å¯æ·»åŠ ä¿®æ”¹çš„å€¼ï¼Œä½¿ç”¨hashå®ç°æŸ¥æ‰¾æ€§èƒ½O(1)ï¼Œå¯ä»¥ä½œä¸ºdictçš„keyï¼Œè°ƒç”¨å’Œsetä¸€æ ·  

- `s1.difference(s2)`
    - è¿”å›ä¸€ä¸ªå·®é›†
- é›†åˆçš„å¸¸è§è¿ç®—  
    - `|å¹¶é›†` `&äº¤é›†` `-å·®é›†`  
    - å¹¶äº¤å‰çš„é­”æ³•å‡½æ•°ç”¨åˆ°äº†å†å»æŸ¥ï¼Œæ˜¯æ•°å­¦ç›¸å…³é­”æ³•å‡½æ•°
- è¶…é›†æˆ–å­é›†
    - â€œå°äºâ€ç¬¦å·ï¼ˆ<ã€<=ï¼‰ç”¨æ¥åˆ¤æ–­å­é›†
    - â€œå¤§äºâ€ç¬¦å·ï¼ˆ>ã€ >= ï¼‰ç”¨æ¥åˆ¤æ–­è¶…é›†
    - ç­‰äºå·å…è®¸éä¸¥æ ¼å®šä¹‰çš„å­é›†å’Œè¶…é›†ï¼Œâ€œå°äºâ€ å’Œ â€œå¤§äºâ€æ„å‘³ç€ä¸¤ä¸ªé›†åˆåœ¨æ¯”è¾ƒæ—¶ä¸èƒ½ç›¸ç­‰ã€‚

### å¦‚ä½•å®ç°setå’Œdict
- å¯å“ˆå¸Œçš„(æ˜¯ä¸å¯å˜ç±»å‹)æ‰èƒ½å½“ä½œkey,åœ¨å†…éƒ¨æ˜¯ä½¿ç”¨çº¢é»‘æ ‘å®ç°çš„  
- å†…å­˜èŠ±é”€å¤§  
    - å½“è¡¨å°äº1/3çš„æ—¶å€™ï¼Œå°±ä¼šå¦ç”³è¯·ç©ºé—´ä½¿ç”¨æ•°æ®è¿ç§»ç®—æ³•ç§»åŠ¨è¿‡å»
    - åœ¨python3.7ä¹‹ådicté»˜è®¤æœ‰åºäº†
- ä¼˜å…ˆä½¿ç”¨setè¿›è¡Œå»é‡ï¼Œå ç”¨æ¯”dictå°ï¼Œé€Ÿåº¦æ¯”listå¿«
- **setçš„å»é‡æ˜¯é€šè¿‡ä¸¤ä¸ªå‡½æ•°__hash__å’Œ__eq__ç»“åˆå®ç°çš„ã€‚**
:::details Click to see more

```python
class Uniq:
    def __init__(self,name,count):
        self.name = name
        self.count = count
    def __hash__(self):
        print("%sè°ƒç”¨äº†å“ˆå¸Œæ–¹æ³•"%self.name)
        return hash(self.count)
    def __eq__(self, other):
        print("%sè°ƒç”¨äº†eqæ–¹æ³•"%self.name)
        return self.__dict__ == other.__dict__

u1 = Uniq('u1',1)
u2 = Uniq('u2',1)
u3 = Uniq('u3',3)
print('u1',u1)
print('u2',u2)
print('u3',u3)
alist = [u1,u2,u3]
print(set(alist))
```
è¿è¡Œç»“æœ
```
u1 <__main__.Uniq object at 0x00000226FA0996A0>
u2 <__main__.Uniq object at 0x00000226FA0999E8>
u3 <__main__.Uniq object at 0x00000226FA0C3710>
u1è°ƒç”¨äº†å“ˆå¸Œæ–¹æ³•
u2è°ƒç”¨äº†å“ˆå¸Œæ–¹æ³•
u1è°ƒç”¨äº†eqæ–¹æ³•
u3è°ƒç”¨äº†å“ˆå¸Œæ–¹æ³•
{<__main__.Uniq object at 0x00000226FA0996A0>, <__main__.Uniq object at 0x00000226FA0C3710>, <__main__.Uniq object at 0x00000226FA0999E8>}

```
:::

-------

## é—­åŒ…è£…é¥°å™¨
### é—­åŒ…
>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œé—­åŒ…ï¼ˆè‹±è¯­ï¼šClosureï¼‰ï¼Œåˆç§°è¯æ³•é—­åŒ…ï¼ˆLexical Closureï¼‰æˆ–å‡½æ•°é—­åŒ…ï¼ˆfunction closuresï¼‰ï¼Œæ˜¯å¼•ç”¨äº†è‡ªç”±å˜é‡çš„å‡½æ•°ã€‚è¿™ä¸ªè¢«å¼•ç”¨çš„è‡ªç”±å˜é‡å°†å’Œè¿™ä¸ªå‡½æ•°ä¸€åŒå­˜åœ¨ï¼Œå³ä½¿å·²ç»ç¦»å¼€äº†åˆ›é€ å®ƒçš„ç¯å¢ƒä¹Ÿä¸ä¾‹å¤–ã€‚æ‰€ä»¥ï¼Œæœ‰å¦ä¸€ç§è¯´æ³•è®¤ä¸ºé—­åŒ…æ˜¯ç”±å‡½æ•°å’Œä¸å…¶ç›¸å…³çš„å¼•ç”¨ç¯å¢ƒç»„åˆè€Œæˆçš„å®ä½“ã€‚é—­åŒ…åœ¨è¿è¡Œæ—¶å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œä¸åŒçš„å¼•ç”¨ç¯å¢ƒå’Œç›¸åŒçš„å‡½æ•°ç»„åˆå¯ä»¥äº§ç”Ÿä¸åŒçš„å®ä¾‹ã€‚
>å†…éƒ¨å‡½æ•°å¯¹å¤–éƒ¨å‡½æ•°ä½œç”¨åŸŸå˜é‡çš„å¼•ç”¨

å‡½æ•°å†…éƒ¨çš„å±æ€§ç”Ÿå‘½å‘¨æœŸæ˜¯æ‰§è¡ŒæœŸé—´ï¼Œæ‰§è¡Œå®Œä¹‹åå°±å¯„äº†ï¼Œä½†æ˜¯é—­åŒ…å¯ä»¥è¿”å›å‡½æ•°çš„å¥æŸ„ï¼Œå­—èŠ‚ç å†…ä¿ç•™äº†å¤–å±‚å‡½æ•°ä½¿ç”¨çš„å˜é‡(ç§æœ‰åŒ–)è¿™æ ·å°±åœ¨ç¬¬äºŒæ¬¡è°ƒç”¨çš„æ—¶å¯ä»¥ç»§ç»­ç”¨ï¼Œå¯ä»¥ç”¨æ¥åšè£…é¥°å™¨@  
C++ä¸­æœ‰staticå…³é”®å­—ï¼Œå‡½æ•°ä¸­çš„staticå…³é”®å­—å®šä¹‰çš„å˜é‡ç‹¬ç«‹äºå‡½æ•°ä¹‹å¤–ï¼Œè€Œä¸”ä¼šä¿ç•™å‡½æ•°ä¸­å€¼çš„å˜åŒ–ã€‚å‡½æ•°ä¸­ä½¿ç”¨çš„å…¨å±€å˜é‡ä¹Ÿæœ‰ç±»ä¼¼çš„æ€§è´¨ã€‚  
```python
def func1(arg1):  
    print("in func1")  
    def func2(num):  
        num+=arg1  
        print(num)  
    return func2  
var=func1(3)  
var(2)
#----ç»“æœ----
in func1
5
```
#### å¯è§ä¸ç»‘å®š
è¿™ä¸¤ç¯‡æ–‡ç« ä»”ç»†é˜…è¯»ï¼Œè®°ä½é—­åŒ…çš„å‘å’Œè¿‡ç¨‹  
[Python UnboundLocalErrorå’ŒNameErroré”™è¯¯æ ¹æºè§£æ](https://www.linuxidc.com/Linux/2020-02/162395.htm)  
[æ·±å…¥ç†è§£Pythoné—­åŒ…æ¦‚å¿µ](https://www.linuxidc.com/Linux/2020-02/162394.htm)  
åœ¨Cæˆ–è€…C++ä¸­ï¼Œåªè¦å£°æ˜å¹¶å®šä¹‰äº†ä¸€ä¸ªå˜é‡æˆ–è€…å‡½æ•°ï¼Œä¾¿å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ä½†æ˜¯åœ¨Pythonä¸­è¦æƒ³å¼•ç”¨ä¸€ä¸ªnameï¼Œè¯¥nameå¿…é¡»è¦å¯è§è€Œä¸”æ˜¯ç»‘å®šçš„ã€‚Free variableæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µï¼Œåœ¨é—­åŒ…ä¸­å¼•ç”¨çš„çˆ¶å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡æ˜¯ä¸€ä¸ªfree variableï¼Œè€Œä¸”è¯¥free variableè¢«å­˜æ”¾åœ¨ä¸€ä¸ªcellå¯¹è±¡ä¸­ã€‚è¿™ä¸ªä¼šåœ¨é—­åŒ…ç›¸å…³çš„æ–‡ç« ä¸­ä»‹ç»ã€‚scopeåœ¨å‡½æ•°ä¸­å…·æœ‰å¯æ‰©å±•æ€§ï¼Œä½†åœ¨ç±»å®šä¹‰ä¸­ä¸å…·æœ‰å¯æ‰©å±•æ€§ã€‚é—­åŒ…ä¸­çš„free variableå¯ä¸å¯ä»¥è¢«å¼•ç”¨å–å†³äºå®ƒä»¬æœ‰æ²¡æœ‰è¢«ç»‘å®šåˆ°å…·ä½“çš„å¯¹è±¡ã€‚  
è¿™æ®µä»£ç ä¼šæŠ¥é”™ï¼Œæƒ³æƒ³ä¸ºä»€ä¹ˆã€‚
```python
def outer_func():  
    loc_var = "local variable" # ç»‘å®šå¹¶å£°æ˜  
    def inner_func():# è¿™é‡Œç©¿è¿›å»ä¹Ÿæ²¡ç”¨  
        loc_var+=" in inner func"# å¿…é¡»æ–°ç”³è¯·ä¸€ä¸ªå˜é‡æ‰å¯ä»¥è§£å†³  
        return loc_var  
    return inner_func

import sys  
def add_path(new_path):  
    path_list = sys.path  # è¿™é‡Œä¼šæŠ¥é”™
    if new_path not in path_list:  
        import sys  
        sys.path.append(new_path)  
add_path('./')
```
-   é—­åŒ…ä¸­çš„å¼•ç”¨çš„è‡ªç”±å˜é‡åªå’Œå…·ä½“çš„é—­åŒ…æœ‰å…³è”ï¼Œé—­åŒ…çš„æ¯ä¸ªå®ä¾‹å¼•ç”¨çš„è‡ªç”±å˜é‡äº’ä¸å¹²æ‰°ã€‚
-   ä¸€ä¸ªé—­åŒ…å®ä¾‹å¯¹å…¶è‡ªç”±å˜é‡çš„ä¿®æ”¹ä¼šè¢«ä¼ é€’åˆ°ä¸‹ä¸€æ¬¡è¯¥é—­åŒ…å®ä¾‹çš„è°ƒç”¨ã€‚
:::details Click to see more
**é—­åŒ…çš„è‡ªç”±å˜é‡**<br/>
```python
def outer_func():  
Â  Â  loc_list = []  
Â  Â  def inner_func(name):  
Â  Â  Â  Â  loc_list.append(len(loc_list) + 1)  
Â  Â  Â  Â  print('%s loc_list = %s' %(name, loc_list))
Â  Â  return inner_func

clo_func_0 = outer_func()  
clo_func_0('clo_func_0')  
clo_func_0('clo_func_0')  
clo_func_0('clo_func_0')  
clo_func_1 = outer_func()  
clo_func_1('clo_func_1')  
clo_func_0('clo_func_0')  
clo_func_1('clo_func_1')

```
è¿è¡Œç»“æœ
```
clo_func_0 loc_list = [1]  
clo_func_0 loc_list = [1, 2]  
clo_func_0 loc_list = [1, 2, 3]  
clo_func_1 loc_list = [1]  
clo_func_0 loc_list = [1, 2, 3, 4]  
clo_func_1 loc_list = [1, 2]
```
:::
ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¾—å‡ºä¸‹é¢ä¸€ä¸ªé‡è¦çš„ç»éªŒï¼šè¿”å›é—­åŒ…ä¸­ä¸è¦å¼•ç”¨ä»»ä½•å¾ªç¯å˜é‡ï¼Œæˆ–è€…åç»­ä¼šå‘ç”Ÿå˜åŒ–çš„å˜é‡ã€‚  
è¿™æ¡è§„åˆ™æœ¬è´¨ä¸Šæ˜¯åœ¨è¿”å›é—­åŒ…å‰ï¼Œé—­åŒ…ä¸­å¼•ç”¨çš„çˆ¶å‡½æ•°ä¸­å®šä¹‰å˜é‡çš„å€¼å¯èƒ½ä¼šå‘ç”Ÿä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„å˜åŒ–ã€‚  
æ­£ç¡®çš„åšæ³•ä¾¿æ˜¯å°†çˆ¶å‡½æ•°çš„local variableèµ‹å€¼ç»™å‡½æ•°çš„å½¢å‚ã€‚å‡½æ•°å®šä¹‰æ—¶ï¼Œå¯¹å½¢å‚çš„ä¸åŒèµ‹å€¼ä¼šä¿ç•™åœ¨å½“å‰å‡½æ•°å®šä¹‰ä¸­ï¼Œä¸ä¼šå¯¹å…¶ä»–å‡½æ•°æœ‰å½±å“ã€‚  
å¦å¤–æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœè¿”å›çš„å‡½æ•°ä¸­æ²¡æœ‰å¼•ç”¨çˆ¶å‡½æ•°ä¸­å®šä¹‰çš„local variableï¼Œé‚£ä¹ˆè¿”å›çš„å‡½æ•°ä¸æ˜¯é—­åŒ…å‡½æ•°ã€‚  
ç®€è€Œè¨€ä¹‹é—­åŒ…æ˜¯æƒ°æ€§çš„ï¼Œå¦‚æœå¾ªç¯ä¸­içš„å€¼å˜äº†ï¼Œé‚£é—­åŒ…é‡Œé¢ä¹Ÿä¼šå˜  
pythoné—­åŒ…ä¸­å¼•ç”¨çš„è‡ªç”±å˜é‡å®é™…å­˜æ”¾åœ¨ä¸€ä¸ªCellå¯¹è±¡ä¸­ï¼Œå½“è‡ªç”±å˜å…ƒè¢«é—­åŒ…å¼•ç”¨æ—¶ï¼Œä¾¿å°†Cellä¸­å­˜æ”¾çš„è‡ªç”±å˜é‡çš„å¼•ç”¨æ”¾å…¥æ ˆé¡¶ã€‚  
:::details Click to see more
**é—­åŒ…ä½¿ç”¨å¾ªç¯ä¸­å˜é‡çš„ä¾‹å­**<br/>
```python
def my_func(*args):  
Â  Â  fs = []  
Â  Â  for i in xrange(3):  
Â  Â  Â  Â  def func():  
Â  Â  Â  Â  Â  Â  return i * i  
Â  Â  Â  Â  fs.append(func)  
Â  Â  return fs

fs1, fs2, fs3 = my_func()  
print(fs1())
print(fs2())
print(fs3())
```
è¿è¡Œç»“æœ
```
4
4
4
```
æ”¹å†™
```python
def my_func(*args):  
Â  Â  fs = []  
Â  Â  for i in range(3):  
Â  Â  Â  Â  def func(_i = i):  
Â  Â  Â  Â  Â  Â  return _i * _i  
Â  Â  Â  Â  fs.append(func)  
Â  Â  return fs
Â # æˆ–è€…
def my_func(*args):
    fs = []
    for i in range(3):
        func = lambda _i = i : _i * _i
        fs.append(func)
    return fs
```
:::

### è£…é¥°å™¨
è£…é¥°å™¨æ˜¯é—­åŒ…å®ç°çš„  
å¦‚æœæˆ‘ä»¬æƒ³å¯¹ä¸€ä¸ªå‡½æ•°æˆ–è€…ç±»è¿›è¡Œä¿®æ”¹é‡å®šä¹‰ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ç›´æ¥ä¿®æ”¹å…¶å®šä¹‰ã€‚ä½†æ˜¯è¿™ç§åšæ³•çš„ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„
-   å¯èƒ½çœ‹ä¸åˆ°å‡½æ•°æˆ–è€…ç±»çš„å®šä¹‰
-   ä¼šç ´ååŸæ¥çš„å®šä¹‰ï¼Œå¯¼è‡´åŸæ¥å¯¹ç±»çš„å¼•ç”¨ä¸å…¼å®¹
-   å¦‚æœå¤šäººæƒ³åœ¨åŸæ¥çš„åŸºç¡€ä¸Šå®šåˆ¶è‡ªå·±å‡½æ•°ï¼Œå¾ˆå®¹æ˜“å†²çª
è£…é¥°å™¨æ ¼å¼
```python
def log(func):
    def wrapper(*args, **kw):
        print('call %s():' % func.__name__) # åŠŸèƒ½ä»£ç 
        return func(*args, **kw)
    return wrapper

#----ä¸‰å±‚åµŒå¥—----
def log(text): # å¯ä»¥å¸¦å‚æ•°äº†
    def decorator(func):
        def wrapper(*args, **kw):
            print('%s %s():' % (text, func.__name__))
            return func(*args, **kw)
        return wrapper
    return decorator
@log('execute')
def now():
    print('2015-3-25')
now = log('execute')(now)
```

ä»¥ä¸Šä¸¤ç§decoratorçš„å®šä¹‰éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†ç»è¿‡decoratorè£…é¥°ä¹‹åçš„å‡½æ•°ï¼Œå®ƒä»¬çš„`__name__`å·²ç»ä»åŸæ¥çš„`'now'`å˜æˆäº†`'wrapper'`
```python
print(now.__name__)
'wrapper'
```

å› ä¸ºè¿”å›çš„é‚£ä¸ª`wrapper()`å‡½æ•°åå­—å°±æ˜¯`'wrapper'`ï¼Œæ‰€ä»¥ï¼Œéœ€è¦æŠŠåŸå§‹å‡½æ•°çš„`__name__`ç­‰å±æ€§å¤åˆ¶åˆ°`wrapper()`å‡½æ•°ä¸­ï¼Œå¦åˆ™ï¼Œæœ‰äº›ä¾èµ–å‡½æ•°ç­¾åçš„ä»£ç æ‰§è¡Œå°±ä¼šå‡ºé”™ã€‚  
ä¸éœ€è¦ç¼–å†™`wrapper.__name__ = func.__name__`è¿™æ ·çš„ä»£ç ï¼ŒPythonå†…ç½®çš„`functools.wraps`å°±æ˜¯å¹²è¿™ä¸ªäº‹çš„ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªå®Œæ•´çš„decoratorçš„å†™æ³•å¦‚ä¸‹ï¼š
```python
import functools

def log(func):
    @functools.wraps(func)
    def wrapper(*args, **kw):
        print('call %s():' % func.__name__)
        return func(*args, **kw)
    return wrapper
```
ç»è¿‡è£…é¥°å™¨ä¿®é¥°åï¼Œæˆ‘ä»¬å®šä¹‰çš„ç±»my_clså·²ç»æˆä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå’Œä¸Šé¢ä¸€ä¸ªé”™è¯¯ï¼Œå®ƒä¸ä»…æ”¹å˜äº†å‡½æ•°çš„åå­—ï¼Œè€Œä¸”æ”¹å˜äº†ç±»å‹  
é—­åŒ…å’Œè£…é¥°å™¨å¼•ç”¨äº†linuxå…¬ç¤¾çš„ä¿©æ–‡ç« å’Œå»–é›ªå³°çš„  
### åå‡½æ•°
[pythonåº“->functools](pythonåº“.md#^ff28bf)

## è¿­ä»£å™¨å’Œç”Ÿæˆå™¨

### è¿­ä»£å™¨

^a159bd

å¯è¿­ä»£ç±»å‹(Iterable)éƒ½æ˜¯å®ç°äº†è¿­ä»£åè®®`__iter__`,å°±æ˜¯ABCä¸­çš„`Iterable`  
è¿­ä»£å™¨(Iterator)æ˜¯æƒ°æ€§è¿”å›åŒºåˆ«äºä¸‹æ ‡ï¼Œå®ç°çš„æ˜¯`__iter__`,`__next__`,ABCä¸­çš„`Iterator`å°±æ˜¯å®ç°äº†è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œè®¿é—®æ•°æ®ä½¿ç”¨çš„æ˜¯`__next__`ï¼Œä¸€èˆ¬ç”¨æ¥éå†  
å¯ä»¥ä½¿ç”¨`iter(list)`å°†Iterableè½¬ä¸ºIterator  
å¦‚æœå¯¹åªå®ç°äº†`__getitem__`çš„å¯¹è±¡ç›´æ¥ä½¿ç”¨forï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ä¼˜åŒ–é€€è¡Œå¯»æ‰¾  
è§£é‡Šå™¨å…ˆè°ƒç”¨`iter(obj)`->æ‰¾ä¸åˆ°`__iter__`->åˆ›å»º`__iter__`å¹¶ä»0éå†`__getitem__`  
æ‰€ä»¥å¦‚æœä½ æŠŠ`__iter__`é‡è½½äº†ä¸è¿”å›`Iterator`çš„è¯é‚£å°±æŠ¥é”™ã€‚
  
è‡ªå·±å®ç°iteratorçš„æ—¶å€™ï¼Œè‡ªå®šä¹‰`__iter__`å’Œ`__next__`å°±å¯ä»¥äº†ï¼Œå®é™…ä¸Šforå°±æ˜¯ä¸åœè°ƒç”¨next.  
è‡ªå·±è®¾è®¡è¿­ä»£å¯¹è±¡çš„æ—¶å€™ï¼Œ`Iterable`é‡Œé¢ä¸è¦å†™`__next__`ï¼Œ`__iter__`è¿”å›`Iterator`è¿›è¡Œç»´æŠ¤  

:::details Click to see more

```python
from collections.abc import Iterator   
  
class Company(object):  
    def __init__(self, employee_list):  
        self.employee = employee_list  
  
    def __iter__(self): # è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ç»´æŠ¤  
        return MyIterator(self.employee)  
  
    # def __getitem__(self, item): # å¯è¿­ä»£å¯¹è±¡  
    #     return self.employee[item]  
  
class MyIterator(Iterator):  
    def __init__(self, employee_list):  
        self.iter_list = employee_list  
        self.index = 0  
    # def __iter__(self): #è¿™æ˜¯Iteratoræ›¿ä½ åšçš„äº‹æƒ…  
    #     return self  
    def __next__(self):  # å¿…é¡»å®ç°çš„å‡½æ•°
        #çœŸæ­£è¿”å›è¿­ä»£å€¼çš„é€»è¾‘  
        try:  
            word = self.iter_list[self.index]  
        except IndexError:  
            raise StopIteration # forè¿­ä»£åè®®ä¸­é‡åˆ°è¿™ä¸ªé”™è¯¯å°±åœæ­¢  
        self.index += 1  
        return word  
  
  
company = Company(["tom", "bob", "jane"])  
my_itor = iter(company)  
for item in company:  
    print (item)
```
è¿è¡Œç»“æœ
```
tom
bob
jane
```
:::
listæ¨å¯¼å¼åº”è¯¥æ˜¯å…ˆç¡®å®šå¤§å°ï¼Œå†å¼€è¾Ÿå†…å­˜ï¼Œæ‰€ä»¥å¿«ï¼Œforå¾ªç¯åŠ å°¾æ’çš„è¯è¦æ‰©å®¹å¤šæ¬¡ï¼Œæ‰€ä»¥æ…¢  
è¿™é‡Œå­¦çš„ä¸å¤ªç‰¢é ï¼Œå¤šçœ‹çœ‹æƒ³æƒ³

### ç”Ÿæˆå™¨

åªè¦å­˜åœ¨yieldæ›¿æ¢æ‰returnå°±è½¬æ¢æˆäº†ç”Ÿæˆå™¨ï¼Œä¹Ÿå¯ä»¥returnï¼Œè°ƒç”¨å‡½æ•°å®é™…ä¸Šè¿”å›çš„æ˜¯ç”Ÿæˆå™¨å¯¹è±¡  
#### å‡½æ•°è¿è¡ŒåŸç†
è§£é‡Šå™¨python.exeä¼šä½¿ç”¨Cå‡½æ•°`PyEval_EvalFramEX()`å»æ‰§è¡Œå‡½æ•°ï¼Œé¦–å…ˆåˆ›å»ºæ ˆå¸§å‹æ ˆï¼Œä½¿ç”¨`dis.dis()`å¯ä»¥æŸ¥çœ‹å¯¹è±¡çš„ç”Ÿæˆçš„å­—èŠ‚ç å¯¹è±¡ï¼Œå…¨å±€å”¯ä¸€ï¼Œå½“å‡½æ•°åµŒå¥—æ—¶ï¼Œå°±ä¼šç»§ç»­åˆ›å»ºæ ˆå¸§å‹æ ˆï¼Œè¿™æ ·å‡ºæ ˆä¿æŒå‡½æ•°å¯ä»¥æ‰§è¡Œé¡ºåºï¼Œæ‰€æœ‰çš„æ ˆå¸§éƒ½å­˜æ”¾åœ¨å †å†…å­˜ä¸Šï¼Œè¿™å°±å†³å®šäº†æ ˆå¸§å¯ä»¥ç‹¬ç«‹äºè°ƒç”¨è€…å­˜åœ¨  
  
é™æ€è¯­è¨€ä¸­å‡½æ•°æ˜¯å­˜æ”¾åœ¨æ ˆå†…å­˜ä¸­çš„ï¼Œè°ƒç”¨å®Œå°±ä¼šé”€æ¯ã€‚
:::details Click to see more
**ä¸ç”¨æŒæ¡,çŸ¥é“å°±è¡Œ**<br/>
```python
import inspect # æŸ¥çœ‹æ ˆå¸§çš„åŒ…  
frame = None  
def foo():  
    bar() # å¥—å¨ƒä¸€ä¸ªå‡½æ•°  
def bar():  
    global frame  
    frame = inspect.currentframe() # è·å–å½“å‰å‡½æ•°æ ˆå¸§  
  
import dis  
print(dis.dis(foo)) # æŸ¥çœ‹å‡½æ•°å­—èŠ‚ç å¯¹è±¡  
  
foo() # è°ƒç”¨å®Œä¹‹åå¹¶æ²¡æœ‰é”€æ¯  
print(frame.f_code.co_name) # æŸ¥çœ‹æ ˆå¸§å¯¹è±¡  
caller_frame = frame.f_back # æŸ¥çœ‹ä¸Šçº§?æ ˆå¸§å¯¹è±¡  
print(caller_frame.f_code.co_name)
```
è¿è¡Œç»“æœ
```
  4           0 LOAD_GLOBAL              0 (bar)
              2 CALL_FUNCTION            0
              4 POP_TOP
              6 LOAD_CONST               0 (None)
              8 RETURN_VALUE
None
bar
foo
```
:::
![](./static/pythonè¯­è¨€è¿›é˜¶-images-8.png)

#### ç”Ÿæˆå™¨åŸç†
ç”Ÿæˆå™¨æ­£æ˜¯åˆ©ç”¨äº†å‡½æ•°æ˜¯å­˜æ”¾åœ¨å †è¿™ä¸€ç‰¹æ€§å®ç°çš„ï¼Œè§£é‡Šå™¨æ‰¾åˆ°yieldå°±æ ‡è®°å‡½æ•°ä¸ºç”Ÿæˆå™¨å¯¹è±¡  
![](./static/pythonè¯­è¨€è¿›é˜¶-images-9.png)
PyFrameObjectä¼šè®°å½•æœ€è¿‘æ‰§è¡Œçš„ä»£ç å’Œå˜é‡ï¼Œä»¥æ­¤å¯ä»¥ç”¨yieldæ¥æš‚åœå‡½æ•°  
å®é™…ä¸ŠUserListå°±æ˜¯åˆ©ç”¨yieldå®ç°çš„åœ¨collections.abcçš„Sequenceå¯çœ‹æºç   

:::tip ğŸ“ŒTip
range()è¿”å›çš„æ˜¯ä¸€ä¸ªlistå¯¹è±¡ï¼Œè€Œxrangeè¿”å›çš„æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡(xrange object)  
åœ¨python3 ä¸­æ²¡æœ‰xrangeï¼Œåªæœ‰rangeã€‚rangeå’Œpython2 ä¸­çš„xrange()ä¸€æ ·  
:::
#### example-2è¯»å–å¤§æ–‡ä»¶
æŸæ–‡æœ¬æ–‡ä»¶åªæœ‰ä¸€è¡Œï¼Œ100G+ï¼Œæ¯æ¡æ•°æ®æŒ‰ç…§åˆ†å‰²ç¬¦åˆ†å‰²é•¿åº¦ä¸å›ºå®šï¼Œå¦‚æœç›´æ¥openä¼šåŠ è½½åˆ°å†…å­˜å¡æ­»ï¼Œreadå¯ä»¥æŒ‰å›ºå®šå¤§å°å­—èŠ‚è¯»å–ã€‚  
è¦æ±‚ä½¿ç”¨foréå†æ‰€æœ‰è¡Œ  

:::details Click to see more
**å¤§æ–‡ä»¶è¯»å–**<br/>
```python
def read_large_line(uri):  
    buffer="" # å˜é‡ç¼“å†²å­—ç¬¦ä¸²  
    with open(uri,"r",encoding="utf8") as f: # æ‰“å¼€æ–‡ä»¶  
        while True:# å¾ªç¯  
            while buffer.find("{|}")==-1: # å¦‚æœbuffé‡Œæ²¡æœ‰åˆ†å‰²ç¬¦  
                # å‡è®¾ä¸€è¡Œä¸ä¼šç‰¹åˆ«å¤§ï¼Œè¿™æ ·bufferå¥½æ“ä½œï¼Œä¸€æ¬¡æ€§åªè¯»å–20B  
                readtemp=f.read(20)  
                if readtemp=="":# è¿”å›è¿™ä¸ªå°±æ˜¯è¯»å®Œäº†  
                    print(buffer) # è¯»å®Œäº†æŠŠæœ€åä¸€ä¸ªä¹Ÿæ‰“å°ä¸€ä¸‹  
                    return "æ‰“å°å®Œæ¯•" # ç»“æŸç”Ÿæˆå™¨  
                buffer+=readtemp # bufferä¸Šæ¬¡å‰©ä¸‹çš„æ¥ä¸Šæ–°è¯»çš„  
            # è¯»å‡ºæ¥ä¸‰ç§æƒ…å†µï¼Œæ­£å¥½åˆ‡å‰²å®Œï¼Œå‰©ä¸ªå°¾å·´,åˆ†å‰²ç¬¦è¢«åˆ‡äº† 
            buffer=buffer.split("{|}")# è·³å‡ºå¾ªç¯è¯´æ˜æœ‰ä¸ªåˆ†å‰²ç¬¦  
            for i in buffer[:-1]:# æœ€åä¸€ä¸ªå¯èƒ½æ˜¯åŠæˆªï¼Œä¸å‡ºå»  
                yield i # å‡ºå»ä¸€è¡Œ  
            buffer=buffer[-1]# èµ‹å€¼åŠæˆªè¿›å…¥ä¸‹æ¬¡å¾ªç¯  
for i in read_large_line("a.txt"):  
    print(i)
```
è¿è¡Œç»“æœ
```
é˜¿æ–¯é¡¿æ’’è¿‡çš„æœç”«åœ°æ–¹å®˜
sadhashdisgbiasdmbfgisadhashdisg...
ahndsaidbi
é˜¿æ–¯sdsadasç”«åœ°æ–¹å®˜
sad566849694dmbfgi
ahndwqewq34assadbi
é˜¿æ–¯7å»æ²ƒå°”ç‰¹å‘•åç—…åœ°æ–¹å®˜
sadhaåˆ†è¨æ–¯çš„iasdmbfgi
ahnè¨èŠ¬è¨è¾¾åˆ°äº†åˆ†aidbi
é˜¿æ–¯sdsçš„åœ£å½¼å¾—å ¡å®˜
sad566fghdfdgsaaahjkmbfgi
ahn8956895bi
```
:::

### ç”Ÿæˆå™¨è¿›é˜¶
#### yieldçš„å…¶ä»–ç”¨æ³•
ç”Ÿæˆå™¨ä¸ä»…å¯ä»¥yieldå‡ºå€¼ï¼Œè¿˜å¯ä»¥æ¥æ”¶å€¼  
ä½¿ç”¨`y=yield value`å°±å¯ä»¥æ‹¿åˆ°yï¼Œæ­¤æ—¶å¤–éƒ¨è°ƒç”¨å°±ä¸èƒ½æ˜¯nextï¼Œè€Œæ˜¯ç”¨`send`ã€‚  
`gen.close()`ä¹‹åå°±æ— æ³•nextäº†ï¼ŒæŠ›å‡ºé”™è¯¯  
BaseException æ˜¯ Exception çš„çˆ¶ç±»ï¼Œä½œä¸ºå­ç±»çš„Exceptionæ— æ³•æˆªè·çˆ¶ç±»BaseExceptionç±»å‹çš„é”™è¯¯  
:::details Click to see more

```python
def y():  
    h=yield "a"  
    yield h  
    yield "c"  
    yield "d"  
  
gen=y()  
print(next(gen),  
      # ç¬¬ä¸€æ¬¡å…ˆyieldå‡ºæ¥ï¼Œç¬¬ä¸€æ¬¡ä¸yieldå‡½æ•°æ ¹æœ¬æ²¡æœ‰æ‰§è¡Œæˆyieldå¯¹è±¡  
      # å¦åˆ™ä¼šæŠ¥é”™ä¸èƒ½sendéNoneå¯¹è±¡ï¼Œå…ˆnextæˆ–è€…send(None)  
      gen.send("off"),  
      # è¿™é‡Œçš„sendæ˜¯å»¶è¿Ÿä¼ å…¥çš„ï¼Œå…ˆç»™ä¸Šä¸€ä¸ªhèµ‹å€¼è¿›å»ï¼Œåœ¨è·å–è¿™ä¸ªyieldï¼Œè¿‡ç¨‹éƒ½æ˜¯æƒ°æ€§çš„  
      next(gen)  
      # æ²¡äº†å°±æŠ›StopIteration  
      )  
gen.throw(Exception,"custom-error")  
# è®©genæŠ›å‡ºå¼‚å¸¸ï¼Œåœ¨æ²¡æ‰“å°çš„é‚£ä¸ªyieldä¹‹å‰  
gen.close() # å…³é—­ç”Ÿæˆå™¨  
next(gen)# æŠ›å‡ºStopIteration
```
è¿è¡Œç»“æœ
```
a off c
Traceback (most recent call last):
  File "/Users/jack/code/py/AdvancedPython/asyncio_prac/yeild-senior.py", line 17, in <module>
    gen.throw(Exception,"custom-error")
  File "/Users/jack/code/py/AdvancedPython/asyncio_prac/yeild-senior.py", line 5, in y
    yield "c"
Exception: custom-error
```
:::
#### yield from
è°ƒç”¨æ–¹å’Œå­ç”Ÿæˆå™¨ä¹‹é—´å»ºç«‹é€šé“ï¼Œå¤„ç†ä¸€å¤§å †è¾¹ç•Œå¼‚å¸¸ã€‚
:::details Click to see more

```python
def G():  # å­ç”Ÿæˆå™¨  
    temp=yield "yy"  
    yield temp  
    yield "yy"  
    yield "yy"  
  
def g1(gen):  # å§”æ‰˜ç”Ÿæˆå™¨  
    yield from gen # ä¼šåœ¨è°ƒç”¨æ–¹å’Œå­ç”Ÿæˆå™¨é—´å»ºç«‹ä¸€ä¸ªåŒå‘é€šé“  
  
def main():  # è°ƒç”¨æ–¹  
    gen = G()  
    g = g1(gen)  
    print(next(g),  
          g.send("what?"),# sendç›´æ¥å‘é€åˆ°å­ç”Ÿæˆå™¨äº†  
          )  
main()
```
è¿è¡Œç»“æœ
```
yy what?
```
:::
è¿™ä¸€èŠ‚[PEP 380 â€“ Syntax for Delegating to a Subgenerator | peps.python.org](https://peps.python.org/pep-0380/) ä»£ç è®²çš„æ˜¯åŸç†  
[è§†é¢‘](https://cloud.ooowl.fun/api/v3/file/source/1097/12-9%20%E7%94%9F%E6%88%90%E5%99%A8%E8%BF%9B%E9%98%B6-yield%20from-2.mp4?sign=hcx9fkeSflcjLLy87iziaY-keyxtgTVdX6xCOHfFTrY%3D%3A0)  

:::details Click to see more
**PEP380ä»£ç yield fromç¿»è¯‘è®²è§£**<br/>
```python
#pep380  
  
#1. RESULT = yield from EXPRå¯ä»¥ç®€åŒ–æˆä¸‹é¢è¿™æ ·  
#ä¸€äº›è¯´æ˜  
"""  
_iï¼šå­ç”Ÿæˆå™¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£å™¨  
_yï¼šå­ç”Ÿæˆå™¨ç”Ÿäº§çš„å€¼  
_rï¼šyield from è¡¨è¾¾å¼æœ€ç»ˆçš„å€¼  
_sï¼šè°ƒç”¨æ–¹é€šè¿‡send()å‘é€çš„å€¼  
_eï¼šå¼‚å¸¸å¯¹è±¡  
  
"""  
  
_i = iter(EXPR)      # EXPRæ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œ_iå…¶å®æ˜¯å­ç”Ÿæˆå™¨ï¼›  
try:  
    _y = next(_i)   # é¢„æ¿€å­ç”Ÿæˆå™¨ï¼ŒæŠŠäº§å‡ºçš„ç¬¬ä¸€ä¸ªå€¼å­˜åœ¨_yä¸­ï¼›  
except StopIteration as _e:  
    _r = _e.value   # å¦‚æœæŠ›å‡ºäº†`StopIteration`å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±å°†å¼‚å¸¸å¯¹è±¡çš„`value`å±æ€§ä¿å­˜åˆ°_rï¼Œè¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µçš„è¿”å›å€¼ï¼›  
else:  
    while 1:    # å°è¯•æ‰§è¡Œè¿™ä¸ªå¾ªç¯ï¼Œå§”æ‰˜ç”Ÿæˆå™¨ä¼šé˜»å¡ï¼›  
        _s = yield _y   # ç”Ÿäº§å­ç”Ÿæˆå™¨çš„å€¼ï¼Œç­‰å¾…è°ƒç”¨æ–¹`send()`å€¼ï¼Œå‘é€è¿‡æ¥çš„å€¼å°†ä¿å­˜åœ¨_sä¸­ï¼›  
        try:  
            _y = _i.send(_s)    # è½¬å‘_sï¼Œå¹¶ä¸”å°è¯•å‘ä¸‹æ‰§è¡Œï¼›  
        except StopIteration as _e:  
            _r = _e.value       # å¦‚æœå­ç”Ÿæˆå™¨æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆå°±è·å–å¼‚å¸¸å¯¹è±¡çš„`value`å±æ€§å­˜åˆ°_rï¼Œé€€å‡ºå¾ªç¯ï¼Œæ¢å¤å§”æ‰˜ç”Ÿæˆå™¨çš„è¿è¡Œï¼›  
            break  
RESULT = _r     # _rå°±æ˜¯æ•´ä¸ªyield fromè¡¨è¾¾å¼è¿”å›çš„å€¼ã€‚  
  
"""  
1. å­ç”Ÿæˆå™¨å¯èƒ½åªæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªä½œä¸ºåç¨‹çš„ç”Ÿæˆå™¨ï¼Œæ‰€ä»¥å®ƒä¸æ”¯æŒ.throw()å’Œ.close()æ–¹æ³•ï¼›  
2. å¦‚æœå­ç”Ÿæˆå™¨æ”¯æŒ.throw()å’Œ.close()æ–¹æ³•ï¼Œä½†æ˜¯åœ¨å­ç”Ÿæˆå™¨å†…éƒ¨ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼›  
3. è°ƒç”¨æ–¹è®©å­ç”Ÿæˆå™¨è‡ªå·±æŠ›å‡ºå¼‚å¸¸  
4. å½“è°ƒç”¨æ–¹ä½¿ç”¨next()æˆ–è€….send(None)æ—¶ï¼Œéƒ½è¦åœ¨å­ç”Ÿæˆå™¨ä¸Šè°ƒç”¨next()å‡½æ•°ï¼Œå½“è°ƒç”¨æ–¹ä½¿ç”¨.send()å‘é€é None å€¼æ—¶ï¼Œæ‰è°ƒç”¨å­ç”Ÿæˆå™¨çš„.send()æ–¹æ³•ï¼›  
"""  
_i = iter(EXPR)  
try:  
    _y = next(_i)  
except StopIteration as _e:  
    _r = _e.value  
else:  
    while 1:  
        try:  
            _s = yield _y  
        except GeneratorExit as _e:  
            try:  
                _m = _i.close  
            except AttributeError:  
                pass  
            else:  
                _m()  
            raise _e  
        except BaseException as _e:  
            _x = sys.exc_info()  
            try:  
                _m = _i.throw  
            except AttributeError:  
                raise _e  
            else:  
                try:  
                    _y = _m(*_x)  
                except StopIteration as _e:  
                    _r = _e.value  
                    break  
        else:  
            try:  
                if _s is None:  
                    _y = next(_i)  
                else:  
                    _y = _i.send(_s)  
            except StopIteration as _e:  
                _r = _e.value  
                break  
RESULT = _r  
  
"""  
çœ‹å®Œä»£ç ï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹å…³é”®ç‚¹ï¼š  
  
1. å­ç”Ÿæˆå™¨ç”Ÿäº§çš„å€¼ï¼Œéƒ½æ˜¯ç›´æ¥ä¼ ç»™è°ƒç”¨æ–¹çš„ï¼›è°ƒç”¨æ–¹é€šè¿‡.send()å‘é€çš„å€¼éƒ½æ˜¯ç›´æ¥ä¼ é€’ç»™å­ç”Ÿæˆå™¨çš„ï¼›å¦‚æœå‘é€çš„æ˜¯ Noneï¼Œä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„__next__()æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯ Noneï¼Œä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„.send()æ–¹æ³•ï¼›  
2. å­ç”Ÿæˆå™¨é€€å‡ºçš„æ—¶å€™ï¼Œæœ€åçš„return EXPRï¼Œä¼šè§¦å‘ä¸€ä¸ªStopIteration(EXPR)å¼‚å¸¸ï¼›  
3. yield fromè¡¨è¾¾å¼çš„å€¼ï¼Œæ˜¯å­ç”Ÿæˆå™¨ç»ˆæ­¢æ—¶ï¼Œä¼ é€’ç»™StopIterationå¼‚å¸¸çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼›  
4. å¦‚æœè°ƒç”¨çš„æ—¶å€™å‡ºç°StopIterationå¼‚å¸¸ï¼Œå§”æ‰˜ç”Ÿæˆå™¨ä¼šæ¢å¤è¿è¡Œï¼ŒåŒæ—¶å…¶ä»–çš„å¼‚å¸¸ä¼šå‘ä¸Š "å†’æ³¡"ï¼›  
5. ä¼ å…¥å§”æ‰˜ç”Ÿæˆå™¨çš„å¼‚å¸¸é‡Œï¼Œé™¤äº†GeneratorExitä¹‹å¤–ï¼Œå…¶ä»–çš„æ‰€æœ‰å¼‚å¸¸å…¨éƒ¨ä¼ é€’ç»™å­ç”Ÿæˆå™¨çš„.throw()æ–¹æ³•ï¼›å¦‚æœè°ƒç”¨.throw()çš„æ—¶å€™å‡ºç°äº†StopIterationå¼‚å¸¸ï¼Œé‚£ä¹ˆå°±æ¢å¤å§”æ‰˜ç”Ÿæˆå™¨çš„è¿è¡Œï¼Œå…¶ä»–çš„å¼‚å¸¸å…¨éƒ¨å‘ä¸Š "å†’æ³¡"ï¼›  
6. å¦‚æœåœ¨å§”æ‰˜ç”Ÿæˆå™¨ä¸Šè°ƒç”¨.close()æˆ–ä¼ å…¥GeneratorExitå¼‚å¸¸ï¼Œä¼šè°ƒç”¨å­ç”Ÿæˆå™¨çš„.close()æ–¹æ³•ï¼Œæ²¡æœ‰çš„è¯å°±ä¸è°ƒç”¨ã€‚å¦‚æœåœ¨è°ƒç”¨.close()çš„æ—¶å€™æŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±å‘ä¸Š "å†’æ³¡"ï¼Œå¦åˆ™çš„è¯å§”æ‰˜ç”Ÿæˆå™¨ä¼šæŠ›å‡ºGeneratorExitå¼‚å¸¸ã€‚  
  
"""
```
:::

è¿™ä¹Ÿæ˜¯awaitå’Œasyncçš„åŸç†  

---------------

## ç½‘ç»œç¼–ç¨‹
#TODO socketç¼–ç¨‹åº”è¯¥è¿˜æœ‰è¿›é˜¶è¯¾ï¼Œå¦‚æœä»¥åå‘ç°å¤ªå¤šäº†å°±ç‹¬ç«‹å‡ºå»é“¾æ¥è¿‡æ¥

>ä¸€äº›å‰ç½®çŸ¥è¯†æ¸©ä¹   
Socketæ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…ç›´æ¥ä½¿ç”¨æ›´åº•å±‚åè®®ï¼ˆä¸€èˆ¬æ˜¯TCPæˆ–UDPï¼‰è€Œå­˜åœ¨çš„ä¸€ä¸ªæŠ½è±¡å±‚ã€‚Socketå®é™…ä¸Šæ˜¯å¯¹TCP/IPåè®®çš„å°è£…ï¼Œæœ¬èº«å¹¶ä¸æ˜¯åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªè°ƒç”¨æ¥å£ï¼ˆAPIï¼‰ã€‚  
WebSocketåè®®åŸºäºHttpåè®®çš„æ‰©å±•ï¼Œæ”¯æŒé•¿è¿æ¥ï¼Œç”¨äºå»ºç«‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„åŒå‘é€šé“ã€‚  
WebSocketæ˜¯ä¿è¯åªè¦åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å»ºç«‹è¿æ¥åä»»ä½•ä¸€ç«¯å‘èµ·æ¶ˆæ¯ï¼Œç›¸äº’æ¨é€æ¶ˆæ¯ï¼Œæ•ˆç‡ä¹Ÿæ˜¯æå¤§çš„æé«˜äº†ï¼Œå¹¶ä¸”æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ ‡å¤´ä¿¡æ¯å¾ˆå°ï¼Œå¯ä»¥é™ä½æœåŠ¡ç«¯çš„èµ„æºæµªè´¹ã€‚  
å¯¹äºWebSocketæ¥è¯´ï¼Œå®ƒå¿…é¡»ä¾èµ–Httpåè®®è¿›è¡Œä¸€æ¬¡æ¡æ‰‹ï¼Œæ¡æ‰‹æˆåŠŸåï¼Œæ•°æ®å°±ç›´æ¥ä»TCPé€šé“ä¼ è¾“ï¼Œä¸Httpæ— å…³äº†ã€‚  
ä¼ ç»Ÿçš„è½®è¯¢æ–¹å¼ï¼ˆå³é‡‡ç”¨httpåè®®ä¸æ–­å‘é€è¯·æ±‚ï¼‰çš„ç¼ºç‚¹ï¼šæµªè´¹æµé‡ï¼ˆhttpè¯·æ±‚å¤´æ¯”è¾ƒå¤§ï¼‰ã€æµªè´¹èµ„æºï¼ˆæ²¡æœ‰æ›´æ–°ä¹Ÿè¦è¯·æ±‚ï¼‰ã€æ¶ˆè€—æœåŠ¡å™¨ã€CPUå ç”¨ï¼ˆæ²¡æœ‰ä¿¡æ¯ä¹Ÿè¦æ¥æ”¶è¯·æ±‚ï¼‰ã€‚  


socketç¼–ç¨‹æ¯”è¾ƒå›ºå®šï¼Œæµç¨‹å„ä¸ªè¯­è¨€ä¸­éƒ½é€šç”¨ï¼Œå…ˆbind->listen->accept->é˜»å¡ç­‰å¾…tcp->ä¼ è¾“->å…³é—­  

![](./static/pythonè¯­è¨€è¿›é˜¶-images-10.png)
 
`socket.socket(é€šä¿¡ç±»å‹,å¯¹åº”åè®®)`  
é€šä¿¡ç±»å‹å¸¸ç”¨çš„:  
- AF_INET = 2 ipv4
- AF_INET6 = 23 ipv6
- AF_IPX = 6 unixè¿›ç¨‹é—´é€šä¿¡

åè®®å°±ä¿©:  
- socket.SOCK_STREAM ç±»ä¼¼TCP
- socket.SOCK_DGRAM ç±»ä¼¼UDP

è¿™äº›å¯ä»¥ç°æŸ¥å»æ–‡æ¡£é‡Œçœ‹  
ç»§æ‰¿å…³ç³» requests->urlib->socket 
:::tip ğŸ“Note
**socketæœ€åŸºæœ¬çš„å‡½æ•°ä½¿ç”¨**<br/>
```python
#----server----
import socket  
  
server=socket.socket(socket.AF_INET,socket.SOCK_STREAM)  
server.bind(('0.0.0.0',8001))  
server.listen()  
sock,addr= server.accept()  
  
# è·å–æ•°æ®ï¼Œä¸€æ¬¡1kb  
data=sock.recv(1024) # å‚æ•°ä¸ºæ¥æ”¶çš„bitæ•°  
print(data.decode("utf8"))  
sock.send("hello {}".format(data.decode("utf8")).encode("utf8"))  
server.close()  
sock.close()

#----client----
import socket  
  
client=socket.socket(socket.AF_INET,socket.SOCK_STREAM)  
client.connect(('127.0.0.1',8001))  
  
client.send("cc".encode("utf8"))  
data=client.recv(1024)  
print(data.decode("utf8"))
#----è¿è¡Œç»“æœ----
server: cc
client: hello cc
```
:::
:::details Click to see more
**å¤šçº¿ç¨‹å¤„ç†å¤šclient **<br/>
```python
import socket  
import threading  
  
server = socket.socket(socket.AF_INET,socket.SOCK_STREAM)  
server.bind(('0.0.0.0', 8001))  
server.listen()  
  
def handle_sock(sock, addr): #åŒ…è£…æˆä¸ªå‡½æ•°  
    while True:  
        data = sock.recv(1024)  
        print(data.decode("utf8"))  
        re_data = input()  
        sock.send(re_data.encode("utf8"))  
  
#è·å–ä»å®¢æˆ·ç«¯å‘é€çš„æ•°æ®  
#ä¸€æ¬¡è·å–1kçš„æ•°æ®  
while True: # å¾ªç¯æ¯ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ªçº¿ç¨‹  
    sock, addr = server.accept()  
    #ç”¨çº¿ç¨‹å»å¤„ç†æ–°æ¥æ”¶çš„è¿æ¥(ç”¨æˆ·)  
    client_thread = threading.Thread(target=handle_sock, args=(sock, addr))  
    client_thread.start()
```
è¿è¡Œç»“æœ
```
è¿è¡Œå¤šæ¬¡cllientå³å¯
```
:::
:::details Click to see more
**socketæ¨¡æ‹Ÿhttp**<br/>
```python
import socket  
from urllib.parse import urlparse  
  
  
def get_url(url):  
    # é€šè¿‡socketè¯·æ±‚html  
    url = urlparse(url) # åªæ˜¯ç”¨å®ƒæ¥è§£æ  
    host = url.netloc  
    path = url.path  
    if path == "":  
        path = "/"  
  
    # å»ºç«‹socketè¿æ¥  
    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  
    client.connect((host, 80))  
    # ä¸åœçš„è¯¢é—®è¿æ¥æ˜¯å¦å»ºç«‹å¥½ï¼Œ éœ€è¦whileå¾ªç¯ä¸åœçš„å»æ£€æŸ¥çŠ¶æ€  
    # åšè®¡ç®—ä»»åŠ¡æˆ–è€…å†æ¬¡å‘èµ·å…¶ä»–çš„è¿æ¥è¯·æ±‚  
    # æ³¨æ„httpæ ¼å¼ï¼Œå‡†å¤‡å¥½éœ€è¦çš„æ ¼å¼å°±å¯ä»¥äº†ï¼Œéš¾ç‚¹åœ¨äºå‘é€å’Œæ¥æ”¶  
    client.send("GET {} HTTP/1.1\r\nHost:{}\r\nConnection:close\r\n\r\n".format(path, host).encode("utf8"))  
  
    data = b""  
    while True:  # å¾ªç¯æ¥æ”¶æ•°æ®  
        d = client.recv(1024)  
        if d:  # æ²¡äº†å°±åœ  
            data += d  
        else:  
            break  
  
    data = data.decode("utf8")  
    html_data = data.split("\r\n\r\n")<br/>[1]  
    print(html_data)  
    client.close()  
  
  
if __name__ == "__main__":  
    import time  
  
    start_time = time.time()  
    for url in range(20):  
        url = "http://www.baidu.com".format(url)  
        get_url(url)  
    print(time.time() - start_time)
```
è¿è¡Œç»“æœ
```
<!DOCTYPE html><html><head><meta http-...
<!DOCTYPE html><html><head><meta http-...
<!DOCTYPE html><html><head><meta http-...
<!DOCTYPE html><html><head><meta http-...
...
```
:::


------------
## å¤šçº¿ç¨‹ç¼–ç¨‹
### GILå…¨å±€è§£é‡Šå™¨é”
global interpreter lockï¼Œpythonæ€§èƒ½ä¸é«˜çš„åŸå› ä¹‹ä¸€  
python ä¸ºäº†ç®€å•è§£é‡Šå™¨ä¼šåŠ é”ï¼ŒGILä½¿å¾—åœ¨ä¸€ä¸ªæ—¶åˆ»å†…åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªCUPå†…æ ¸ä¸Šè¿è¡Œå­—èŠ‚ç ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œè€Œä¸”éšå«çš„æ˜¯æ— æ³•å°†å¤šä¸ªçº¿ç¨‹æ˜ å°„åˆ°å¤šCPUä¸Š  

1. GILåœ¨ä¼šæ ¹æ®å­—èŠ‚ç è¡Œæ•°æˆ–è€…æ—¶é—´ç‰‡é‡Šæ”¾
2. ä¼šåœ¨é‡åˆ°IOæ“ä½œçš„æ—¶å€™é‡Šæ”¾(å¼‚æ­¥å’Œå¤šçº¿ç¨‹çš„åŸºç¡€)

å¤šè¿›ç¨‹çš„ä¼˜ç‚¹æ˜¯ç¨³å®šæ€§å¥½ï¼Œä¸€ä¸ªå­è¿›ç¨‹å´©æºƒäº†ï¼Œä¸ä¼šå½±å“ä¸»è¿›ç¨‹ä»¥åŠå…¶ä½™è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿå¯¹è¿›ç¨‹çš„æ€»æ•°ä¼šæœ‰ä¸€å®šçš„é™åˆ¶å¤šäº†ä¼šå‡æ­»ï¼Œä½¿ç”¨èµ„æºä¹Ÿå¤šã€‚  
å¤šçº¿ç¨‹ä¼˜ç‚¹æ˜¯æ•ˆç‡è¾ƒé«˜ä¸€äº›ï¼Œä½†æ˜¯è‡´å‘½çš„ç¼ºç‚¹æ˜¯ä»»ä½•ä¸€ä¸ªçº¿ç¨‹å´©æºƒéƒ½å¯èƒ½é€ æˆæ•´ä¸ªè¿›ç¨‹çš„å´©æºƒï¼Œå› ä¸ºå®ƒä»¬å…±äº«äº†è¿›ç¨‹çš„å†…å­˜èµ„æºæ± ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€å°ä¸€äº›ã€‚  
#TODO æ“ä½œç³»ç»Ÿçœ‹å®Œçš„æ—¶å€™æŠŠOSé‚£é‡Œé“¾æ¥è¿‡æ¥  
<span style="background:greenyellow">è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„æœ€å°å•ä½</span>  
æ–°çš„è§£é‡Šå™¨[PyPy](https://doc.pypy.org/en/latest/cpython_differences.html)ä¼šæ¯”cpythonå¿«ï¼Œä¹Ÿæœ‰å…¶ä»–çš„è§£é‡Šå™¨jpythonè¿™ç§ã€‚  

### å¤šçº¿ç¨‹
#### åŸç”Ÿå¤šçº¿ç¨‹å’Œç»§æ‰¿Thread
åœ¨pythonä¸­åˆ›å»ºçš„çº¿ç¨‹éƒ½æ˜¯å­çº¿ç¨‹ï¼Œå®é™…ä¸Šè¿˜æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ç”¨æ¥æ‰§è¡Œä»£ç ï¼Œä½¿ç”¨pycharm Debugçš„Frameså¯ä»¥æŸ¥çœ‹  ã€
é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çº¿ç¨‹è¿è¡Œå®Œæ‰èƒ½å…³é—­è¿›ç¨‹  

æ–¹æ³• : æƒ…æ™¯  
è®¾ä¸ºå®ˆæŠ¤çº¿ç¨‹ : è®©ä¸»çº¿ç¨‹è¿è¡Œå®Œé€€å‡ºè¿›ç¨‹å…³é—­ï¼Œå­çº¿ç¨‹æ²¡è¿è¡Œå®Œå°±killæ‰  
ä½¿ç”¨é˜»å¡æ–¹æ³• : æŸä¸ªçº¿ç¨‹é˜»å¡ä¹‹åç­‰å¾…è¯¥çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œ  

æ³¨æ„åŸºæœ¬APIçš„ä½¿ç”¨ï¼ŒåŸç”Ÿå’Œç»§æ‰¿æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œç»§æ‰¿éœ€è¦å®ç°å®ƒçš„`run`æ–¹æ³•  
:::details Click to see more
**åŸç”Ÿå¤šçº¿ç¨‹å’Œç»§æ‰¿çº¿ç¨‹ç±»**<br/>
```python
import time  
import threading  
  
def fun1(arg1):  
    print("1 begin", arg1)  
    time.sleep(2)  
    print("1 end....")  
def fun2(arg2):  
    print("2 begin", arg2)  
    time.sleep(4)  
    print("2 end....")  
t1 = threading.Thread(target=fun1, args=("æˆ‘æ˜¯çº¿ç¨‹1",))  
t2 = threading.Thread(target=fun2, args=("æˆ‘æ˜¯çº¿ç¨‹2",))  

# --------ç»§æ‰¿çº¿ç¨‹Threadç±»-----------

class MyThread1(threading.Thread):  
    def __init__(self,name):  
        print("å®šä¹‰çº¿ç¨‹:", name)  
        self.arg=name  
        super().__init__(name=name) #  
    def run(self):  
        print("1 begin",self.name)  
        time.sleep(2)  
        print("1 end....")  
class MyThread2(threading.Thread):  
    def __init__(self,name):  
        print("å®šä¹‰çº¿ç¨‹:", name)  
        self.arg=name  
        super().__init__(name=name)  
    def run(self):  
        print("2 begin",self.name)  
        time.sleep(4)  
        print("2 end....")  
t1=MyThread1("æˆ‘æ˜¯ç±»çº¿ç¨‹1")  
t2=MyThread2("æˆ‘æ˜¯ç±»çº¿ç¨‹2")
# --------æ•ˆæœæ˜¯ä¸€æ ·çš„---------------
t2.setDaemon(True) # t2è®¾ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œ2såt1å®Œæˆä¼šç›´æ¥é€€å‡º  
  
start_time = time.time()  
t1.start()  
t2.start()  
t1.join()# t1 é˜»å¡äº†,è¿è¡Œæ—¶é—´å°±æ˜¯t1çš„æ—¶é—´  
end_time = time.time()  
print("back to main thread,time : {0}".format(end_time-start_time))
```
è¿è¡Œç»“æœ
```
å®šä¹‰çº¿ç¨‹: æˆ‘æ˜¯ç±»çº¿ç¨‹1 # ç±»çº¿ç¨‹ä¸­initæ‰“å°çš„
å®šä¹‰çº¿ç¨‹: æˆ‘æ˜¯ç±»çº¿ç¨‹2 # ç±»çº¿ç¨‹ä¸­initæ‰“å°çš„
1 begin æˆ‘æ˜¯çº¿ç¨‹1
2 begin æˆ‘æ˜¯çº¿ç¨‹2
1 end....
back to main thread,time : 2.0046401023864746 s
```
:::

#### çº¿ç¨‹é€šä¿¡
é€šä¿¡æ–¹å¼æ¼”åŒ–: global å…¨å±€å˜é‡->å¯å˜å¯¹è±¡æ¯”å¦‚listæ”¾åˆ°çº¿ç¨‹çš„å‚æ•°é‡Œ  
æŠŠå…±äº«å˜é‡æ”¾åˆ°å•ç‹¬æ–‡ä»¶å¼•ç”¨è¿›æ¥ç®¡ç†ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯¹å˜é‡è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœç›´æ¥å¼•ç”¨`å˜é‡`åœ¨,æœ¬æ–‡ä»¶é‡Œæ˜¯çœ‹ä¸åˆ°çš„ï¼Œä½†æ˜¯å¦‚æœå¼•ç”¨`æ–‡ä»¶.å˜é‡`å°±å¯ä»¥ã€‚  
ç›´æ¥å…±äº«å˜é‡å®é™…ä¸Šæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¿…é¡»ç”¨é”è‡ªå·±è¿›è¡Œè®¾è®¡ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ç”¨**çº¿ç¨‹å®‰å…¨**çš„å˜é‡  

:::tip ğŸ“Note
ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼æ˜¯é€šè¿‡ä¸€ä¸ªå®¹å™¨ï¼ˆQueueï¼‰æ¥è§£å†³ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å¼ºè€¦åˆé—®é¢˜,å¦‚æœæœ‰å…´è¶£å¯ä»¥ç›´æ¥ç‚¹è¿›å»çœ‹æºç è¿™äº›é˜Ÿåˆ—æ˜¯æ€ä¹ˆå®ç°çº¿ç¨‹å®‰å…¨çš„ï¼Œä½¿ç”¨çš„æ˜¯Condition  
**åœ¨å¤šçº¿ç¨‹å¼€å‘å½“ä¸­ï¼Œå¦‚æœç”Ÿäº§è€…å¤„ç†é€Ÿåº¦å¾ˆå¿«ï¼Œè€Œæ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦å¾ˆæ…¢ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å°±å¿…é¡»ç­‰å¾…æ¶ˆè´¹è€…å¤„ç†å®Œï¼Œæ‰èƒ½ç»§ç»­ç”Ÿäº§æ•°æ®ã€‚åŒæ ·çš„é“ç†ï¼Œå¦‚æœæ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›å¤§äºç”Ÿäº§è€…ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…å°±å¿…é¡»ç­‰å¾…ç”Ÿäº§è€…ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜äºæ˜¯å¼•å…¥äº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ã€‚**
:::
##### æ¶ˆæ¯é˜Ÿåˆ—Queue
queueæ˜¯é˜»å¡çš„ï¼Œç©ºäº†å°±åœè¿™äº†ï¼Œæœ‰äº†å†åŠ¨ï¼Œåº•å±‚å®ç°ä½¿ç”¨çš„æ˜¯collectionsçš„dqueueï¼Œåè€…åœ¨å­—èŠ‚ç å±‚é¢å®ç°çº¿ç¨‹å®‰å…¨  
joinä¹‹åä¸è¦å¿˜äº†taskdown é‡Šæ”¾,å¸¦nowaitæ–¹æ³•æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œé»˜è®¤åˆ›å»ºå…ˆè¿›å…ˆå‡ºï¼Œå¯ä»¥åˆ›å»ºåè¿›å…ˆå‡ºå’Œä¼˜å…ˆçº§é˜Ÿåˆ—  
putå’Œgetéƒ½æ˜¯å¯ä»¥é€šè¿‡å‚æ•°è®¾ç½®è¶…æ—¶æ—¶é—´å’Œæ˜¯å¦é˜»å¡çš„ï¼Œç”¨åˆ°äº†å†å»æŸ¥ï¼Œqueueä¸­è¿˜æœ‰ä¼˜å…ˆçº§é˜Ÿåˆ—ç­‰ç•™æ„ä¸€ä¸‹  

:::details Click to see more
**ä½¿ç”¨çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—çš„ç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å‹**<br/>
```python
import queue  
import random  
import threading  
import time  
from queue import Queue  
  
q = queue.Queue(maxsize=100)  # å°±ä¸€ä¸ªå‚æ•°ï¼Œå®šä¹‰ä¸€ä¸ªé•¿åº¦100çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—  
# ä½¿ç”¨çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—çš„ç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å‹  
  
class Productor(threading.Thread):  
    def __init__(self, name):  
        print("åˆå§‹åŒ–%sçº¿ç¨‹:" % name)  
        super().__init__(name=name)  
  
    def run(self):  
        global q  # æ‹¿åˆ°å…¨å±€çš„queue  
        while True:  
            time.sleep(4)  # å‡è®¾æ¯ä¸ªç”Ÿäº§è€…æ¯4ç§’ç”Ÿäº§ä¸€ä¸ª  
            value = random.randint(0,1024)  
            q.put(value)  
            print("Product : %d" % value)  
  
class Consumer(threading.Thread):  
    def __init__(self, name):  
        print("åˆå§‹åŒ–%sçº¿ç¨‹:" % name)  
        super().__init__(name=name)  
  
    def run(self):  
        global q  # æ‹¿åˆ°å…¨å±€çš„queue  
        while True:  
            time.sleep(1)  # æ¶ˆè´¹è€…æ¯ä¸€ç§’æ¶ˆè´¹ä¸€ä¸ª  
            temp = q.get()  
            print("Comsume : %d" % temp)  
  
for i in range(1,4): # 3ä¸ªæ¶ˆè´¹è€… æ¯ç§’æ¶ˆè€—3ä¸ª  
    c=Consumer(name="æ¶ˆè´¹è€…%d"%i)  
    c.start()  
for i in range(1,11): # 10ä¸ªç”Ÿäº§è€… æ¯ç§’äº§ç”Ÿ2.5ä¸ª  
    p=Productor(name="ç”Ÿäº§è€…%d"%i)  
    p.start()
```
è¿è¡Œç»“æœ
```
åˆå§‹åŒ–æ¶ˆè´¹è€…1çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…2çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…3çº¿ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…1çº¿ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…2çº¿ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…3çº¿ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…4çº¿ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…5çº¿ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…6çº¿ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…7çº¿ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…8çº¿ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…9çº¿ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…10çº¿ç¨‹:
Product : 499
Comsume : 499
Product : 594
Product : 765
Comsume : 594
Comsume : 765
Product : 958
Product : 481
Product : 124
...
```
:::

### çº¿ç¨‹åŒæ­¥
#### Mutexäº’æ–¥é”
`Lock`æ¯ä¸ªé”å¯¹è±¡æ˜¯ä¸€ä¸ªé”ï¼Œé”ä¼šå½±å“æ€§èƒ½ï¼Œé”ä½¿ç”¨ä¸å½“ä¼šå¼•èµ·æ­»é”ï¼Œæ²¡é‡Šæ”¾å°±å†æ¬¡è·å–ï¼ŒABä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„é”é€ æˆæ­»é”  
`Rlock`æ˜¯å¯é‡å…¥é”ï¼Œä½¿ç”¨Lockå®ç°çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹é‡Œé¢å¯ä»¥å¤šæ¬¡acquireï¼Œä½†æ˜¯ä¹Ÿè¦releaseç›¸åŒæ¬¡  

:::details Click to see more

```python
import threading  
from threading import Lock,RLock  
L=Lock()  
RL=RLock()  
a=0  
def fun1(arg1):  
    print("1 begin", arg1)  
    global a  
    for i in range(0,1000000):  
        L.acquire()  
        RLock.acquire()  
        RLock.acquire()  
        a+=1  
        L.release()  
        RLock.release()  
        RLock.release()  
def fun2(arg2):  
    print("2 begin", arg2)  
    global a  
    for i in range(0,1000000):  
        L.acquire()  
        a-=1  
        L.release()  
  
t1 = threading.Thread(target=fun1, args=("æˆ‘æ˜¯çº¿ç¨‹1",))  
t2 = threading.Thread(target=fun2, args=("æˆ‘æ˜¯çº¿ç¨‹2",))  
t1.start()  
t2.start()  
t1.join()  
t2.join()  
print(a)
```
è¿è¡Œç»“æœ
```
1 begin æˆ‘æ˜¯çº¿ç¨‹1
2 begin æˆ‘æ˜¯çº¿ç¨‹2
0 # æ²¡é”å°±æ˜¯éšæœºæ•°
```
:::
#### Conditionæ¡ä»¶å¯¹è±¡
æ¡ä»¶å˜é‡å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…ï¼ŒçŸ¥é“å®ƒä»¬è¢«å¦ä¸€ä¸ªçº¿ç¨‹å”¤é†’ã€‚  

1. å¦‚æœç»™å‡ºäº†`lock`å‚æ•°è€Œä¸æ˜¯`None`ï¼Œåˆ™å®ƒå¿…é¡»æ˜¯`Lcok`æˆ–`RLock`å¯¹è±¡ï¼Œå¹¶ä»¥å®ƒä½œä¸ºåº•å±‚çš„é”ã€‚å¦åˆ™å°†é»˜è®¤åˆ›å»ºä¸€ä¸ª`RLock`å¯¹è±¡ã€‚  
2. `Condition`éµå¾ªä¸Šä¸‹æ–‡ç®¡ç†åè®®,å¯ä»¥ç”¨with
    - `with cond :...`ç­‰ä»·äº`cond.lock...cond.release`
    - æ˜¯é€šè¿‡é­”æ³•å‡½æ•°å®ç°çš„
3. ä¸€å®šè¦æ³¨æ„Conditionçš„å¯åŠ¨é¡ºåºï¼Œå¦‚æœA notifyçš„æ—¶å€™Bè¿˜æ²¡å¯åŠ¨ï¼Œwaitæ²¡å°±ç»ªé‚£ä¸Šæ¥å°±æ­»é”äº†  
4. æ³¨æ„å››ä¸ªæ–¹æ³•
    - `acquire/release`å°±æ˜¯è°ƒç”¨é”çš„`acquire/release`
    - `notify`å’Œ`wait` å”¤é†’å’Œç¡çœ ï¼Œå”¤é†’ä¹‹åå°±å¼€å§‹å·¥ä½œï¼Œwaitå°±ä¼šç­‰å¾…ä¸‹æ¬¡å”¤é†’
        - waitå¯ä»¥ç”¨timeoutå‚æ•°è®¾ç½®è¶…æ—¶æ—¶é—´
        - ä¸€æ—¦è¢«å”¤é†’æˆ–è¶…æ—¶ï¼Œå®ƒä¼šé‡æ–°è·å–é”å¹¶è¿”å›,è¿”å›å€¼ä¸º`True`ï¼Œå¦‚æœç»™å®š`timeout`å¹¶å‘ç”Ÿè¶…æ—¶ï¼Œåˆ™è¿”å›`False`
    - `notify`å¯ä»¥æŒ‡å®šå‚æ•°nå”¤é†’å‡ ä¸ªï¼Œå¯ä»¥ç›´æ¥`notify_all()`å”¤é†’æ‰€æœ‰
    - `wait_for(predicate, timeout=None)`ç­‰å¾…ç›´åˆ°æ¡ä»¶å˜é‡çš„è¿”å›å€¼ä¸º`True`ã€‚
        - `predicate`åº”è¯¥æ˜¯ä¸€ä¸ªè¿”å›å€¼å¯ä»¥è§£é‡Šä¸ºå¸ƒå°”å€¼çš„å¯è°ƒç”¨å¯¹è±¡ã€‚å¯ä»¥è®¾ç½®`timeout`ä»¥ç»™å®šæœ€å¤§ç­‰å¾…æ—¶é—´ã€‚è¯¥æ–¹æ³•å¯ä»¥é‡å¤è°ƒç”¨`wait()`ï¼Œç›´åˆ°`predicate`çš„è¿”å›å€¼è§£é‡Šä¸º`True`ï¼Œæˆ–å‘ç”Ÿè¶…æ—¶ã€‚è¯¥æ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯`predicate`çš„æœ€åä¸€ä¸ªè¿”å›å€¼ï¼Œå¦‚æœå‘ç”Ÿè¶…æ—¶ï¼Œè¿”å›å€¼ä¸º`False`ã€‚
        - å°±æ˜¯æ¯æ¬¡waitçš„æ—¶å€™éƒ½æ£€æŸ¥ä¸€æ¬¡`predicate()`æ˜¯Trueæ‰ä¼šæ‰§è¡Œã€‚

##### å¤§è‡´å®ç°åŸç†
conditionæœ‰ä¸¤å±‚é”ï¼Œä¸€æŠŠRlockå’Œä¸€ä¸ªwaitersåŒç«¯é˜Ÿåˆ—ï¼Œç”¨Rlocké”å®šè¦æ‰§è¡Œçš„å—ï¼Œæ¯æ¬¡waitéƒ½ç”³è¯·ä¸€æŠŠé”ç„¶å<span style="background:greenyellow">acquireä¸¤æ¬¡</span>æ”¾åˆ°waitersï¼Œæ¯æ¬¡notifyå°±æ˜¯æ‹¿å‡ºä¸€æŠŠwaiteré”release,æ¯æ¬¡with-condéƒ½ä¼šè¿›å…¥enteræŠŠRlock acquireï¼Œæ‰€ä»¥ä¸ç”¨notifyé‡Šæ”¾  

1ä¸ªç”Ÿäº§è€…ï¼Œ3ä¸ªæ¶ˆè´¹è€…,ç©ºäº†å–Šæ¥ç”Ÿäº§ï¼Œæ»¡äº†å–Šä»–æ¶ˆè´¹  
:::warning âš ï¸Warning
**ä¸€å®šè¦æ³¨æ„**<br/>æ³¨æ„æ¶ˆè´¹è€…çš„sleepå¦‚æœåœ¨condé‡Œé¢ï¼Œä¼šç›´æ¥æŠŠé”é”ä½ï¼Œä¸èƒ½releaseå°±ä¼šè·Ÿå•çº¿ç¨‹ä¸€æ ·çš„æ•ˆæœä¸€ä¸ªåƒå®Œäº†å†åƒ  
å¤šçº¿ç¨‹ä¸­ä¸è¦é˜»å¡é”  
è€ƒè™‘å¥½condçš„ä½ç½®:  
è°è¿è¡Œè°æœ‰Rï¼Œè°é˜»å¡è°é‡é”  
Rä¿è¯å®‰å…¨ï¼Œwaiterç”¨æ¥å¡ä½  
ç”±äºåœºæ™¯æ˜¯å¤šä¸ªæ¶ˆè´¹è€…è¿›è¡ŒæŠ¢è´­ï¼Œå¦‚æœå°†è·å–é”æ“ä½œæ”¾åœ¨å¾ªç¯å¤–(å¦‚ç”Ÿäº§è€…),  
é‚£ä¹ˆä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹è¢«å”¤é†’æ—¶ä¼šé”ä½æ•´ä¸ªå¾ªç¯ï¼Œæ— æ³•å®ç°å¦ä¸€ä¸ªæ¶ˆè´¹è€…çš„æŠ¢è´­ã€‚  
åœ¨å¾ªç¯ä¸­æ·»åŠ ä¸€å¥—"è·å–é”-é‡Šæ”¾é”",ä¸€ä¸ªæ¶ˆè´¹è€…è´­ä¹°å®Œæˆåé‡Šæ”¾é”ï¼Œå…¶ä»–æ¶ˆè´¹è€…  
å°±å¯ä»¥è·å–é”æ¥å‚ä¸è´­ä¹°ã€‚  

:::
:::details Click to see more
**ä½¿ç”¨æ¡ä»¶å˜é‡çš„ç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å‹**<br/>
```python
from threading import Condition  
import queue  
import random  
import threading  
import time  
q=queue.Queue(maxsize=15)  # å°±ä¸€ä¸ªå‚æ•°ï¼Œå®šä¹‰ä¸€ä¸ªé•¿åº¦50çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—  
# ä½¿ç”¨Conditionçš„ç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å‹  
cond=Condition()  
class Productor(threading.Thread):  
    def __init__(self, name):  
        print("åˆå§‹åŒ–%sçº¿ç¨‹:" % name)  
        super().__init__(name=name)  
  
    def run(self):  
        global q  # æ‹¿åˆ°å…¨å±€çš„queue  
        with cond: # é”ä½R  
            while True:  # æ³¨æ„ whileå’Œcondçš„ä½ç½® 
                if q.full():  
                    print("ç”Ÿäº§å®Œäº†ï¼Œå¿«æ¥åƒ")  
                    cond.notify()  # notifyå¡ä½
                    cond.wait() # é€šçŸ¥å®Œä¹‹åé‡Šæ”¾R  
                time.sleep(0.1)  # å‡è®¾æ¯ä¸ªç”Ÿäº§è€…æ¯0.1ç§’ç”Ÿäº§ä¸€ä¸ª  
                value = random.randint(0,1024)  
                q.put(value)  
                print("Product : %d" % value)  
  
class Consumer(threading.Thread):  
    def __init__(self, name):  
        self.arg=name  
        print("åˆå§‹åŒ–%sçº¿ç¨‹:" % name)  
        super().__init__(name=name)  
  
    def run(self):  
        global q  # æ‹¿åˆ°å…¨å±€çš„queue  
        while True:  
            with cond: # æ³¨æ„è¿™é‡Œï¼Œsleepå¦‚æœåœ¨condé‡Œé¢ï¼Œä¼šç›´æ¥æŠŠé”é”ä½ï¼Œä¸èƒ½releaseå°±ä¼šè·Ÿå•çº¿ç¨‹ä¸€æ ·çš„æ•ˆæœ  
                if q.empty():  
                    print("%sé¥¿äº†ç­‰ç€åƒï¼Œå¿«ç”Ÿäº§"%self.arg)  
                    cond.notify()  
                    # notifyçš„æ—¶å€™ï¼Œç”Ÿäº§è€…åˆä¸€æ¬¡æ‹¿åˆ°äº†Ré”
                    cond.wait()  
                    # è¿™é‡Œè™½ç„¶æ˜¯ä¸‰ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ï¼Œä½†æ˜¯åœ¨qç©ºäº†waitçŠ¶æ€çš„æ—¶å€™ï¼Œ
                    # Ré”è¢«é‡Šæ”¾ï¼Œwaiterè·å–ä¸¤æ¬¡å¡ä½è¿™é‡Œ
                    # ç”Ÿäº§è€…ä»condåˆæ‹¿Ré”ï¼Œç›´åˆ°é€šçŸ¥é‡Šæ”¾waiteræ‰ä¼šæ‰§è¡Œ
                    # Rä¿è¯äº†åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨åƒï¼Œæ‰€ä»¥å…¶ä»–ä¸¤ä¸ªçº¿ç¨‹è¿›ä¸æ¥ç”šè‡³çœ‹ä¸åˆ°qï¼Œæ˜¯å®‰å…¨çš„
                temp = q.get()  
                print("Comsume%s : %d" % (self.arg,temp))  
            time.sleep(1)  # æ¶ˆè´¹è€…æ¯ç§’æ¶ˆè´¹ä¸€ä¸ª  
p=Productor(name="ç”Ÿäº§è€…")  
p.start()  
  
  
c1=Consumer(name="æ¶ˆè´¹è€…%d"%1)  
c2=Consumer(name="æ¶ˆè´¹è€…%d"%2)  
c3=Consumer(name="æ¶ˆè´¹è€…%d"%3)  
c1.start()  
c2.start()  
c3.start()
```
è¿è¡Œç»“æœ
```
åˆå§‹åŒ–ç”Ÿäº§è€…çº¿ç¨‹:
Product : 834
...
Product : 1000
ç”Ÿäº§å®Œäº†ï¼Œå¿«æ¥åƒ
åˆå§‹åŒ–æ¶ˆè´¹è€…1çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…2çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…3çº¿ç¨‹:
Comsumeæ¶ˆè´¹è€…1 : 834
Comsumeæ¶ˆè´¹è€…2 : 401
Comsumeæ¶ˆè´¹è€…3 : 882
Comsumeæ¶ˆè´¹è€…1 : 115
Comsumeæ¶ˆè´¹è€…2 : 800
Comsumeæ¶ˆè´¹è€…3 : 938
Comsumeæ¶ˆè´¹è€…1 : 949
Comsumeæ¶ˆè´¹è€…2 : 546
Comsumeæ¶ˆè´¹è€…3 : 30
Comsumeæ¶ˆè´¹è€…1 : 64
Comsumeæ¶ˆè´¹è€…3 : 27
Comsumeæ¶ˆè´¹è€…2 : 966
Comsumeæ¶ˆè´¹è€…1 : 598
Comsumeæ¶ˆè´¹è€…2 : 317
Comsumeæ¶ˆè´¹è€…3 : 1000
æ¶ˆè´¹è€…2é¥¿äº†ç­‰ç€åƒï¼Œå¿«ç”Ÿäº§
æ¶ˆè´¹è€…3é¥¿äº†ç­‰ç€åƒï¼Œå¿«ç”Ÿäº§
æ¶ˆè´¹è€…1é¥¿äº†ç­‰ç€åƒï¼Œå¿«ç”Ÿäº§
Product : 981
Product : 841
...
```
:::

![](./static/pythonè¯­è¨€è¿›é˜¶-images-11.png)

#### Semaphoreä¿¡å·é‡
å…¶å®å°±æ˜¯æ•°é‡é”ï¼Œè¿˜æœ‰å‰©ä½™å°±è·å–ä¸€ä¸ªå¼€æ•´ï¼Œæ²¡é”å°±åœç€  
**åŸç†**ä¹Ÿæ˜¯conditionå®ç°çš„ï¼Œvalueä¸ä¸º0é‚£å°±-1ï¼Œé‚£å°±è·å¾—condï¼Œæ²¡äº†å°±waitï¼Œé‡Šæ”¾çš„æ—¶å€™value+1ï¼Œå¹¶notifyä¸€æ¬¡éšæœºå”¤é†’ä¸€ä¸ª  

å½“`blocking=False`æ—¶ï¼Œä¸ä¼šé˜»å¡ã€‚å¦‚æœè°ƒç”¨`acquire()`æ—¶è®¡æ•°å™¨ä¸ºé›¶ï¼Œåˆ™ä¼šç«‹å³è¿”å›`False`.  
å¦‚æœè®¾ç½®äº†`timeout`å‚æ•°ï¼Œå®ƒå°†é˜»å¡æœ€å¤š`timeout`ç§’ã€‚å¦‚æœåœ¨è¯¥æ—¶é—´æ®µå†…æ²¡æœ‰è·å–é”ï¼Œåˆ™è¿”å›`False`ï¼Œå¦åˆ™è¿”å›`True`ã€‚  

:::details Click to see more
**ä¿¡å·é‡å®ç°æ§åˆ¶å¤šæ¶ˆè´¹è€…å¹¶å‘æ•°é‡**<br/>
```python
from threading import Semaphore  
import queue  
import random  
import threading  
import time  
  
q = queue.Queue(maxsize=100)  # å°±ä¸€ä¸ªå‚æ•°ï¼Œå®šä¹‰ä¸€ä¸ªé•¿åº¦100çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—  
sem=Semaphore(4) # ç”³è¯·ä¿¡å·é‡  
class Productor(threading.Thread):  
    def __init__(self, name,sem):  
        self.sem=sem  
        print("åˆå§‹åŒ–%sçº¿ç¨‹:" % name)  
        super().__init__(name=name)  
  
    def run(self):  
        global q  # æ‹¿åˆ°å…¨å±€çš„queue  
        while True:  
            time.sleep(2)  # å‡è®¾æ¯ä¸ªç”Ÿäº§è€…æ¯2ç§’ç”Ÿäº§ä¸€ä¸ª  
            value = random.randint(0,1024)  
            q.put(value)  
            print("Product%s : %d" %(self.name,value))  
            self.sem.release()  # ç”Ÿäº§å®Œäº†ä¸€ä¸ªå†release
  
class Consumer(threading.Thread):  
    def __init__(self, name,sem):  
        self.sem=sem # å¯å˜å¯¹è±¡  
        print("åˆå§‹åŒ–%sçº¿ç¨‹:" % name)  
        super().__init__(name=name)  
  
    def run(self):  
        global q  # æ‹¿åˆ°å…¨å±€çš„queue  
        while True:  
            self.sem.acquire() # æ¶ˆè´¹è€…æ¯æ¬¡æ¶ˆè´¹ä¹‹å‰éƒ½acquireï¼Œacquireä¸åˆ°å°±åœä½  
            time.sleep(1)  # æ¶ˆè´¹è€…æ¯ä¸€ç§’æ¶ˆè´¹ä¸€ä¸ª  
            temp = q.get()  
            print("Comsume%s : %d" % (self.name,temp))  
  
for i in range(1,3): # 2ä¸ªç”Ÿäº§è€… æ¯ä¸ªæ¯2ç§’äº§ç”Ÿ1  
    p=Productor(name="ç”Ÿäº§è€…%d"%i,sem=sem)  
    p.start()  
for i in range(1,10): # 10ä¸ªæ¶ˆè´¹è€…,æ¯ä¸ªæ¯ç§’1ä¸ª, æ§åˆ¶å¹¶å‘ä¸º4ä¸ª  
    c=Consumer(name="æ¶ˆè´¹è€…%d"%i,sem=sem)  
    c.start()
```
è¿è¡Œç»“æœ
```
åˆå§‹åŒ–ç”Ÿäº§è€…1çº¿ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…2çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…1çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…2çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…3çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…4çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…5çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…6çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…7çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…8çº¿ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…9çº¿ç¨‹:
Productç”Ÿäº§è€…1 : 528
Comsumeæ¶ˆè´¹è€…2 : 528
Productç”Ÿäº§è€…2 : 61
Comsumeæ¶ˆè´¹è€…3 : 61
Productç”Ÿäº§è€…2 : 598
Productç”Ÿäº§è€…1 : 643Comsumeæ¶ˆè´¹è€…4 : 598

Comsumeæ¶ˆè´¹è€…1 : 643
Productç”Ÿäº§è€…2 : 464
Productç”Ÿäº§è€…1 : 618Comsumeæ¶ˆè´¹è€…3 : 464

Comsumeæ¶ˆè´¹è€…6 : 618
Productç”Ÿäº§è€…2 : 213
Productç”Ÿäº§è€…1 : 184
Comsumeæ¶ˆè´¹è€…7 : 213

```
:::

#### Eventäº‹ä»¶å¯¹è±¡
äº‹ä»¶å¯¹è±¡ç®¡ç†ä¸€ä¸ªå†…éƒ¨æ ‡å¿—ï¼Œé€šè¿‡`set()`æ–¹æ³•å°†å…¶è®¾ç½®ä¸º`True`ï¼Œå¹¶ä½¿ç”¨`clear()`æ–¹æ³•å°†å…¶è®¾ç½®ä¸º`False`ã€‚`wait()`æ–¹æ³•é˜»å¡ï¼Œç›´åˆ°æ ‡å¿—ä¸º`True`å†è§£é™¤é˜»å¡ã€‚è¯¥æ ‡å¿—åˆå§‹ä¸º`False`ã€‚

- `is_set()`ï¼Œé¡¾åæ€ä¹‰è¿”å›æ ‡å¿—çŠ¶æ€
- `set()`  å°†æ ‡å¿—è®¾ç½®ä¸º`True`ã€‚æ‰€æœ‰ç­‰å¾…å®ƒæˆä¸º`True`çš„çº¿ç¨‹éƒ½è¢«å”¤é†’ã€‚è‹¥å·²ç»`True`çŠ¶æ€ï¼Œçº¿ç¨‹è°ƒç”¨`wait()`ä¸ä¼šé˜»å¡ã€‚
- `clear()` å°†æ ‡å¿—ç½®ä¸º`False`,å¹¶é˜»å¡è°ƒç”¨`wait()`çš„çº¿ç¨‹
- `wait(timeout=None)` è¯¥æ–¹æ³•æ€»æ˜¯è¿”å›`True`ï¼Œé™¤éè®¾ç½®äº†`timeout`å¹¶å‘ç”Ÿè¶…æ—¶ã€‚
:::details Click to see more

```python
import threading  
import time  
from threading import Event  
ev=Event()  
ev.clear() # ç½®ä¸ºFalseè·å–çš„ä¼šç›´æ¥é˜»å¡  
class MyThread1(threading.Thread):  
    def __init__(self,name,ev):  
        print("åˆå§‹åŒ–çº¿ç¨‹:", name)  
        self.ev=ev  
        self.arg=name  
        super().__init__(name=name)  
    def run(self):  
        print("1 begin",self.name)  
        time.sleep(2)  
        self.ev.wait() # é˜»å¡äº†  
        time.sleep(3)  
        print("1 end....")  
class MyThread2(threading.Thread):  
    def __init__(self,name,ev):  
        print("åˆå§‹åŒ–çº¿ç¨‹:", name)  
        self.ev=ev  
        self.arg=name  
        super().__init__(name=name)  
    def run(self):  
        print("2 begin",self.name)  
        time.sleep(5)  
        self.ev.set() # ç­‰å®Œäº”ç§’è§£é™¤çº¿ç¨‹1çš„é˜»å¡  
        print("2 end....")  
t1=MyThread1("çº¿ç¨‹1",ev)  
t2=MyThread2("çº¿ç¨‹2",ev)  
  
start_time = time.time()  
t1.start()  
t2.start()  
t1.join()  
t2.join()  
end_time = time.time()  
# æœ€åç­‰å¾…æ—¶é—´8s  
print("back to main thread,time : {0} s".format(end_time-start_time))
```
è¿è¡Œç»“æœ
```
åˆå§‹åŒ–çº¿ç¨‹: çº¿ç¨‹1
åˆå§‹åŒ–çº¿ç¨‹: çº¿ç¨‹2
1 begin çº¿ç¨‹1
2 begin çº¿ç¨‹2
2 end....
1 end....
back to main thread,time : 8.003741979598999 s
```
:::

#### Barrieréšœç¢å¯¹è±¡

`Barrier(parties, action=None, timeout=None)`  
æ¯ä¸ªçº¿ç¨‹é€šè¿‡è°ƒç”¨`wait()`å°è¯•é€šè¿‡éšœç¢å¹¶é˜»å¡ï¼Œç›´åˆ°é˜»å¡çš„æ•°é‡è¾¾åˆ°`parties`æ—¶ï¼Œé˜»å¡çš„çº¿ç¨‹è¢«åŒæ—¶å…¨éƒ¨é‡Šæ”¾ã€‚  
`action`æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œ<span style="background:greenyellow">æ— å‚</span>ï¼Œå½“çº¿ç¨‹è¢«é‡Šæ”¾æ—¶ï¼Œå…¶ä¸­éšæœºä¸€ä¸ªçº¿ç¨‹ä¼šé¦–å…ˆè°ƒç”¨`action`ï¼Œä¹‹åå†è·‘è‡ªå·±çš„ä»£ç ã€‚  
`timeout`æ—¶é»˜è®¤çš„è¶…æ—¶æ—¶é—´ã€‚  

`wait(timeout=None)` è¿”å›å€¼æ˜¯`0`åˆ°`parties-1`èŒƒå›´å†…çš„æ•´æ•°ï¼Œæ˜¯ç­‰å¾…æ—¶å€™çš„é¡ºåº  
- å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹åœ¨é‡Šæ”¾ä¹‹å‰å°†è°ƒç”¨`action`ã€‚å¦‚æœæ­¤è°ƒç”¨å¼•å‘é”™è¯¯ï¼Œåˆ™éšœç¢å°†è¿›å…¥æ–­å¼€çŠ¶æ€ã€‚  
- å¦‚æœç­‰å¾…è¶…æ—¶ï¼Œéšœç¢ä¹Ÿå°†è¿›å…¥æ–­å¼€çŠ¶æ€ã€‚  
- å¦‚æœåœ¨çº¿ç¨‹ç­‰å¾…æœŸé—´éšœç¢æ–­å¼€æˆ–é‡ç½®ï¼Œæ­¤æ–¹æ³•ä¼šå¼•å‘`BrokenBarrierError`é”™è¯¯ï¼Œæ³¨æ„é”™è¯¯å¤„ç†ã€‚  

`reset()`
- é‡ç½®éšœç¢ï¼Œè¿”å›é»˜è®¤çš„ç©ºçŠ¶æ€ï¼Œå³å½“å‰é˜»å¡çš„çº¿ç¨‹æŠ›å‡º`BrokenBarrierError`é”™è¯¯é‡æ–°å¼€å§‹æ‰§è¡Œï¼Œä¹‹å‰æ‰§è¡Œçš„ä¸ç®—æ•°ã€‚  

`abort()`
- å°†éšœç¢ç½®ä¸ºæ–­å¼€çŠ¶æ€ï¼Œå¯¼è‡´æ­£åœ¨ç­‰å¾…æˆ–<span style="background:greenyellow">ä¹‹åè°ƒç”¨</span>`wait()`å¼•å‘`BrokenBarrierError`,æ³¨æ„å’Œresetçš„åŒºåˆ«  

å±æ€§ï¼š  
- `partier`  é€šè¿‡éšœç¢æ‰€éœ€çš„çº¿ç¨‹æ•°
- `n_waiting`  å½“å‰åœ¨å±éšœä¸­ç­‰å¾…çš„çº¿ç¨‹æ•°
- `broken`  å¦‚æœBarrierå¤„äºæ–­å¼€çŠ¶æ€ï¼Œåˆ™è¿”å›`True`

:::details Click to see more

```python
import threading  
from threading import Barrier  
  
  
def after():  # æ— å‚çš„action  
    print("çº¿ç¨‹è·¨è¿‡å»äº†")  
  
  
barrier = Barrier(3, action=after, timeout=None)  
  
  
class Worker(threading.Thread):  
    def __init__(self, name, barrier):  
        print("åˆå§‹åŒ–çº¿ç¨‹:", name)  
        self.barrier = barrier  
        self.arg = name  
        super().__init__(name=name)  #  
  
    def run(self):  
        print("begin", self.name)  
        try:  
            self.barrier.wait()  
        except threading.BrokenBarrierError as e:  
            print("%sè¢«é‡ç½®æˆ–æ–­å¼€äº†"%self.name)  
        print("end", self.name)  
  
  
class Manager(threading.Thread):  
    def __init__(self, name, barrier):  
        print("åˆå§‹åŒ–çº¿ç¨‹:", name)  
        self.barrier = barrier  
        self.arg = name  
        super().__init__(name=name)  
  
    def run(self):  
        self.barrier.reset()  
        # self.barrier.abort()  # æ³¨æ„ä»–ä¿©åŒºåˆ«ï¼Œabortä¹‹åç›´æ¥è·¨ä¸è¿‡å»äº†
        print("manager é‡ç½®")  
        print("åŸºæœ¬ä¿¡æ¯",self.barrier.parties,self.barrier.broken,self.barrier.n_waiting)  
  
  
for i in range(1, 3):  
    t = Worker("worker %s" % i, barrier)  
    t.start()  
m = Manager("manager", barrier)  
m.start()  
for i in range(3, 6):  
    t = Worker("worker %s" % i, barrier)  
    t.start()
```
å…¶ä¸­ä¸€ä¸ª è¿è¡Œç»“æœ
```
åˆå§‹åŒ–çº¿ç¨‹: worker 1
beginåˆå§‹åŒ–çº¿ç¨‹: worker 2
beginåˆå§‹åŒ–çº¿ç¨‹: manager
manager é‡ç½®
 worker 1
 worker 2åˆå§‹åŒ–çº¿ç¨‹: worker 3åŸºæœ¬ä¿¡æ¯ 3 
False 1

beginåˆå§‹åŒ–çº¿ç¨‹: worker 4
beginåˆå§‹åŒ–çº¿ç¨‹:   worker 3
çº¿ç¨‹è·¨è¿‡å»äº†
end worker 3
end worker 1
worker 4
end worker 2
worker 5
begin worker 5
```
:::
#### ThreadLocal
æœ¬åœ°çº¿ç¨‹çš„Localå¯¹è±¡ï¼Œç›´æ¥èµ‹å€¼å–å€¼å°±å¯ä»¥
```python
# åˆ›å»ºå…¨å±€ThreadLocalå¯¹è±¡:
local= threading.local()
local.a="123"
print(local.a)
```
#### example-3å‘å¸ƒè®¢é˜…æ¨¡å‹
[12.11 å®ç°æ¶ˆæ¯å‘å¸ƒ/è®¢é˜…æ¨¡å‹ â€” python3-cookbook 3.0.0 æ–‡æ¡£](https://python3-cookbook.readthedocs.io/zh_CN/latest/c12/p11_implement_publish_subscribe_messaging.html)

### çº¿ç¨‹æ± 
è®¾è®¡åŸç†å’Œjavaçš„concurrentæ˜¯ä¸€æ ·çš„  
å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹éƒ½æ˜¯ä½¿ç”¨`from concurrent import futures`  
`ThreadPoolExecutor`,`as_completed`,`wait`  
    å¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡åè®®`with ThreadPoolExecutor(n) as executor:`  
ä¼˜ç‚¹æœ‰ç®¡ç†æ•°é‡ï¼Œè·å¾—çŠ¶æ€è¿”å›å€¼ï¼Œè®©ä¸»çº¿ç¨‹èƒ½çŸ¥é“çº¿ç¨‹å·²ç»å®Œæˆï¼Œè®©å¤šçº¿ç¨‹è¿›ç¨‹ç¼–ç ä¸€è‡´  
çº¿ç¨‹taskæ˜¯ä¸€ä¸ªfutureå¯¹è±¡ï¼Œä¸»è¦æ–¹æ³•`cancel`ï¼Œ`cancelled`ï¼Œ`running`ï¼Œ`done`ï¼Œ`result`ï¼Œ`add_done_callback`çœ‹å­—é¢å°±çŸ¥é“å•¥æ„æ€  
çº¿ç¨‹æ± å¯ä»¥æœ‰å¾ˆå¤šä¸ªtaskï¼Œmax_workerå†³å®šçš„æ˜¯å¹¶å‘æ•°é‡  
  
`as_completed` æ˜¯ä¸€ä¸ªyieldç”Ÿæˆå™¨ï¼Œæ¥æ”¶çº¿ç¨‹æ± ï¼Œyield<span style="background:greenyellow">å·²ç»å®Œæˆçš„çº¿ç¨‹ç»“æœ</span> 
  
`wait`æ¥æ”¶taskåˆ—è¡¨ï¼Œç”¨æ¥é˜»å¡ä¸»è¿›ç¨‹ï¼Œå½“taskåˆ—è¡¨ä¸­çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆæ‰ä¼šç»§ç»­æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨`return_when`å‚æ•°ä¿®æ”¹æ¡ä»¶  
- `FIRST_COMPLETED = 'FIRST_COMPLETED'
- `FIRST_EXCEPTION = 'FIRST_EXCEPTION'`
- `ALL_COMPLETED = 'ALL_COMPLETED'
- `_AS_COMPLETED = '_AS_COMPLETED'`

:::details Click to see more

```python
import time  
from concurrent.futures import ThreadPoolExecutor,as_completed,wait  
  
def tasks(times):  
    time.sleep(times)  
    print("ç¡äº†%sç§’"%times)  
    return times  
executor=ThreadPoolExecutor(max_workers=2) # çº¿ç¨‹æ± åŒæ—¶æ‰§è¡Œå‡ ä¸ª  
  
# æäº¤ä»»åŠ¡æ˜¯éé˜»å¡çš„  
task1=executor.submit(tasks,(3))  
task2=executor.submit(tasks,(2))  
  
print("is done: ",task1.done())# è¿”å›æ˜¯å¦å®Œæˆ  
print("cancal success ?",task2.cancel()) # ä»»åŠ¡åœ¨æ²¡æ‰§è¡Œæ‰å¯ä»¥å–æ¶ˆï¼Œæ‰§è¡Œå®Œå’Œæ‰§è¡Œä¸­æ˜¯æ— æ³•å–æ¶ˆçš„  
for future in as_completed([task1,task2]): # å¼‚æ­¥çš„ï¼Œå®é™…ä¸Šå°±æ˜¯yieldå‡ºæ¥ç»“æœpendingï¼Œå‰©ä¸‹çš„ç»§ç»­yield  
    # for data in executor.map(func ,[argList]) ä¹Ÿå¯ä»¥å®ç°ï¼Œè¿”å›çš„æ˜¯dataä¸æ˜¯futureå¯¹è±¡  
    # è¿™é‡Œçš„mapå’Œå†…ç½®çš„ä¸€ä¸ªæ„æ€ï¼Œè¿”å›é¡ºåºæ˜¯å’ŒargListä¸€æ ·çš„  
    data=future.result()  
    print("future data : ",data)  
  
wait([task1,task2],return_when='ALL_COMPLETED')  
time.sleep(3)  
  
print("is done: ",task2.done())  
print("task result :",task1.result())
```
è¿è¡Œç»“æœ
```
cancal success ? False
ç¡äº†2ç§’
future data :  2
ç¡äº†3ç§’
future data :  3
is done:  True
task result : 3
```
:::
#### çº¿ç¨‹çš„ç»ˆæ­¢
çŸ¥é“è¿™ä¸ªäº‹ï¼Œåˆ°æ—¶å€™å»æœ  
ç»ˆæ­¢çº¿ç¨‹å®˜æ–¹æä¾›çš„æ¥å£å®é™…ä¸Šä¸æ˜¯é‚£ä¹ˆå¥½ç”¨ï¼Œç†æƒ³æ–¹å¼æ˜¯è®¾ç½®æ ‡å¿—ä½ï¼Œæ£€æµ‹æ ‡å¿—ä½Falseï¼Œå†™æˆä¸­å¸¸ç”¨  
ä½†æ˜¯åœ¨é¡¹ç›®ä¸­å¯èƒ½å‡½æ•°æ ¹æœ¬æ²¡æ³•æ£€æŸ¥åˆ°æ ‡å¿—ä½é‚£ä¸€æ­¥å°±é˜»å¡äº†ï¼Œå¼ºåˆ¶ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹æ˜¯å¾ˆå±é™©çš„  
callbacké‡Œä½¿ç”¨`res=ctypes.pythonapi.PyThreadState_SetAsyncExc(thread_id,ctypes.py_object(SystemExit))`
### å¤šè¿›ç¨‹
å¯å……åˆ†åˆ©ç”¨CPU,å¤šè¿›ç¨‹åˆ‡æ¢æ›´åŠ è€—æ—¶ï¼Œæ‰€ä»¥æ—¶é—´ä¸æ˜¯ç®€å•é™¤ï¼Œèƒ½å¼€çš„çº¿ç¨‹æ•°æ¯”è¿›ç¨‹å¤šå¾ˆå¤šï¼Œå¤šçº¿ç¨‹ç¨³å®šæ€§æ¯”å¤šè¿›ç¨‹å¥½  
:::warning âš ï¸Warning
åœ¨windowså’Œmacosä¸‹å¤šè¿›ç¨‹ç¼–ç¨‹å¿…é¡»æ”¾åˆ°`if __name__ == "__main__":`å¦åˆ™ä¼šæŠ¥`BrokenProcessPool`  
linuxä¸ä¼š
:::
forkçš„æ—¶å€™ï¼Œä¼šé¢å¤–åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹ä¼šæŠŠçˆ¶è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®éƒ½å¤åˆ¶ä¸€ä»½ï¼Œæ•°æ®ä¼šå®Œå…¨éš”ç¦»ï¼Œä¼šä»forkä¹‹åçš„ä»£ç ä¾æ¬¡è¿è¡Œã€‚  
çˆ¶è¿›ç¨‹ç»“æŸä¹‹åï¼Œå­è¿›ç¨‹æœªç»“æŸï¼Œå­è¿›ç¨‹ä¼šç»§ç»­æ‰§è¡Œæ‰“å°ï¼Œä½†å®é™…ä¸Šä½ å·²ç»å¯ä»¥åŠ¨äº†ã€‚
`from concurrent.futures import ProcessPoolExecutor`æ¥å£å½¢çŠ¶å’Œ`ThreadPoolExecutor`ä¸€æ¨¡ä¸€æ ·ã€‚
#### multiprocessing
[æ–‡æ¡£](https://docs.python.org/zh-cn/3.7/library/multiprocessing.html)  
æ¯”ProcessPoolExecutoræ›´åŠ åº•å±‚ï¼Œä¸€èˆ¬ç”¨ä¸Šé¢é‚£ä¸ªï¼Œè¿™ä¸ªç”¨çš„å°‘  
é»˜è®¤è¿›ç¨‹æ± çš„è¿›ç¨‹æ•°æ˜¯å’ŒCPUçš„æ•°é‡ç›¸ç­‰çš„  

`apply_async` æ˜¯åœ¨ä¸€ä¸ªæ± å·¥ä½œè¿›ç¨‹ä¸­**å¼‚æ­¥**åœ°æ‰§è¡Œå‡½æ•°ï¼Œç„¶åè¿”å›ç»“æœ  
`apply`æ˜¯åœ¨ä¸€ä¸ªæ± å·¥ä½œè¿›ç¨‹ä¸­æ‰§è¡Œå‡½æ•°ï¼Œç„¶åè¿”å›ç»“æœã€‚  
`multiprocessing.cpu_count()`è·å¾—  
`pool.close()`å…³é—­è¿›ç¨‹æ± ä¸å†æ¥æ”¶æ–°ä»»åŠ¡  
`pool.join()`ç­‰å¾…æ± ä¸­çš„ä»»åŠ¡å…¨éƒ½å®Œæˆï¼Œjoinä¹‹å‰å¿…é¡»close  
`imap`å’Œ`imap_unordered`é¡¾åæ€ä¹‰ï¼Œå’Œä¸Šé¢é‚£ä¸ªä¸€æ ·  
å•ä¸ªçš„task startä¹‹åä¼šæœ‰PIDï¼Œå¯ä»¥é€šè¿‡`pid`å±æ€§æŸ¥çœ‹  
`daemon`å±æ€§ç­‰ä»·äºå¤šè¿›ç¨‹çš„setDaemon
:::details Click to see more

```python
import multiprocessing  
import time  
from multiprocessing import Lock  
  
def task(times):  
    print('Process % start'%times)  
    time.sleep(times)  
    print('Process % end'%times)  
    return "æˆ‘å®Œæˆäº†--%s"%times  
if __name__ == '__main__':  
    t1=multiprocessing.Process(target=task,args=(3,))  
    t1.start() # å•ä¸ªçš„
    print("multiprocessã€‚ã€‚ã€‚")  
    # ç”³è¯·ä¸€ä¸ªworkeræ•°é‡å’Œcupæ ¸æ•°ç›¸ç­‰çš„æ±   
    pool=multiprocessing.Pool(multiprocessing.cpu_count())  
    results=[]  
    for i in [1,2,3] :  
        result=pool.apply_async(func=task,args=(i,)) # çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡  
        results.append(result)  
    pool.close()  
    pool.join() # é˜»å¡ç­‰å¾…å®Œæˆ  
    for r in results:  
        print(r.get())
```
è¿è¡Œç»“æœ
```
multiprocessã€‚ã€‚ã€‚
Process 3tart
Process 1tart
Process 2tart
Process 3tart
Process  1.000000e+00nd
Process  2.000000e+00nd
Process  3.000000e+00nd
Process  3.000000e+00nd
æˆ‘å®Œæˆäº†--1
æˆ‘å®Œæˆäº†--2
æˆ‘å®Œæˆäº†--3
```
:::

### è¿›ç¨‹é€šä¿¡
:::warning â“Question
ä¸ºå•¥ä¸èƒ½å¤šè¿›ç¨‹è°ƒèµ·å¤šçº¿ç¨‹ï¼Ÿè¿™æ ·ä¸å¿«å—  
æš‚æ—¶çš„ç­”æ¡ˆï¼Œæ²¡å¿…è¦ï¼Œä¸»è¿›ç¨‹å¯ä»¥å¼€å¤šçº¿ç¨‹è´Ÿè´£ioï¼Œå­è¿›ç¨‹è´Ÿè´£è®¡ç®—å°±å¯ä»¥äº†ï¼Œå¤ªå¤æ‚äº†ä¸åˆ©äºå¼€å‘
:::

<span style="background:greenyellow">å¤šçº¿ç¨‹çš„é”å’Œé˜Ÿåˆ—å…±äº«ç­‰åœ¨å¤šè¿›ç¨‹éƒ½æ˜¯ä¸èƒ½ç”¨çš„</span>ï¼Œä½†æ˜¯åœ¨multiprocessingä¸­æœ‰æ›¿ä»£å“
 - Queueå’Œå¤šçº¿ç¨‹ä¸­çš„ä¸€æ ·ï¼Œä½†æ˜¯åœ¨multiprocessingä¸­è¿›ç¨‹æ± æ˜¯ä¸é€‚ç”¨çš„
     - åœ¨è¿›ç¨‹æ± ä¸­ä½¿ç”¨`Manager().Queue()`æ›¿ä»£,åé¢ä¿©æ–¹æ³•é€‚ç”¨äºJoinableQueueå’ŒManagerçš„Queu
     - `q.task_done()`ï¼šæ¶ˆè´¹è€…ä½¿ç”¨æ­¤æ–¹æ³•å‘å‡ºä¿¡å·ï¼Œè¡¨ç¤ºq.get()çš„å½“å‰è¿”å›é¡¹ç›®å·²ç»è¢«å¤„ç†
     - `q.join()`ï¼šç”Ÿäº§è€…è°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œé˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„é¡¹ç›®å‡task_downå¤„ç†
 - å…¨å±€å»å˜é‡æ˜¯ä¸é€‚ç”¨çš„ï¼Œæ•°æ®æ˜¯éš”ç¦»çš„
 - Pipeç®¡é“è¿›è¡Œé€šä¿¡ï¼Œç®€åŒ–ç‰ˆçš„Queue
     - ä¸€æ¬¡å®šä¹‰ï¼Œè¿”å›ä¸¤ä¸ªç«¯`receive_pipe,send_pipe=Pipe()`
     - åªèƒ½é€‚ç”¨äºä¸¤ä¸ªè¿›ç¨‹ï¼Œä½¿ç”¨sendå’Œrecvé€šä¿¡
     - æ€§èƒ½æ¯”Queueé«˜
 - å…±äº«å†…å­˜æ“ä½œï¼Œ`Manager`
     - ä¼šæŠŠå˜é‡æ”¾åˆ°å…±äº«å†…å­˜ä¸­å»ï¼Œå¸¸è§çš„å‡ ä¸ªéƒ½æœ‰æ¯”å¦‚`dict()`
     - ä¸éƒ½æ˜¯è¿›ç¨‹å®‰å…¨çš„ï¼Œæ³¨æ„åŒæ­¥é—®é¢˜
     - å•ä¸ª`Manager`å¯ä»¥é€šè¿‡ç½‘ç»œç”±ä¸åŒè®¡ç®—æœºä¸Šçš„è¿›ç¨‹å…±äº«ï¼Œä½†å®ƒä»¬æ¯”ä½¿ç”¨å…±äº«å†…å­˜æ…¢ã€‚

:::details Click to see more
**ä¸¤ä¸ªè¿›ç¨‹çš„Pipeå’ŒQueueæµ‹è¯•**<br/>
```python
import time  
import multiprocessing  
from multiprocessing import Pipe,Queue  
  
  
def fun1(arg1,q,p):  
    print("1 begin", arg1)  
    time.sleep(2)  
    print("1 end....")  
    temp=q.get()  
    print("é˜Ÿåˆ—ä¸­æ‹¿äº†",temp)  
    p.send(temp)  
  
  
def fun2(arg2,q,p):  
    q.put("199")  
    print("2 begin", arg2)  
    time.sleep(4)  
    print("2 end....")  
    print("ç®¡é“æ‹¿å›æ¥",p.recv())  
  
if __name__ == '__main__':  
    q=Queue(maxsize=10)  
    recv_p,send_p=Pipe()  
    t1 = multiprocessing.Process(target=fun1, args=("æˆ‘æ˜¯çº¿ç¨‹1",q,send_p))  
    t2 = multiprocessing.Process(target=fun2, args=("æˆ‘æ˜¯çº¿ç¨‹2",q,recv_p))  
  
    t1.start()  
    t2.start()  
    t1.join()  
    t2.join()
```
è¿è¡Œç»“æœ
```
1 begin æˆ‘æ˜¯çº¿ç¨‹1
2 begin æˆ‘æ˜¯çº¿ç¨‹2
1 end....
é˜Ÿåˆ—ä¸­æ‹¿äº† 199
2 end....
ç®¡é“æ‹¿å›æ¥ 199
```
:::

:::details Click to see more
**Managerè¿›ç¨‹æ± é€šä¿¡+ç»§æ‰¿Processç±»**<br/>
```python
# -*-coding:utf-8-*-  
import multiprocessing  
import random  
from multiprocessing import Manager  
import time  
# ä½¿ç”¨çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—çš„ç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å‹  
class Productor(multiprocessing.Process):  
    def __init__(self, name,q,d):  
        print("åˆå§‹åŒ–%sè¿›ç¨‹:" % name)  
        self.q=q # å®éªŒé˜Ÿåˆ—  
        self.d=d # å®éªŒdict  
        super().__init__(name=name)  
  
    def run(self):  
        while True:  
            time.sleep(0.5)  # å‡è®¾æ¯ä¸ªç”Ÿäº§è€…æ¯0.5ç§’ç”Ÿäº§ä¸€ä¸ª  
            value = random.randint(0, 1024)  
            self.q.put(value)  
            print("%s Product : %d" % (self.name,value))  
            if value%100==0: # 100çš„å€æ•°å°±æ”¾å…¥å­—å…¸  
                self.d[str(random.randint(1,4096))]=value  
  
class Consumer(multiprocessing.Process):  
    def __init__(self, name,q,d):  
        print("åˆå§‹åŒ–%sè¿›ç¨‹:" % name)  
        self.q=q # å®éªŒé˜Ÿåˆ—  
        self.d=d# å®éªŒdict  
        super().__init__(name=name)  
  
    def run(self):  
        while True:  
            time.sleep(0.2)  
            temp = self.q.get()  
            print("%s Comsume : %d" % (self.name,temp))  
            if temp%100==0:# 100çš„èƒŒä¹¦æ‰“å°å­—å…¸  
                print(self.d)  
  
if __name__ == '__main__':  
    d=Manager().dict()  
    q = Manager().Queue(maxsize=100)  # å°±ä¸€ä¸ªå‚æ•°ï¼Œå®šä¹‰ä¸€ä¸ªé•¿åº¦100çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—  
    pool=[] # è‡ªåˆ¶å‡è¿›ç¨‹æ± ï¼Œæˆ‘è¿˜æ²¡æ‰¾åˆ°æ€ä¹ˆç”¨ç±»åŒæ—¶ç”¨çº¿ç¨‹æ±   
    for i in range(1, 3):  
        pool.append(Consumer(name="æ¶ˆè´¹è€…%d" % i,q=q,d=d))  
    for i in range(1, 5):  
        pool.append(Productor(name="ç”Ÿäº§è€…%d" % i,q=q,d=d))  
    for i in pool:  
        i.start()  
    for i in pool:  
        i.join()
```
è¿è¡Œç»“æœ
```
åˆå§‹åŒ–æ¶ˆè´¹è€…1è¿›ç¨‹:
åˆå§‹åŒ–æ¶ˆè´¹è€…2è¿›ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…1è¿›ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…2è¿›ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…3è¿›ç¨‹:
åˆå§‹åŒ–ç”Ÿäº§è€…4è¿›ç¨‹:
...
ç”Ÿäº§è€…2 Product : 227
æ¶ˆè´¹è€…1 Comsume : 699
æ¶ˆè´¹è€…1 Comsume : 522
æ¶ˆè´¹è€…2 Comsume : 100
{'3112': 100}
ç”Ÿäº§è€…4 Product : 872
ç”Ÿäº§è€…3 Product : 982
æ¶ˆè´¹è€…2 Comsume : 872
```
:::

### è¿›ç¨‹æœ¬åœ°socketé€šä¿¡
#TODO è¿›ç¨‹æœ¬åœ°socketé€šä¿¡
å¯ç®—å®Œäº†

------------
## åç¨‹å’Œå¼‚æ­¥
### IOå¤šè·¯å¤ç”¨å’ŒC10K
:::tip ğŸ“ŒTip
è¿™ä¸€ç« æ˜¯è®²è§£æ¯”è¾ƒåº•å±‚æœºåˆ¶çš„ï¼Œåº”ç”¨çš„æ—¶å€™èƒ½æŸ¥åˆ°å³å¯ï¼Œä¸ç”¨ç†Ÿç»ƒæŒæ¡
:::
å¹¶å‘æ˜¯ä¸€ä¸ªæ—¶åˆ»å†…åªæœ‰ä¸€ä¸ªç¨‹åºè¿è¡Œåœ¨ä¸€ä¸ªCPUä¸Šï¼Œå¹¶è¡Œæ˜¯åœ¨ä¸€ä¸ªæ—¶åˆ»å†…å¤šä¸ªç¨‹åºè¿è¡Œåœ¨å¤šä¸ªCPUä¸Šï¼Œæœ€å¤šå’ŒCPUæ ¸æ•°ä¸€æ ·  
æ¶ˆæ¯é€šä¿¡æœºåˆ¶åŒæ­¥å¼‚æ­¥æ˜¯æ˜¯å¦ç­‰å¾…IOæ“ä½œ  
é˜»å¡å’Œéé˜»å¡æ˜¯æŒ‡å½“å‰çº¿ç¨‹æ˜¯å¦ä¼šè¢«æŒ‚èµ·  
C10Ké—®é¢˜ï¼Œ1999å¹´æå‡ºæ¥çš„çš„æŠ€æœ¯æŒ‘æˆ˜ï¼Œä½¿ç”¨1Ghz 2GBå†…å­˜ 1gbpsä¸‹ä¸º1ä¸‡ä¸ªç”¨æˆ·æä¾›FTPæœåŠ¡  
C10Mé—®é¢˜ï¼Œå¦‚ä½•åˆ©ç”¨ 8 æ ¸å¿ƒ CPU,64G å†…å­˜ï¼Œåœ¨ 10gbps çš„ç½‘ç»œä¸Šä¿æŒ 1000 ä¸‡å¹¶å‘è¿æ¥
#### Unixä¸‹çš„äº”ç§IOæ¨¡å‹
- é˜»å¡å¼ I/O 
- éé˜»å¡å¼ I/O 
- I/Oå¤ç”¨
> select ç›®å‰å‡ ä¹åœ¨æ‰€æœ‰çš„å¹³å°ä¸Šæ”¯ç‰¹ï¼Œå…¶è‰¯å¥½è·¨å¹³å°æ”¯æŒä¹Ÿæ˜¯å®ƒçš„ä¸€ä¸ªä¼˜ç‚¹ã€‚select çš„ä¸€ä¸ªç¼ºç‚¹åœ¨äºå•ä¸ªè¿›ç¨‹èƒ½å¤Ÿç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡å­˜åœ¨æœ€å¤§é™åˆ¶ï¼Œåœ¨ Liux ä¸Šä¸€èˆ¬ä¸º 1024ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å®å®šä¹‰ç”šè‡³é‡æ–°ç¼–è¯‘å†…æ ¸çš„æ–¹å¼æå‡è¿™ä¸€é™åˆ¶ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿä¼šé€ æˆæ•ˆç‡çš„é™ä½ã€‚
>select,pol,epolléƒ½æ˜¯IOå¤šè·¯å¤ç”¨çš„æœºåˆ¶ã€‚I/Oå¤šè·¯å¤ç”¨å°±æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼‰ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œã€‚ä½† select, pollï¼Œepollæœ¬è´¨ä¸Šéƒ½æ˜¯åŒæ­¥I/O,å› ä¸ºä»–ä»¬éƒ½éœ€è¦åœ¨è¯»å†™äº‹ä»¶å°±ç»ªåè‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¯»å†™è¿‡ç¨‹æ˜¯é˜»å¡çš„
>è€Œå¼‚æ­¥IOåˆ™æ— éœ€è‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œå¼‚æ­¥I/Oçš„å®ç°ä¼šè´Ÿè´£æŠŠæ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚
>
>Select å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ† 3 ç±»ï¼Œåˆ†åˆ«æ˜¯ writefdsã€readfdsã€å’Œ exceptfdsã€‚ã€‚è°ƒç”¨å selecti å‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°å‰¯å°±ç»ªï¼ˆæœ‰æ•°æ®å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰ exceptï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆtimeout æŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç«‹å³è¿”å›è®¾ä¸º null å³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚å½“ selecti å‡½æ•°è¿”å›åï¼Œå¯ä»¥é€šè¿‡éå† fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚
>
>ä¸åŒä¸ select ä½¿ç”¨ä¸‰ä¸ªä½å›¾æ¥è¡¨ç¤ºä¸‰ä¸ª fdset çš„æ–¹å¼ï¼Œpol ä½¿ç”¨ä¸€ä¸ª pollfd çš„æŒ‡é’ˆå®ç°ã€‚
>pollfd ç»“æ„åŒ…å«äº†è¦ç›‘è§†çš„ eventiå’Œå‘ç”Ÿçš„ eventï¼Œä¸å†ä½¿ç”¨ selectâ€œå‚æ•°-å€¼â€ä¼ é€’çš„æ–¹å¼ã€‚åŒæ—¶ï¼Œpo å· fd å¹¶æ²¡æœ‰æœ€å¤§æ•°é‡é™åˆ¶ï¼ˆä½†æ˜¯æ•°é‡è¿‡å¤§åæ€§èƒ½ä¹Ÿæ˜¯ä¼šä¸‹é™ï¼‰ã€‚å’Œ selecti å‡½æ•°ä¸€æ ·ï¼Œpoll è¿”å›åï¼Œéœ€è¦è½®è¯¢ oollfd æ¥è·å–å°±ç»ªçš„æè¿°ç¬¦ã€‚
>ä»ä¸Šé¢çœ‹ï¼Œselect å’Œ pol éƒ½éœ€è¦åœ¨è¿”å›åï¼Œé€šè¿‡éå†æ–‡ä»¶æè¿°ç¬¦æ¥è·å–å·²ç»å°±ç»ªçš„ socketã€‚äº‹å®ä¸Šï¼ŒåŒæ—¶è¿æ¥çš„å¤§é‡å®¢æˆ·ç«¯åœ¨ä¸€æ—¶åˆ»å¯èƒ½åªæœ‰å¾ˆå°‘çš„å¤„äºå°±ç»ªçŠ¶æ€ï¼Œå› æ­¤éšç€ç›‘è§†çš„æè¿°ç¬¦æ•°é‡çš„å¢é•¿ï¼Œå…¶æ•ˆç‡ä¹Ÿä¼šçº¿æ€§ä¸‹é™
>
>epoll æ˜¯åœ¨ 2.6 å†…æ ¸ä¸­æå‡ºçš„ï¼Œæ˜¯ä¹‹å‰çš„ select å’Œ poll çš„å¢å¼ºç‰ˆæœ¬ã€‚ç›¸å¯¹äº select å’Œ poll æ¥è¯´ï¼Œepoll æ›´åŠ çµæ´»ï¼Œæ²¡æœ‰æè¿°ç¬¦é™åˆ¶ã€‚epollf ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦ï¼Œå°†ç”¨æˆ·å…³ç³»çš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œè¿™æ ·åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„ copy åªéœ€ä¸€æ¬¡,ä½¿ç”¨çº¢é»‘æ ‘å®ç°ï¼Œæ•ˆç‡é«˜

- ä¿¡å·é©±åŠ¨å¼ I/O
- å¼‚æ­¥I/O(POSIXçš„aio_ç³»åˆ—å‡½æ•°ï¼‰
#TODO è¿™é‡Œä»¥åç­‰ç€é“¾æ¥åˆ°è¯¦è§£Linux IOå¤šè·¯å¤ç”¨çš„åœ°æ–¹

:::details Click to see more
**ä½¿ç”¨éé˜»å¡IOè¿›è¡Œsocket**<br/>
```python
  
import socket  
from urllib.parse import urlparse  
"""éé˜»å¡IO"""  
def get_url(url):  
    #é€šè¿‡socketè¯·æ±‚html  
    url = urlparse(url)  
    host = url.netloc  
    path = url.path  
    if path == "":  
        path = "/"  
  
    #å»ºç«‹socketè¿æ¥  
    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  
    client.setblocking(False) # è®¾ç½®ä¸ºéé˜»å¡  
    while True:  
        try:  
            client.connect((host, 80)) # é˜»å¡ä¸ä¼šæ¶ˆè€—cpuï¼Œé˜»å¡å›æŠ¥é”™ï¼Œå…¶å®å·²ç»å‘å‡ºå»äº†  
  
        except BlockingIOError as e :  
            pass  
        except OSError as e:  
            break  
  
    while True:  
        try:  
            client.send("GET {} HTTP/1.1\r\nHost:{}\r\nConnection:close\r\n\r\n".format(path, host).encode("utf8"))  
            break  
        except OSError as e :  
            pass  
  
    data = b""  
    while True:  
        try:  
            d = client.recv(1024)  
        except BlockingIOError as e :  
            continue  
        if d:  
            data += d  
        else:  
            break  
  
    data = data.decode("utf8")  
    html_data = data.split("\r\n\r\n")<br/>[1]  
    print(html_data)  
    client.close()  
  
if __name__ == "__main__":  
    for url in range(20):  
        url = "http://www.baidu.com/"  
        get_url(url)
```
è¿è¡Œç»“æœ
```
<!DOCTYPE html><html><head><meta http-...
<!DOCTYPE html><html><head><meta http-...
<!DOCTYPE html><html><head><meta http-...
<!DOCTYPE html><html><head><meta http-...
...
```
:::

#### selector
pythonä¸­ç›´æ¥ä½¿ç”¨selectä¸å¤šï¼Œéƒ½æ˜¯ç”¨selectorå†…éƒ¨å®ƒä¹Ÿæ˜¯selectå®ç°çš„ï¼ŒDefaultSelectorä¼šæ ¹æ®å¹³å°è‡ªåŠ¨é€‰æ‹©ä¸‰ç§éé˜»å¡IOæ¨¡å¼  
[12.4. selectors â€” I/O å¤šè·¯å¤ç”¨æŠ½è±¡å±‚ | ç½‘ç»œæ¨¡å— |ã€ŠPython 3 æ ‡å‡†åº“å®ä¾‹æ•™ç¨‹ã€‹| Python æŠ€æœ¯è®ºå›](https://learnku.com/docs/pymotw/selectors-io-multiplexing-abstractions/3428)  
#TODO è¿™ä¸ªSelectoræˆ‘æ˜¯çœŸæ²¡çœ‹æ‡‚å’‹å›äº‹  

:::details Click to see more
**æ•™ç¨‹ç»™çš„ä»£ç ï¼Œä»¥åå†æ”¹å§**<br/>
```python
#1. epollå¹¶ä¸ä»£è¡¨ä¸€å®šæ¯”selectå¥½  
# åœ¨å¹¶å‘é«˜çš„æƒ…å†µä¸‹ï¼Œè¿æ¥æ´»è·ƒåº¦ä¸æ˜¯å¾ˆé«˜ï¼Œ epollæ¯”select  
# å¹¶å‘æ€§ä¸é«˜ï¼ŒåŒæ—¶è¿æ¥å¾ˆæ´»è·ƒï¼Œ selectæ¯”epollå¥½  
  
#é€šè¿‡éé˜»å¡ioå®ç°httpè¯·æ±‚  
# select + å›è°ƒ + äº‹ä»¶å¾ªç¯  
#  å¹¶å‘æ€§é«˜  
# ä½¿ç”¨å•çº¿ç¨‹  
  
import socket  
from urllib.parse import urlparse  
from selectors import DefaultSelector, EVENT_READ, EVENT_WRITE  
  
  
selector = DefaultSelector()  
#ä½¿ç”¨selectå®Œæˆhttpè¯·æ±‚  
urls = []  
stop = False  
  
  
class Fetcher:  
    def connected(self, key):  
        selector.unregister(key.fd)  
        self.client.send("GET {} HTTP/1.1\r\nHost:{}\r\nConnection:close\r\n\r\n".format(self.path, self.host).encode("utf8"))  
        selector.register(self.client.fileno(), EVENT_READ, self.readable)  
  
    def readable(self, key):  
        d = self.client.recv(1024)  
        if d:  
            self.data += d  
        else:  
            selector.unregister(key.fd)  
            data = self.data.decode("utf8")  
            html_data = data.split("\r\n\r\n")<br/>[1]  
            print(html_data)  
            self.client.close()  
            urls.remove(self.spider_url)  
            if not urls:  
                global stop  
                stop = True  
  
    def get_url(self, url):  
        self.spider_url = url  
        url = urlparse(url)  
        self.host = url.netloc  
        self.path = url.path  
        self.data = b""  
        if self.path == "":  
            self.path = "/"  
  
        # å»ºç«‹socketè¿æ¥  
        self.client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  
        self.client.setblocking(False)  
  
        try:  
            self.client.connect((self.host, 80))  # é˜»å¡ä¸ä¼šæ¶ˆè€—cpu  
        except BlockingIOError as e:  
            pass  
  
        #æ³¨å†Œ  
        selector.register(self.client.fileno(), EVENT_WRITE, self.connected)  
  
  
def loop():  
    #äº‹ä»¶å¾ªç¯ï¼Œä¸åœçš„è¯·æ±‚socketçš„çŠ¶æ€å¹¶è°ƒç”¨å¯¹åº”çš„å›è°ƒå‡½æ•°  
    #1. selectæœ¬èº«æ˜¯ä¸æ”¯æŒregisteræ¨¡å¼  
    #2. socketçŠ¶æ€å˜åŒ–ä»¥åçš„å›è°ƒæ˜¯ç”±ç¨‹åºå‘˜å®Œæˆçš„  
    while not stop:  
        ready = selector.select()  
        for key, mask in ready:  
            call_back = key.data  
            call_back(key)  
    #å›è°ƒ+äº‹ä»¶å¾ªç¯+select(poll\epoll)  
  
if __name__ == "__main__":  
    fetcher = Fetcher()  
    import time  
    start_time = time.time()  
    for url in range(20):  
        url = "http://shop.projectsedu.com/goods/{}/".format(url)  
        urls.append(url)  
        fetcher = Fetcher()  
        fetcher.get_url(url)  
    loop()  
    print(time.time()-start_time)
```
è¿è¡Œç»“æœ
```

```
:::
##### å›è°ƒçš„ç¼ºé™·
1. ç¼–ç¨‹è¿‡ç¨‹å››åˆ†äº”è£‚ï¼Œç»´æŠ¤éº»çƒ¦
2. å‡ºç°é”™è¯¯çš„æ—¶å€™è°ƒè¯•å›°éš¾
3. å¼‚å¸¸å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶å¤„ç†éº»çƒ¦
4. æœ‰æ•°æ®éœ€è¦å¤šæ¬¡å¤„ç†å¾ˆéº»çƒ¦
5. ç®¡ç†å…±äº«å˜é‡å›°éš¾
#### example-4ç”¨selector+socketå®ç°ç¾¤èŠ
#TODO è¿™ä¸ªselector+socketæ¯”è¾ƒéš¾ï¼Œä»¥ååœ¨æ

### åŸç”Ÿåç¨‹
1. å›è°ƒæ¨¡å¼ç¼–ç å¤æ‚åº¦é«˜ 
2. åŒæ­¥ç¼–ç¨‹çš„å¹¶å‘æ€§ä¸é«˜
3. å¤šçº¿ç¨‹ç¼–ç¨‹éœ€è¦çº¿ç¨‹é—´åŒæ­¥ï¼ŒLockè¿˜ä¼šå½±å“æ€§èƒ½  

ç†æƒ³è°ƒåº¦:
1. é‡‡ç”¨åŒæ­¥çš„æ–¹å¼å»ç¼–å†™å¼‚æ­¥çš„ä»£ç  
2. ä½¿ç”¨å•çº¿ç¨‹å»åˆ‡æ¢ä»»åŠ¡ï¼š
    1. çº¿ç¨‹æ˜¯ç”±æ“ä½œç³»ç»Ÿåˆ‡æ¢çš„ï¼Œå•çº¿ç¨‹åˆ‡æ¢æ„å‘³ç€æˆ‘ä»¬éœ€è¦ç¨‹åºå‘˜è‡ªå·±å»è°ƒåº¦ä»»åŠ¡å’Œå‡½æ•°
    2. ä¸åœ¨éœ€è¦é”ï¼Œå¹¶å‘æ€§é«˜ï¼Œå¦‚æœå•çº¿ç¨‹å†…åˆ‡æ¢å‡½æ•°ï¼Œæ€§èƒ½è¿œé«˜äºçº¿ç¨‹åˆ‡æ¢ï¼Œå¹¶å‘æ€§æ›´é«˜  

è¿™å°±éœ€è¦æˆ‘ä»¬è¦æš‚åœå‡½æ•°å¹¶ä¸”åˆé€‚çš„æ—¶å€™æ¢å¤  
Coroutine[åç¨‹](https://zh.wikipedia.org/wiki/%E5%8D%8F%E7%A8%8B)å°±æ˜¯æœ‰å¤šä¸ªå…¥å£çš„å‡½æ•°ï¼Œå¯ä»¥æš‚åœçš„å‡½æ•°ï¼Œå¯ä»¥å‘æš‚åœçš„åœ°æ–¹ä¼ å…¥å€¼   

3.5ä»¥åç›´æ¥å¼•å…¥äº†async awaitå®šä¹‰åŸç”Ÿåç¨‹ï¼Œè°ƒç”¨å’Œæ¿€æ´»çš„æ—¶å€™è¦`send(None)`nextä¸èƒ½ç”¨  
å¼•å…¥åç¨‹å…³é”®å­—é¿å…ä»£ç æ··ä¹±ï¼Œå°†åç¨‹å’Œç”Ÿæˆå™¨åŒºåˆ†å¼€  
asyncé‡Œé¢æ˜¯ä¸èƒ½å®šä¹‰yieldçš„ï¼Œä½¿ç”¨`async def fun()`å°†ä¸€ä¸ªå‡½æ•°å®šä¹‰ä¸ºåç¨‹ï¼Œå³ä¸€ä¸ª`Awaitable`å¯¹è±¡,å‡½æ•°ä½“å†…ä½¿ç”¨awaitäº¤å‡ºæ§åˆ¶æƒã€‚  
awaitåé¢å£°æ˜ä¸€ä¸ª`Awaitable`å¯¹è±¡(å®ç°`__await__()`)ï¼Œ@types.coroutineè£…é¥°å™¨ä¹Ÿæ˜¯åŒ…è£…å®ç°è¿™ä¸ªé­”æ³•å‡½æ•°  
å¯ä»¥å°†awaitè§£è¯»ä¸ºyield from  
è¿™ä¿©ä¸œè¥¿æ¯”ä¸æ¯”yieldæ€§èƒ½é«˜ï¼Œä½†æ˜¯ç¼–ç ç»´æŠ¤é¡ºç•…å¾ˆå¤šï¼Œä¸€èˆ¬ç”¨è¿™ä¿©å°±è¡Œ  
```python
async def B():  
    return "back!"  
async def A():  
    b = await B()  
    return b  
coro=A()  
print(coro.send(None))
#----ç»“æœ----
Traceback (most recent call last):
  File "/Users/jack/code/py/AdvancedPython/asyncio_prac/await-async.py", line 9, in <module>
    print(coro.send(None))
StopIteration: back!
```

:::warning âš ï¸Warning
åç¨‹æ˜¯å•çº¿ç¨‹çš„ï¼Œå¼‚æ­¥ä»£ç ä¸­ä¸è¦ä½¿ç”¨é˜»å¡æ“ä½œï¼Œåº”è¯¥æŠŠæ§åˆ¶æƒäº¤å‡ºå»ï¼Ÿ  
**ä½¿ç”¨å¤šçº¿ç¨‹æ‰”ç»™å…¶ä»–çº¿ç¨‹é˜»å¡ç€ï¼Œå¯†é›†è®¡ç®—å°±æ‰”ç»™å¤šè¿›ç¨‹**
åç¨‹å¿…é¡»æ­é…äº‹ä»¶å¾ªç¯ä½¿ç”¨ï¼Œå•ç‹¬ç”¨æ²¡æ„ä¹‰ï¼Œasyncioæä¾›äº†åˆé€‚çš„æ¥å£å’Œäº‹ä»¶å¾ªç¯  
[å¼‚æ­¥ioè¯¦è§£](https://hatboy.github.io/2019/02/16/Python%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E8%AF%A6%E8%A7%A3/) è¿™ä¸ªäººå†™çš„å¤ªå‰å®³äº†ï¼Œç”šè‡³ä»¤äººæƒŠå¹  
[è¿™ä¸ª](https://www.cnblogs.com/ssyfj/p/9222342.html)ä¹Ÿè¡Œ

:::

### asyncioå¹¶å‘
#### åŸºæœ¬ç”¨æ³•å’ŒåµŒå¥—
æä¾›äº†ä¸åŒç³»ç»Ÿçš„äº‹ä»¶å¾ªç¯ï¼Œä¼ è¾“åè®®æŠ½è±¡ï¼Œå®ç°äº†å¼‚æ­¥çš„Futureç±»ï¼Œå¿…é¡»ä½¿ç”¨å°†äº§ç”Ÿé˜»å¡IOçš„è°ƒç”¨æ—¶ï¼Œæœ‰æ¥å£å¯ä»¥æŠŠè¿™ä¸ªäº‹ä»¶è½¬ç§»åˆ°çº¿ç¨‹æ±   
twistedï¼Œgeventéƒ½æ˜¯åˆ©ç”¨è¿™ä¸ªå®ç°çš„  
ä¸€ä¸ªçº¿ç¨‹é‡Œé¢åªæœ‰ä¸€ä¸ªeventloopï¼Œæ²¡æœ‰å°±ä¼šè‡ªå·±è·å¾—  

åç¨‹çš„ä½¿ç”¨æµç¨‹æ˜¯ï¼Œå®šä¹‰åç¨‹å‡½æ•°->æ„å»ºåç¨‹å¯¹è±¡->æäº¤åˆ°åç¨‹æ± ->loop->æ‹¿åˆ°ç»“æœ  
  
Futureå…¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œç”¨äºæ¥å—å¼‚æ­¥æ‰§è¡Œçš„ç»“æœï¼Œç”¨åˆ°çš„å¹¶ä¸å¤šå¯ä»¥åŠ æ·±ç†è§£  

>Furture å¯¹è±¡å†…éƒ¨å°è£…äº†ä¸€ä¸ª `_state`ï¼Œè¿™ä¸ª `_state` ç»´æŠ¤ç€å››ç§çŠ¶æ€ï¼š**Pending**ã€**Running**ã€**Done**ï¼Œ**Cancelled**ï¼Œå¦‚æœå˜æˆ `Done` å®Œæˆï¼Œå°±ä¸å†ç­‰å¾…ï¼Œè€Œæ˜¯å¾€åæ‰§è¡Œï¼Œè¿™å››ç§çŠ¶æ€çš„å­˜åœ¨å…¶å®ç±»ä¼¼ä¸è¿›ç¨‹çš„ è¿è¡Œæ€ã€å°±ç»ªæ€ã€é˜»å¡æ€ï¼Œäº‹ä»¶å¾ªç¯å‡­å€Ÿç€å››ç§çŠ¶æ€å¯¹ Futureåç¨‹å¯¹è±¡ è¿›è¡Œè°ƒåº¦ã€‚

Task æ ¸å¿ƒä½œç”¨æ˜¯**åœ¨äº‹ä»¶å¾ªç¯ä¸­æ·»åŠ å¤šä¸ªå¹¶å‘ä»»åŠ¡**ï¼›  

>Python 3.7 ä»¥åçš„ç‰ˆæœ¬æ”¯æŒ `asyncio.create_task()`ï¼Œåœ¨æ­¤ä¹‹å‰çš„å†™æ³•ä¸º `loop.create_task()`ï¼Œå¼€å‘è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ä»£ç å†™æ³•å¯¹ä¸åŒç‰ˆæœ¬ python çš„å…¼å®¹æ€§ã€‚


:::details Click to see more
**asyncioçš„åŸºæœ¬ç”¨æ³•**<br/>
```python
# -*-coding:utf-8-*-  
import asyncio  
import random  
import time  
from functools import partial  
async def func1(arg1):  
    print("start...fun1")  
    s=await func2(arg1) # åç¨‹æ˜¯å¯ä»¥å¥—èµ·æ¥çš„  
    print(s)  
    print("end...fun1")  
    return s  
async def func2(arg1):  
    print("start...fun2")  
    x=random.randint(1,5)  
    await asyncio.sleep(x) # éšæœºç¡ï¼Œæ³¨æ„è¿”å›é¡ºåº  
    print(arg1)  
    print("end...fun2")  
    return "sleep%s s"%x  
  
def callback(arg1,future=None):# ä¼ äº†ä¸€ä¸ªFuture(task)å¯¹è±¡ï¼Œå®ƒå¿…é¡»æ˜¯æœ€åä¸€ä¸ªå‚æ•°  
    print(arg1) # å…¶ä»–çš„argä½¿ç”¨functools.partialåŒ…è£…æˆå‡½æ•°å¼•ç”¨  
    print("callback")  
    return  
  
if __name__=="__main__":  
    start_time=time.time()  
  
    loop=asyncio.get_event_loop()  
    # -----ä½¿ç”¨futureå¯¹è±¡-----  
    # futures=[asyncio.ensure_future(func1("i am arg")) for i in range(0,4)] # æ•´10ä¸ªåç¨‹,æ³¨æ„æ¥å£å½¢çŠ¶  
    # loop.run_until_complete(asyncio.wait(futures)) # æäº¤åˆ°åç¨‹æ±   
    # for i in futures:  
    #     print(i.result()) # è·å¾—futureå¯¹è±¡çš„ç»“æœ  
    # -----ä½¿ç”¨taskå¯¹è±¡-----  
    tasklist=[]  
    for i in range(4):  
        temp=loop.create_task(func1("i am arg"))  
        temp.add_done_callback(partial(callback,"this is arg1")) # callbackè¦ä¼ å…¥å¼•ç”¨  
        tasklist.append(temp) # taskå¯¹è±¡å’ŒFutureä¸€æ¨¡ä¸€æ ·ï¼Œtaskæ˜¯å­ç±»  
    loop.run_until_complete(asyncio.wait(tasklist)) # ä¸è¦ä¸€ä¸ªä¸€ä¸ªè¿è¡Œï¼Œä½¿ç”¨waitä¸€èµ·è¿è¡Œï¼Œä¹Ÿå¯ä»¥æäº¤å•ä¸ª  
    for i in tasklist:  
        print('result:',i.result())  
  
    end_time=time.time()  
    print(end_time-start_time)  
  
    # asyncio.wiat return_whenå¯ä»¥è®¾ç½®loopä»€ä¹ˆæ—¶å€™è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œç‚¹è¿›å®šä¹‰å¯ä»¥çœ‹  
    # asyncio.gather æ›´åŠ é«˜å±‚ï¼Œå¯ä»¥åˆ†ç»„æ§åˆ¶ï¼Œä¼ å…¥åç¨‹åˆ—è¡¨çš„æ—¶å€™è¦åŠ *æ‰è¡Œï¼Œæœ‰ä»€ä¹ˆå‡½æ•°è‡ªå·±çœ‹  
    group1 = [func1("http://projectsedu.com") for i in range(2)]  
    group2 = [func1("http://www.imooc.com") for i in range(2)]  
    group1 = asyncio.gather(*group1)  
    group2 = asyncio.gather(*group2)  
    group2.cancel()  
    loop.run_until_complete(asynci
```
è¿è¡Œç»“æœ
```
start...fun1
start...fun2
start...fun1
start...fun2
start...fun1
start...fun2
start...fun1
start...fun2
i am arg
end...fun2
sleep2 s
end...fun1
this is arg1
callback
i am arg
end...fun2
sleep3 s
end...fun1
i am arg
end...fun2
sleep3 s
end...fun1
this is arg1
callback
this is arg1
callback
i am arg
end...fun2
sleep5 s
end...fun1
this is arg1
callback
result: sleep3 s
result: sleep5 s
result: sleep2 s
result: sleep3 s
5.001136779785156
start...fun1
start...fun2
start...fun1
start...fun2
Traceback (most recent call last):
  File "/Users/jack/code/py/AdvancedPython/asyncio_prac/asyncio-2.py", line 54, in <module>
    loop.run_until_complete(asyncio.gather(group1, group2)) # group2å·²ç»cancleæ‰äº†ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/asyncio/base_events.py", line 616, in run_until_complete
    return future.result()
asyncio.exceptions.CancelledError
```
:::

loop é˜¶æ®µæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯`run_until_complete`,ä¸€ä¸ªæ˜¯`run_forever`ï¼Œå‰è€…åœ¨åè€…çš„åŸºç¡€ä¸Šä¸­æ·»åŠ äº†ä¸€ä¸ªcallbackè®©loopåœæ­¢ï¼Œloopå¯¹è±¡ä¼šè¢«æ”¾åˆ°futureä¸­ï¼ˆè¿™ä¸€ç‚¹å¾ˆåç›´è§‰ï¼‰ï¼Œæ‰€ä»¥ä»»æ„ä¸€ä¸ªfutureä»»åŠ¡éƒ½å¯ä»¥åœæ­¢æ‰loop  
æ¯”å¦‚åç¨‹å†™æ•°æ®åº“çš„æ—¶å€™æœ‰ä¸€ä¸ªfutureå‡ºé”™æœªè¿›è¡Œçš„futureéƒ½åœæ‰  
`asyncio.all_tasks(loop)`æ³¨æ„æ–°ç‰ˆçš„è·å–æ‰€æœ‰ä»»åŠ¡éœ€è¦ä¼ å…¥loop  
:::details Click to see more
**å–æ¶ˆtask**<br/>
```python
# -*-coding:utf-8-*-  
import asyncio  
import random  
import time  
from functools import partial  
async def func1(arg1):  
    print("start...fun1")  
    s=await asyncio.sleep(3)# func2(arg1) # åç¨‹æ˜¯å¯ä»¥å¥—èµ·æ¥çš„  
    print(s)  
    print("end...fun1")  
    return s  
async def func2(arg1):  
    print("start...fun2")  
    x=random.randint(1,10)  
    await asyncio.sleep(x) # éšæœºç¡ï¼Œæ³¨æ„è¿”å›é¡ºåº  
    print(arg1)  
    print("end...fun2")  
    return "sleep%s s"%x  
  
def callback(arg1,future=None):# ä¼ äº†ä¸€ä¸ªFuture(task)å¯¹è±¡ï¼Œå®ƒå¿…é¡»æ˜¯æœ€åä¸€ä¸ªå‚æ•°  
    print(arg1) # å…¶ä»–çš„argä½¿ç”¨functools.partialåŒ…è£…æˆå‡½æ•°å¼•ç”¨  
    print("callback")  
    return  
  
if __name__=="__main__":  
    start_time=time.time()  
  
    #loop=asyncio.get_event_loop()  
    loop = asyncio.new_event_loop()  
    asyncio.set_event_loop(loop)  
    tasklist=[]  
    for i in range(4):  
        temp=loop.create_task(func1("i am arg"))  
        temp.add_done_callback(partial(callback,"this is arg1")) # callbackè¦ä¼ å…¥å¼•ç”¨  
        tasklist.append(temp) # taskå¯¹è±¡å’ŒFutureä¸€æ¨¡ä¸€æ ·ï¼Œfutureæ˜¯å­ç±»  
    #loop.run_until_complete(asyncio.wait(tasklist))  
    try:  
        loop.run_until_complete(asyncio.wait(tasklist)) # ä¸è¦ä¸€ä¸ªä¸€ä¸ªè¿è¡Œï¼Œä½¿ç”¨waitä¸€èµ·è¿è¡Œï¼Œä¹Ÿå¯ä»¥æäº¤å•ä¸ª  
    except KeyboardInterrupt as e:  
        print(loop.is_running())  
        all_tasks=asyncio.all_tasks(loop) # è·å–æ‰€æœ‰çš„task,æ³¨æ„ä¼ å…¥loop  
        for task in all_tasks:  
            print("cancel task")  
            task.cancel() # å–æ¶ˆä»»åŠ¡  
        loop.stop() # æš‚åœloop  
        loop.run_forever() # åˆ«å¿˜äº†loop run forever  
    finally:  
        loop.close() # æœ€åæ­£å¸¸å…³é—­,closeä¼šå…³é—­é˜Ÿåˆ—æ‰§è¡Œå™¨ç­‰ä¸€ç³»åˆ—ä¸œè¥¿  
    for i in tasklist:  
        print('result:',i.result())  
  
    end_time=time.time()  
    print(end_time-start_time)
```
è¿è¡Œç»“æœ
```
start...fun1
start...fun1
start...fun1
start...fun1
Traceback (most recent call last):
  File "/Users/jack/code/py/AdvancedPython/asyncio_prac/asyncio-3.py", line 50, in <module>
    print('result:',i.result())
asyncio.exceptions.CancelledError
False
cancel task
cancel task
cancel task
cancel task
cancel task
```
:::
åµŒå¥—åç¨‹ä»£ç åœ¨ä¸Šé¢ï¼Œè¿”å›é¡ºåºæ˜¯è¿™æ ·çš„ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬å­åç¨‹çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆæ—¶å€™åˆ°è¾¾ä¸Šä¸€çº§çš„  
![](./static/pythonè¯­è¨€è¿›é˜¶-images-12.png)

- ä½¿ç”¨`loop.call_soon(func, arg)`æ˜¯ç­‰å¾…loopä¸‹ä¸€ä¸ªå¾ªç¯åˆ°æ¥çš„æ—¶å€™ç«‹å³æ‰§è¡Œ
    - `loop.call_soon_threadsafe(func, arg)`æ˜¯çº¿ç¨‹å®‰å…¨æ–¹æ³•
    - call_soonæ¯”call_laterå¿«,å› ä¸ºcall_lateræ˜¯loopå¼€å§‹åå‡ ç§’è°ƒç”¨ï¼Œsoonæ˜¯ç«‹åˆ»è°ƒç”¨
- ä½¿ç”¨`loop.call_later(time,func, arg)`æ˜¯ç­‰å¾…loopå¼€å§‹åå‡ ç§’å¼€å§‹è¿è¡Œ
- ä½¿ç”¨`loop.call_at(now+2, callback, 2, loop)`ï¼Œåœ¨ç³»ç»ŸæŒ‡å®šæ—¶é—´è¿è¡Œ
    - éœ€è¦ä½¿ç”¨`now=asyncio.time()`è·å¾—æ—¶é’Ÿæ—¶é—´ï¼Œä½¿ç”¨nowä½œä¸ºåŸºå‡†å»¶åå‡ ç§’è¿è¡Œ  
- `async for i in l`å¯ä»¥å°†for å¼‚æ­¥åŒ–
    - ä¸€ä¸ªå¯¹è±¡å¿…é¡»å®ç°`__aiter__`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨ï¼ˆasynchronous iteratorï¼‰å¯¹è±¡
    - ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨å¯¹è±¡å¿…é¡»å®ç°`__anext__`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªawaitableç±»å‹çš„å€¼ã€‚
    - ä¸ºäº†åœæ­¢è¿­ä»£ï¼Œ`__anext__`å¿…é¡»æŠ›å‡ºä¸€ä¸ª`StopAsyncIteration`å¼‚å¸¸ã€‚
- å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨`async with`
    - `__aenter__`Â å’Œ`__aexit__`ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½è¦è¿”å›ä¸€ä¸ª awaitableç±»å‹çš„å€¼ã€‚
ä¸Šé¢è¿™ä¿©å¯ä»¥çœ‹PEP 479
:::warning â“Question
å…¶å®è¿˜æ˜¯ä¸å¤ªæ˜ç™½ï¼Œatçš„æœºåˆ¶æ˜¯ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼Œæ˜¯å®‰æ’åœ¨æ—¶é—´æ’å€¼çš„ä»»åŠ¡ä¹‹å‰ä¹‹åè¿˜æ˜¯æŒ‡å®šæ—¶é—´çš„ä¸‹æ¬¡loop?  
ä½†æ˜¯å¥½åƒä¸å¤ªå½±å“
:::
å…¶å®asyncioå¯ä»¥åštcpå’Œudpï¼Œä½†æ˜¯è¿™ä¿©æœ€å¥½ç›´æ¥geventå’Œtwistedï¼Œasyncçš„è¯çœŸç¢°åˆ°éœ€æ±‚äº†å†å»æŸ¥  
æ‰€ä»¥å°±å…ˆä¸å†™äº†ï¼Œç›´æ¥çœ‹aiohttï¼Œè¿›é˜¶çš„è¯å†è¯´  
[taskæ˜¯Future](https://cloud.ooowl.fun/api/v3/file/source/1112/13-7%20future%20%E5%92%8C%20task.mp4?sign=YrHo6p-Pti28cdytaPH_zb-XEW37FpRhktB0UnYJ4fc%3D%3A0)çº¿ç¨‹å’Œåç¨‹ä¹‹é—´çš„æ¡¥æ¢  
### åç¨‹åŒæ­¥
[å¹¶å‘å¼‚æ­¥ç¼–ç¨‹ä¹‹äº‰ï¼šåç¨‹(asyncio)åˆ°åº•éœ€ä¸éœ€è¦åŠ é”ï¼Ÿ(çº¿ç¨‹/åç¨‹å®‰å…¨/æŒ‚èµ·/ä¸»åŠ¨åˆ‡æ¢)Python3 - SegmentFault æ€å¦](https://segmentfault.com/a/1190000041568839)
ç®€å•æ¥è¯´åç¨‹ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸­é—´çŠ¶æ€è¿˜æ˜¯æ··ä¹±çš„  

é”å’Œå¤šçº¿ç¨‹é‡Œé¢ä¸€æ ·ï¼Œæœ‰Lock Condition Semaphore Eventï¼Œæä¾›Queueå’ŒPriorityQueue  
é”å®ç°çš„æ˜¯`__aenter__` `__aexit__`é”ä½ä¹‹åå°±æ˜¯åŒæ­¥çš„äº†ï¼Œä½¿ç”¨é”å¯ä»¥`async with`å’Œ`async lock.acquire`  
Queueå®é™…ä¸Šæœ€å¤§çš„ä½œç”¨å°±æ˜¯max_sizeï¼Œå¦‚æœä¸ä»‹æ„çš„è¯ç›´æ¥ç”¨æ™®é€šå˜é‡å°±å¯ä»¥

### aiohttpå’Œaiomysql
aiohttpå¯ä»¥ç”¨æ¥å†™é«˜å¹¶å‘çˆ¬è™«ï¼Œå…¶å®ä¹Ÿä¸ç”¨é‚£ä¹ˆé«˜å¹¶å‘ ï¼Œä½†æ˜¯çœŸçš„å¥½ç‚«é…·  
å³å¯ä»¥å½“serveråˆå¯ä»¥client  

### example-5aiohttpå®ç°é«˜å¹¶å‘çˆ¬è™«
- ä½¿ç”¨aiohttpç¼–å†™éé˜»å¡çˆ¬è™«
- ä½¿ç”¨ä¿¡å·é‡æœºåˆ¶é™åˆ¶çˆ¬å–é¢‘ç‡
- æŠŠexample-1å…ƒç±»å®ç°ORMä¿®æ”¹ä¸ºaiomysqlå¼‚æ­¥çš„ORMå¹¶ä½¿ç”¨
    - åªéœ€è¦ä¿®æ”¹saveå‡½æ•°çš„ä¿å­˜éƒ¨åˆ†ï¼Œç”šè‡³å¯ä»¥å°è£…ä¸€ä¸‹
- è°ƒè¯•
![500|](./static/pythonè¯­è¨€è¿›é˜¶-images-13.png)
:::details Click to see more
**ç®€ç•¥ç‰ˆå¼‚æ­¥é«˜å¹¶å‘çˆ¬è™«**<br/>
```python
# -*-coding:utf-8-*-  
import time  
from asyncio import Queue  
  
import aiohttp  
import asyncio  
import aiofiles  
import aiomysql  
from pyquery import PyQuery  
  
unCrawledQ = Queue(maxsize=100)  # å¾…çˆ¬é˜Ÿåˆ—  
Crawled = set()  # å·²ç»çˆ¬å®Œçš„é˜Ÿåˆ—ï¼Œsetå»é‡  
RelatedQ = Queue(maxsize=100)  
htmlContentQ = Queue(maxsize=100)  # æœªæ¸…æ´—é˜Ÿåˆ—  
resultQ = Queue(maxsize=100)  # å¾…æ’å…¥sqlé˜Ÿåˆ—  
  
sem = asyncio.Semaphore(3)  # ä¿¡å·é‡æ§åˆ¶è·å–å†…å®¹çš„å¹¶å‘ä¸º3  
semR = asyncio.Semaphore(3)  # ä¿¡å·é‡æ§åˆ¶è·å–ç›¸å…³çš„å¹¶å‘ä¸º3 # å¦‚ä½•å…±ç”¨ä¿¡å·ä¸é”ä½?  
_running = True  # æ§åˆ¶æ•´ä¸ªç¨‹åºçš„èµ·åœ  
  
  
async def Spider():  # è·å–å†…å®¹  
    while _running:  
        await sem.acquire()  
        urlid = await unCrawledQ.get()  # è·å¾—ä¸€ä¸ªæ²¡æœ‰çˆ¬è¿‡çš„  
        async with aiohttp.ClientSession() as session:  # å¦‚ä½•å…±ç”¨session?  
            url = f'https://segmentfault.com/a/{urlid}'  
            async with session.get(url) as response:  
                print("Status:", response.status, "url:", url)  # è¾“å‡ºä¿¡æ¯  
                html = await response.text()  # è·å–åˆ—è¡¨  
                await htmlContentQ.put(html)  # æŠŠå†…å®¹æ·»åŠ åˆ°å†…å®¹é˜Ÿåˆ—  
                Crawled.add(urlid)  # æ·»åŠ idåˆ°å·²çˆ¬å–åˆ—è¡¨  
                await RelatedQ.put(urlid)  
        sem.release()  
  
  
async def Related():  # è§£æè¿™ä¸ªæ–‡ç« å…³è”çš„url  
    while _running:  
        await semR.acquire()  
        urlid = await RelatedQ.get()  # ä»å¸¦å…³è”é˜Ÿåˆ—è·å–ä¸€ä¸ªid  
        async with aiohttp.ClientSession() as session:  
            url = f'https://segmentfault.com/gateway/article/{urlid}/related'  
            async with session.get(url) as response:  
                print("Status:", response.status, "related:", urlid)  
                data = await response.json()  # ä»å€Ÿå£è·å–json  
                for i in data:  
                    urlid = i["id"]  
                    if urlid not in Crawled:  # æ²¡çˆ¬è¿‡  
                        await unCrawledQ.put(urlid)  # æ·»åŠ åˆ°é˜Ÿåˆ—  
                        print("add:", urlid)  
        semR.release()  
  
  
async def Extart_Header():  
    while _running:  
        item = await htmlContentQ.get()  # æ‹¿å‡ºä¸€ä¸ªhtmlå†…å®¹  
        pq = PyQuery(item)  
        await Insert(pq("h1")("a").text())  
        time.sleep(1)  
  
  
async def Insert(result):  # å¼‚æ­¥æ’å…¥mysql  
    async with aiofiles.open("2.txt", "a", encoding="utf8") as f:  
        await f.write(result)  
    pool = await aiomysql.create_pool(host="127.0.0.1",  # æ’ä¸€æ¬¡å»ºç«‹ä¸€æ¬¡connectionï¼Œåˆé€‚å—?  
                                      port=3306, user="root",  
                                      password="1118",  
                                      db="aiosql",  
                                      loop="",  
                                      charset="utf8",  
                                      autocommit=True)  
    async with pool.acquire() as conn:  
        async with conn.cursor() as cur:  
            await cur.execute("INSERT INTO tittle VALUE {}".format(result))  
  
  
async def init():  
    await unCrawledQ.put("1190000041885333")  
  
  
if __name__ == '__main__':  
    # sessionè·å–å®Œåä¸è¦å…³é—­ï¼Œå¯ä»¥å½“ä½œå‚æ•°åˆ°å¤„ä¼ ï¼Œé¿å…é‡å¤è¯·æ±‚sessionè¿æ¥  
  
    group1 = [Spider() for i in range(4)]  
    group2 = [Related() for i in range(2)]  
    group1.append(init())  # åˆå§‹åŒ–åç¨‹ï¼Œåªè¿è¡Œä¸€æ¬¡  
    group3 = [Extart_Header() for i in range(3)]  
    group1 = asyncio.gather(*group1)  
    group2 = asyncio.gather(*group2)  
    group3 = asyncio.gather(*group3)  
    loop = asyncio.get_event_loop()  
  
    loop.run_until_complete(asyncio.gather(group1, group2, group3))  
    loop.run_forever()
```
è¿è¡Œç»“æœ
```
Status: 200 url: https://segmentfault.com/a/1190000041885333
Status: 200 related: 1190000041885333
add: 1190000041787331
add: 1190000023009604
add: 1190000022525379
add: 1190000017462391
add: 1190000039678637
add: 1190000007791891
add: 1190000003484673
Status: 200 url: https://segmentfault.com/a/1190000041787331
Status: 200 url: https://segmentfault.com/a/1190000023009604
Status: 200 url: https://segmentfault.com/a/1190000022525379
Status: 200 related: 1190000022525379
Status: 200 related: 1190000041787331
add: 1190000022513280
```
:::

:::tip ğŸ“Note
æœ‰å¥½å‡ ä¸ªé—®é¢˜ï¼Œè¿˜æœ‰è¯•å›¾å…±ç”¨ä¸€ä¸ªsessionçš„æ—¶å€™ï¼Œä¼šé”ä½  
è¿™ä¸ªå¤šçº¿ç¨‹çš„éš¾åº¦ä¸ç›¸ä¸Šä¸‹ï¼Œæœ‰æ— å¤šçº¿ç¨‹å’Œåç¨‹çš„æ’æŸ¥æŠ€å·§ï¼Ÿ
:::

### å¼‚æ­¥è¿›é˜¶
å¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸ªå¤§è¯é¢˜äº†ï¼Œä»¥åå†è¯´ï¼Œè¿™é‡Œè®¨è®ºçš„å·²ç»å¤Ÿå¤šäº†  
[æ·±å…¥python->å¼‚æ­¥ç¼–ç¨‹](æ·±å…¥python.md)

------------
## æ—¥å¿—å’Œæµ‹è¯•
### æ—¥å¿—
å…ˆä¸Š[æ–‡æ¡£](https://docs.python.org/zh-cn/3.9/howto/logging.html#logging-flow)  
| çº§åˆ«               | ä½•æ—¶ä½¿ç”¨ (è°ƒç”¨æ—¶çš„å‡½æ•°åå³ä¸ºçº§åˆ«åçš„å°å†™)                            |
| ------------------ | -------------------------------------------------------------------- |
| `DEBUG` 10            | ç»†èŠ‚ä¿¡æ¯ï¼Œä»…å½“è¯Šæ–­é—®é¢˜æ—¶é€‚ç”¨ã€‚                                       |
| `INFO` 20            | ç¡®è®¤ç¨‹åºæŒ‰é¢„æœŸè¿è¡Œã€‚                                                 |
| `WARNING`(default)30 | è¡¨æ˜æœ‰å·²ç»æˆ–å³å°†å‘ç”Ÿçš„æ„å¤–ï¼ˆä¾‹å¦‚ï¼šç£ç›˜ç©ºé—´ä¸è¶³ï¼‰ã€‚ç¨‹åºä»æŒ‰é¢„æœŸè¿›è¡Œã€‚ |
| `ERROR` 40           | ç”±äºä¸¥é‡çš„é—®é¢˜ï¼Œç¨‹åºçš„æŸäº›åŠŸèƒ½å·²ç»ä¸èƒ½æ­£å¸¸æ‰§è¡Œ                       |
| `CRITICAL` 50        | ä¸¥é‡çš„é”™è¯¯ï¼Œè¡¨æ˜ç¨‹åºå·²ä¸èƒ½ç»§ç»­æ‰§è¡Œ                                   |
| `NOTSET` 0                   |                                                                      |


![python logæ¨¡å—çš„å·¥ä½œè¿‡ç¨‹](./static/pythonè¯­è¨€è¿›é˜¶-images-14.png)  
- å…ˆè¡Œé…ç½®æ ¹è®°å½•å™¨basicConfig()ä¼šåšä»¥ä¸‹ä¸¤ä»¶äº‹ï¼š
    1.  æ·»åŠ é»˜è®¤çš„å¤„ç†å™¨(handler)
    2.  æ·»åŠ é»˜è®¤çš„æ ¼å¼åŒ–å™¨ï¼ˆformatterï¼‰  

é»˜è®¤`filemode='a'`, `level=logging.WARNING`,å‘½ä»¤è¡Œè¿è¡Œçš„æ—¶å€™å¯ä»¥`--log=INFO`æŒ‡å®š,ç›´æ¥ä½¿ç”¨
logger->handler->formatter,åˆ†åˆ«éƒ½æœ‰å¯ä»¥å®šä¹‰çš„æ–¹æ³•  
ä½ å¯ä»¥å°†ä»»æ„å¯¹è±¡ä½œä¸ºæ¶ˆæ¯ä¼ é€’å°†è°ƒç”¨å…¶ `__ str__()` æ–¹æ³•  

æ³¨æ„è¿™å‡ ä¸ªhandlerçš„ä½¿ç”¨  
- [`RotatingFileHandler`](https://docs.python.org/zh-cn/3.9/library/logging.handlers.html#logging.handlers.RotatingFileHandler "logging.handlers.RotatingFileHandler") å®ä¾‹å°†æ¶ˆæ¯å‘é€åˆ°ç¡¬ç›˜æ–‡ä»¶ï¼Œæ”¯æŒæœ€å¤§æ—¥å¿—æ–‡ä»¶å¤§å°å’Œæ—¥å¿—æ–‡ä»¶è½®æ¢
- [`TimedRotatingFileHandler`](https://docs.python.org/zh-cn/3.9/library/logging.handlers.html#logging.handlers.TimedRotatingFileHandler "logging.handlers.TimedRotatingFileHandler") å®ä¾‹å°†æ¶ˆæ¯å‘é€åˆ°ç¡¬ç›˜æ–‡ä»¶ï¼Œä»¥ç‰¹å®šçš„æ—¶é—´é—´éš”è½®æ¢æ—¥å¿—æ–‡ä»¶ã€‚
- [`SMTPHandler`](https://docs.python.org/zh-cn/3.9/library/logging.handlers.html#logging.handlers.SMTPHandler "logging.handlers.SMTPHandler") å®ä¾‹å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„ç”µå­é‚®ä»¶åœ°å€ã€‚
- [`HTTPHandler`](https://docs.python.org/zh-cn/3.9/library/logging.handlers.html#logging.handlers.HTTPHandler "logging.handlers.HTTPHandler") å®ä¾‹ä½¿ç”¨ `GET` æˆ– `POST` æ–¹æ³•å°†æ¶ˆæ¯å‘é€åˆ° HTTP æœåŠ¡å™¨ã€‚

#### æŒ‰è¿›ç¨‹è®°å½•æ—¥å¿—
åœ¨å†™æ–‡ä»¶æ¨¡å¼ä¸‹ï¼Œloggingæ¨¡å—æ˜¯ä¸æ”¯æŒå¤šè¿›ç¨‹çš„
Pythoné»˜è®¤é‡‡ç”¨Forkæ–¹å¼åˆ›å»ºæ–°è¿›ç¨‹ï¼Œåœ¨Forkæ–°è¿›ç¨‹çš„æ—¶å€™ä¼šè¿åŒ **é”** ä¹Ÿä¸€åŒå¤åˆ¶åˆ°æ–°è¿›ç¨‹ã€‚  

1.  å½“ä¸»è¿›ç¨‹é‡Œæœ‰ä¸¤ä¸ªçº¿ç¨‹T1/T2ï¼Œä»¥åŠä¸€ä¸ªé”Lock1ã€‚
2.  çº¿ç¨‹T2è·å–äº†é”Lock1ï¼Œæ­¤æ—¶çº¿ç¨‹T1åˆ›å»ºäº†ä¸€ä¸ªæ–°è¿›ç¨‹P2ï¼Œæ­¤æ—¶Lock1è¢«ä¸€åŒfrokç»™äº†P2ã€‚
3.  P2æ‰§è¡Œæ—¶å°è¯•ç­‰å¾…Lock1è§£é”ã€‚ç”±äºçº¿ç¨‹T2ä¸ä¼šè¢«å¤åˆ¶åˆ°P2ï¼Œæ²¡æœ‰äººç»™P2çº¿ç¨‹çš„Lock1è§£é”ï¼Œå¯¼è‡´P2æ­»é”ã€‚
  
è§£å†³æ–¹æ¡ˆ:
- ä¸€ç§æ–¹æ¡ˆæ˜¯è®©æ‰€æœ‰è¿›ç¨‹éƒ½ç”¨ä¸€ä¸ª `SocketHandler` å¤„ç†æ—¥å¿—ï¼Œç„¶åç”¨ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹å®ç°å¥—æ¥å­—æœåŠ¡
- å¯ä»¥åˆ©ç”¨ `Queue` å’Œ [`QueueHandler`](https://docs.python.org/zh-cn/3.9/library/logging.handlers.html#logging.handlers.QueueHandler "logging.handlers.QueueHandler") å°†æ‰€æœ‰çš„æ—¥å¿—äº‹ä»¶å‘é€ç»™è‡ªå·±çš„å¤šè¿›ç¨‹åº”ç”¨ä¸­çš„æŸä¸ªè¿›ç¨‹
:::danger âš¡ï¸Danger
Pythonçš„loggingæ¨¡å—åœ¨å†™æ–‡ä»¶æ—¶ä¼šåŠ é”ï¼Œç”±äºé”è¢«å¤åˆ¶å¯¼è‡´è¿›ç¨‹æ­»é”ã€‚  
ç”±äºåˆ›å»ºæ–°è¿›ç¨‹æ—¶é”ä¼šè¢«å¤åˆ¶ï¼Œæ··ç”¨å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æ—¶çš„åŠ é”æ“ä½œåº”å½“æ ¼å¤–å°å¿ƒã€‚
:::


#### æŒ‰å¤©è®°å½•æ—¥å¿—
æŒ‰å¤©è®°å½•çš„æ—¶å€™ï¼Œè¿›ç¨‹ä¼šåœ¨12.00çš„æ—¶å€™æŠŠæ—¥å¿—æ–‡ä»¶é‡å‘½åï¼Œå¦‚æœæœ‰é‡åçš„ï¼Œå°±ä¼šåˆ æ‰ã€‚  
åœ¨å¤šè¿›ç¨‹æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªè¿›ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œä¸€ä¸ªè¿›ç¨‹å¯èƒ½ä¼šæŠŠå¦ä¸€ä¸ªè¿›ç¨‹çš„åˆ äº†  
[æ¢è®¨python loggingå¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹çš„å®‰å…¨é—®é¢˜ | Luke's blog](https://www.xluke.info/article/python-logging-multiprocess-safe)<br/>
[ä½ ä¸çŸ¥é“çš„loggingæ—¥å¿—å¤„ç†_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1PP4y187Wr?spm_id_from=333.337.search-card.all.click)<br/>
[Pythoné¢è¯•å®˜ï¼šèŠèŠå¤šè¿›ç¨‹åœºæ™¯ä¸‹Loggingæ¨¡å—ï¼Ÿ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/361058730)
#TODO æ—¥å¿—çš„å‘ä¸å°‘å•Š
#### loguru
### æµ‹è¯•
#### å•å…ƒæµ‹è¯•
ä½¿ç”¨unitteståŒ…ï¼Œå¯¹æŸä¸ªæ–‡ä»¶`file.py`é‡Œçš„ç±»è¿›è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œæ–°å»º`file_test.py`,åœ¨æµ‹è¯•æ–‡ä»¶é‡Œå¼•å…¥åŸæ–‡ä»¶ä¸­éœ€è¦çš„ç±»ï¼Œç»§æ‰¿`unittest.TestCase`ç±»åˆ›å»ºæµ‹è¯•ç±»  

ä»¥`test`å¼€å¤´çš„æ–¹æ³•å°±æ˜¯æµ‹è¯•æ–¹æ³•ï¼Œä¸ä»¥`test`å¼€å¤´çš„æ–¹æ³•ä¸è¢«è®¤ä¸ºæ˜¯æµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯•çš„æ—¶å€™ä¸ä¼šè¢«æ‰§è¡Œã€‚  
å¯¹æ¯ä¸€ç±»æµ‹è¯•éƒ½éœ€è¦ç¼–å†™ä¸€ä¸ª`test_xxx()`æ–¹æ³•ã€‚ç”±äº`unittest.TestCase`æä¾›äº†å¾ˆå¤šå†…ç½®çš„æ¡ä»¶åˆ¤æ–­ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨è¿™äº›æ–¹æ³•å°±å¯ä»¥æ–­è¨€è¾“å‡ºæ˜¯å¦æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚  

æœ€å¸¸ç”¨çš„æ–­è¨€å°±æ˜¯`self.assertEqual(abs(-1),1)`  
å¦ä¸€ç§é‡è¦çš„æ–­è¨€å°±æ˜¯æœŸå¾…æŠ›å‡ºæŒ‡å®šç±»å‹çš„Error`with self.assertRaises(KeyError):`  
æœ€åè°ƒç”¨`unittest.main()`è¿è¡Œå³å¯  

å¯ä»¥åœ¨å•å…ƒæµ‹è¯•ä¸­ç¼–å†™ä¸¤ä¸ªç‰¹æ®Šçš„`setUp()`å’Œ`tearDown()`æ–¹æ³•ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•ä¼šåˆ†åˆ«åœ¨æ¯è°ƒç”¨ä¸€ä¸ªæµ‹è¯•æ–¹æ³•çš„å‰ååˆ†åˆ«è¢«æ‰§è¡Œï¼Œå¯ä»¥ç”¨æ¥ç®¡ç†èµ„æºè¿æ¥å’Œé‡Šæ”¾ï¼Œ**æ¯ä¸ªæµ‹è¯•æ–¹æ³•éƒ½ä¼šè°ƒç”¨çš„é’©å­**  

:::details Click to see more

```python
import logging  
import unittest  
from mydict import Dict  
  
class MyTestCase(unittest.TestCase):  
  
    def setUp(self):  
        self.f=open("a.txt","a",encoding="utf8")  
        print('setUp...')  
  
    def tearDown(self):  
        self.f.write("xxx")  
        print('tearDown...')  
        self.f.close()  
  
    def test_something(self):  
        logging.debug("TESTING...")  # add assertion here  
    def test_init(self):  
        d = Dict(a=1, b='test')  
        self.assertEqual(d.a, 1)  
        self.assertEqual(d.b, 'test')  
        self.assertTrue(isinstance(d, dict))  
  
    def test_key(self):  
        d = Dict()  
        d['key'] = 'value'  
        self.assertEqual(d.key, 'value')  
  
    def test_attr(self):  
        d = Dict()  
        d.key = 'value'  
        self.assertTrue('key' in d)  
        self.assertEqual(d['key'], 'value')  
  
    def test_keyerror(self):  
        d = Dict()  
        with self.assertRaises(KeyError):  
            value = d['empty']  
  
    def test_attrerror(self):  
        d = Dict()  
        with self.assertRaises(AttributeError):  
            value = d.empty  
  
if __name__ == '__main__':  
    unittest.main()
```
è¿è¡Œç»“æœ
```
Launching pytest with arguments /Users/jack/code/py/AdvancedPython/tests/mydict_test.py --no-header --no-summary -q in /Users/jack/code/py/AdvancedPython/tests

============================= test session starts ==============================
collecting ... collected 6 items

mydict_test.py::MyTestCase::test_attr PASSED                             [ 16%]setUp...
...
```
:::

#### æ–‡æ¡£æµ‹è¯•
å†…ç½®çš„æ–‡æ¡£æµ‹è¯•æ¨¡å—å¯ä»¥ç›´æ¥æå–æ³¨é‡Šä¸­çš„ä»£ç å¹¶æ‰§è¡Œæµ‹è¯•ï¼Œä»£ç çš„æ‰§è¡Œæ˜¯ä½¿ç”¨python**å‘½ä»¤è¡Œ**æ‰§è¡Œï¼Œçœ‹ä¸€çœ¼å°±æ˜ç™½äº†  
å½“æ¨¡å—æ­£å¸¸å¯¼å…¥æ—¶ï¼Œdoctestä¸ä¼šè¢«æ‰§è¡Œã€‚åªæœ‰åœ¨**å‘½ä»¤è¡Œ**ç›´æ¥è¿è¡Œæ—¶ï¼Œæ‰æ‰§è¡Œdoctest  
:::details Click to see more

```python
# -*-coding:utf-8-*-  
# SettingCode here  
__author__ = "a_little_rubbish"  
__date__ = "2022/5/30 10:25"  
  
# import your model here  
import doctest  
# your class&function here  
def fact(n):  
    '''  
    Calculate 1*2*...*n # è¿™é‡Œä»ç„¶å¯ä»¥å†™æ³¨é‡Š
     
    >>> fact(1)  
    1    
    >>> fact(10)  
    3628800    
    >>> fact(-1)  
    Traceback (most recent call last):        
    ...    
    ValueError    
    '''    
    if n < 1:  
        raise ValueError()  
    if n == 1:  
        return 1  
    return n * fact(n - 1)  
if __name__ == "__main__":  
    print("START")  
    doctest.testmod() # ä¸ä½¿ç”¨æµ‹è¯•æ¨¡å¼è¿è¡Œçš„æ—¶å€™éœ€è¦æŒ‡å®š
```
è¿è¡Œç»“æœ
```
passed
```
:::
### ç±»å‹æ³¨è§£
#### åŸºæœ¬ç±»å‹æ³¨è§£
å½“æˆ‘ä»¬æƒ³è¦è¯´æ˜ç±»å‹çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ç±»å‹æ³¨è§£ï¼Œä½†æ˜¯ç±»å‹æ³¨è§£ä¸æ˜¯ç±»å‹æ£€æŸ¥å¹¶ä¸èƒ½é˜»æ­¢è°ƒç”¨è€…ä¼ å…¥ä¸åº”è¯¥ä¼ å…¥çš„å‚æ•°ã€‚  
-   å˜é‡ç±»å‹ï¼šåœ¨å˜é‡åååŠ ä¸€ä¸ªå†’å·ï¼Œå†’å·åå†™å˜é‡çš„æ•°æ®ç±»å‹ï¼Œå¦‚ intã€dict ç­‰
-   å‡½æ•°è¿”å›ç±»å‹ï¼šæ–¹æ³•å‚æ•°ä¸­å¦‚å˜é‡ç±»å‹ï¼Œåœ¨å‚æ•°æ‹¬å·ååŠ ä¸€ä¸ªç®­å¤´ï¼Œç®­å¤´åè¿”å›å€¼çš„ç±»å‹
    - å‡½æ•°æ³¨è§£çš„ä¿¡æ¯ï¼Œä¿å­˜åœ¨ `__annotations__` å±æ€§ä¸­å¯ä»¥æ¥è°ƒç”¨
-   æ ¼å¼è¦æ±‚ï¼ˆPEP 8ï¼Œéå¼ºåˆ¶ï¼‰ï¼šå˜é‡åå’Œå†’å·æ— ç©ºæ ¼ï¼Œå†’å·å’Œåè¾¹ç±»å‹é—´åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œç®­å¤´å·¦å³å‡æœ‰ä¸€ä¸ªç©ºæ ¼
```python
# å®šä¹‰ä¸€ä¸ªå˜é‡  
x: int = 2  
x: int | float = 2 # è¡¨ç¤º or Python 3.10 å¼€å§‹æ”¯æŒ  
x + 1# 3  
# å®šä¹‰ä¸€ä¸ªé™¤æ³•å‡½æ•°  
def div(a: int, b: int) -> float:  
    return a/b  
# æŸ¥çœ‹ç±»å‹æ³¨è§£ä¿¡æ¯  
print(div.__annotations__)  
#----ç»“æœ----
{'a': int, 'b': int, 'return': float}
```
#### å¤æ‚ç»“æ„æ³¨è§£å’Œä½¿ç”¨æ³›å‹
å¯ä»¥ä½¿ç”¨åµŒå¥—çš„ç±»å‹æ³¨è§£
```python
from typing import Union, List, Tuple, Dict

config: Dict[str, Union[List[str], Tuple[bool, str]]]= { # åµŒå¥—çš„ç±»å‹æ³¨è§£
            'width': ['100%', 'Width of img'],
            'height': ['auto', 'Height of img'],
            'fluid': (True, 'å¤–å±‚åŒ…å«ä¸€ä¸ªdiv')
        }
```

pythonçš„æ³›å‹æ˜¯PEP443ç”¨`from functools import singledispatch` å®ç°çš„ï¼Œåœ¨å‡½æ•°å‰åŠ æ³¨è§£
```python
from functools import singledispatch

@singledispatch
def age(obj):
    print('è¯·ä¼ å…¥åˆæ³•ç±»å‹çš„å‚æ•°ï¼')

@age.register(int)
def _(age):
    print('æˆ‘å·²ç»{}å²äº†ã€‚'.format(age))

@age.register(str)
def _(age):
    print('I am {} years old.'.format(age))

#----ç»“æœ----
age(23)  # int
age('twenty three')  # str
age(['23'])  # list
```

å¤æ‚ç±»å‹å†™æ³¨è§£å¾ˆéº»çƒ¦ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°æ³›å‹ï¼Œå¯¹äºpythonè¿™ç§å¼ºç±»å‹æ¥è¯´ä¸æ˜¯å¾ˆå¸¸è§ï¼Œç”¨åˆ°å†[çœ‹](https://www.gairuo.com/p/python-type-annotations)  
:::tip ğŸ“˜Abstract
ä¸è¦åœ¨pythoné‡Œé¢å†™javaï¼Œè¿™ä¸€ç‚¹ä¹Ÿä¸pythonicâœ‹  
**æ³›å‹ç¨‹åºè®¾è®¡**ï¼ˆgeneric programmingï¼‰æ˜¯[ç¨‹åºè®¾è®¡è¯­è¨€](https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80 "ç¨‹åºè®¾è®¡è¯­è¨€")çš„ä¸€ç§é£æ ¼æˆ–[èŒƒå¼](https://zh.wikipedia.org/wiki/%E7%BC%96%E7%A8%8B%E8%8C%83%E5%9E%8B "ç¼–ç¨‹èŒƒå‹")ã€‚æ³›å‹å…è®¸ç¨‹åºå‘˜åœ¨[å¼ºç±»å‹ç¨‹åºè®¾è®¡è¯­è¨€](https://zh.wikipedia.org/wiki/%E5%BC%B7%E9%A1%9E%E5%9E%8B%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80 "å¼ºç±»å‹ç¼–ç¨‹è¯­è¨€")ä¸­ç¼–å†™ä»£ç æ—¶ä½¿ç”¨ä¸€äº›ä»¥åæ‰æŒ‡å®šçš„[ç±»å‹](https://zh.wikipedia.org/wiki/%E7%B1%BB%E5%9E%8B "ç±»å‹")ï¼Œåœ¨[å®ä¾‹åŒ–](https://zh.wikipedia.org/wiki/%E5%AE%9E%E4%BE%8B "å®ä¾‹")æ—¶ä½œä¸ºå‚æ•°æŒ‡æ˜è¿™äº›ç±»å‹ã€‚  
å„ç§ç¨‹åºè®¾è®¡è¯­è¨€å’Œå…¶ç¼–è¯‘å™¨ã€è¿è¡Œç¯å¢ƒå¯¹æ³›å‹çš„æ”¯æŒå‡ä¸ä¸€æ ·ã€‚
- [Ada](https://zh.wikipedia.org/wiki/Ada "Ada")ã€[Delphi](https://zh.wikipedia.org/wiki/Delphi "Delphi")ã€[Eiffel](https://zh.wikipedia.org/wiki/Eiffel "Eiffel")ã€[Java](https://zh.wikipedia.org/wiki/Java "Java")ã€[C#](https://zh.wikipedia.org/wiki/C%E2%99%AF "Câ™¯")ã€[F#](https://zh.wikipedia.org/wiki/F "F")ã€[Swift](https://zh.wikipedia.org/wiki/Swift_(%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80) "Swift (ç¼–ç¨‹è¯­è¨€)") å’Œ [Visual Basic .NET](https://zh.wikipedia.org/wiki/Visual_Basic_.NET "Visual Basic .NET") ç§°ä¹‹ä¸ºæ³›å‹ï¼ˆgenericsï¼‰ï¼›
- [ML](https://zh.wikipedia.org/wiki/ML%E8%AF%AD%E8%A8%80 "MLè¯­è¨€")ã€[Scala](https://zh.wikipedia.org/wiki/Scala "Scala") å’Œ [Haskell](https://zh.wikipedia.org/wiki/Haskell "Haskell") ç§°ä¹‹ä¸º[å‚æ•°å¤šæ€](https://zh.wikipedia.org/wiki/%E5%8F%82%E6%95%B0%E5%A4%9A%E6%80%81 "å‚æ•°å¤šæ€")ï¼ˆparametric polymorphismï¼‰ï¼›
- [C++](https://zh.wikipedia.org/wiki/C%2B%2B "C++") å’Œ [D](https://zh.wikipedia.org/wiki/D%E8%AA%9E%E8%A8%80 "Dè¯­è¨€")ç§°ä¹‹ä¸º[æ¨¡æ¿](https://zh.wikipedia.org/wiki/%E6%A8%A1%E6%9D%BF_(C%2B%2B) "æ¨¡æ¿ (C++)")ã€‚
:::

[^1]: [Pythonæ¨¡å—ä¸åŒ…ï¼ˆä¸€ï¼‰](https://www.licode.club/archives/python%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%8C%85)